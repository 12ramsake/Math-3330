<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.53">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>8&nbsp; Multicollinearity – Math 3330: Regression Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Unit_8.html" rel="next">
<link href="./Unit_6.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Unit_7.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Multicollinearity</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Math 3330: Regression Notes</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Review material</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Linear Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Residual analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Transformations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Indicator Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Leverage and Influence</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_7.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Multicollinearity</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Variable/Model Selection</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Robust Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Appendix_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Introduction to R software</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#multicollinearity-and-the-problems-it-creates" id="toc-multicollinearity-and-the-problems-it-creates" class="nav-link active" data-scroll-target="#multicollinearity-and-the-problems-it-creates"><span class="header-section-number">8.1</span> Multicollinearity and the problems it creates</a></li>
  <li><a href="#multicollinearity-diagnostics" id="toc-multicollinearity-diagnostics" class="nav-link" data-scroll-target="#multicollinearity-diagnostics"><span class="header-section-number">8.2</span> Multicollinearity Diagnostics</a>
  <ul class="collapse">
  <li><a href="#vif" id="toc-vif" class="nav-link" data-scroll-target="#vif"><span class="header-section-number">8.2.1</span> VIF</a></li>
  <li><a href="#condition-number" id="toc-condition-number" class="nav-link" data-scroll-target="#condition-number"><span class="header-section-number">8.2.2</span> Condition number</a></li>
  </ul></li>
  <li><a href="#homework-questions" id="toc-homework-questions" class="nav-link" data-scroll-target="#homework-questions"><span class="header-section-number">8.3</span> Homework questions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Multicollinearity</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="multicollinearity-and-the-problems-it-creates" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="multicollinearity-and-the-problems-it-creates"><span class="header-section-number">8.1</span> Multicollinearity and the problems it creates</h2>
<p>A serious problem that may dramatically impact the usefulness of a regression model is multicollinearity, or near-linear dependence among the regression variables. That is multicollinearity refers to near-linear dependence among the regressors. The regressors are the columns of the <span class="math inline">\(X\)</span> matrix, so clearly an exact linear dependence among the regressors would result in a singular <span class="math inline">\(X^\top X\)</span>. This will impact our ability to estimate <span class="math inline">\(\beta\)</span>.</p>
<p>To elaborate, assume that the regressor variables and the response have been centered and scaled to unit length. The matrix <span class="math inline">\(X^\top X\)</span> is then a <span class="math inline">\(p\times p\)</span> correlation matrix (of the vector of regressors) and <span class="math inline">\(X^\top Y\)</span> is the vector of correlations between the regressors and response. Recall that a set of vectors <span class="math inline">\(v_1,\ldots,v_n\)</span> are linearly dependent if there exists <span class="math inline">\(c\neq 0\)</span> such that <span class="math inline">\(\sum_{i=1}^nc_iv_i=0\)</span>. If the columns of <span class="math inline">\(X\)</span> are linearly dependent, then <span class="math inline">\(X^\top X\)</span> is not invertible! We say there is multicollinearity if there exists <span class="math inline">\(c\neq 0\)</span> such that <span class="math inline">\(\sum_{i=1}^nc_iv_i&lt;\epsilon\)</span> for some small <span class="math inline">\(\epsilon\)</span>.</p>
<p>Multicollinearity results in large variances and covariances for the least - squares estimators of the regression coefficients. Let <span class="math inline">\(A=(X^\top X)^{-1}\)</span>, where the regressors have been centered and scaled to unit length. That is, columns <span class="math inline">\(2,\ldots,p\)</span> of <span class="math inline">\(X\)</span> have their mean subtracted and are divided by their respective norms. Then <span class="math display">\[A_{jj}=(1-R^2_j)^{-1},\]</span> where <span class="math inline">\(R^2_j\)</span> is the coefficient of multiple determination from the regression of <span class="math inline">\(X_j\)</span> on the remaining <span class="math inline">\(p - 1\)</span> regressor variables. Now, recall that <span class="math inline">\({\textrm{Var}}\left[\hat\beta_j\right]=A_{jj}\sigma^2\)</span>. What happens when the correlation is approximately 1 between <span class="math inline">\(X_j\)</span> and another regressor? It is easy to see that the the variance of coefficient <span class="math inline">\(j\)</span> goes to <span class="math inline">\(\infty\)</span> as <span class="math inline">\({\textrm{corr}}\left[X_j,X_i\right]\to 1\)</span>.</p>
<p>This huge variance results in large magnitude of the least squares estimators of the regression coefficients. We have that <span class="math inline">\({\textrm{E}}\left[\left\lVert\hat\beta-\beta\right\rVert^2\right]=\sum_{i=1}^p {\textrm{Var}}\left[\hat\beta_i\right]=\sigma^2 \mathop{\mathrm{trace}}(X^\top X)^{-1}\)</span>. Recall! <span class="math inline">\(\mathop{\mathrm{trace}}(A)\)</span> is the sum of its eigenvalues. If <span class="math inline">\(X^\top X\)</span> has near linearly dependent columns, then some of the eigenvalues <span class="math inline">\(\lambda_1,\ldots,\lambda_p\)</span> will be near 0 (why?). Thus, <span class="math display">\[{\textrm{E}}\left[\left\lVert\hat\beta-\beta\right\rVert^2\right]=\sigma^2\mathop{\mathrm{trace}}(X^\top X)^{-1}=\sigma^2\sum_{i=1}^p\frac{1}{\lambda_i}.\]</span> We can also show that <span class="math display">\[{\textrm{E}}\left[\hat{\beta}^{\top} \hat{\beta}\right]=\beta^{\top} \beta+\sigma^2 \operatorname{Tr}\left(X^{\top} X\right)^{-1},\]</span> which gives the same interpretation.</p>
<p>We can also observe this empirically.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's simulate data from a regression model with highly correlated regressors. </span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>simulate_coef<span class="ot">=</span><span class="cf">function</span>(){</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  n<span class="ot">=</span><span class="dv">100</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  X<span class="ot">=</span><span class="fu">rnorm</span>(n)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  X2<span class="ot">=</span><span class="dv">2</span><span class="sc">*</span>X<span class="sc">+</span><span class="fu">rnorm</span>(n,<span class="dv">0</span>,<span class="fl">0.01</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  Y<span class="ot">=</span><span class="dv">1</span><span class="sc">+</span><span class="dv">2</span><span class="sc">*</span>X<span class="sc">+</span>X2<span class="sc">*</span><span class="dv">2</span><span class="sc">+</span><span class="fu">rnorm</span>(n)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">coef</span>(<span class="fu">lm</span>(Y<span class="sc">~</span>X<span class="sc">+</span>X2)))</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># See the HUGE variance in the estimated coefficients? 0 this is from MCL!</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>CF<span class="ot">=</span><span class="fu">replicate</span>(<span class="dv">1000</span>,<span class="fu">simulate_coef</span>())</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(CF[<span class="dv">1</span>,],<span class="at">xlab=</span><span class="st">'Coef 1'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_7_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(CF[<span class="dv">2</span>,],<span class="at">xlab=</span><span class="st">'Coef 2'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_7_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(CF[<span class="dv">3</span>,],<span class="at">xlab=</span><span class="st">'Coef 3'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_7_files/figure-html/unnamed-chunk-1-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>It is easy to see from this analysis that multicollinearity is a serious problem, and we should check for it in regression modelling.</p>
</section>
<section id="multicollinearity-diagnostics" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="multicollinearity-diagnostics"><span class="header-section-number">8.2</span> Multicollinearity Diagnostics</h2>
<section id="vif" class="level3" data-number="8.2.1">
<h3 data-number="8.2.1" class="anchored" data-anchor-id="vif"><span class="header-section-number">8.2.1</span> VIF</h3>
<p>We need some diagnostics to detect multicollinearity. The first of which is the <strong>correlation matrix</strong>, which is good for detecting pairwise correlations, but not so much for more complicated dependencies! To correct this, a popular diagnostic is the <strong>variance inflation factor</strong> (VIF): these are the diagonals of <span class="math inline">\((X^\top X)^{-1}\)</span>. A VIF that exceeds 3, 5 or 10 is an indication that the associated regression coefficients are poorly estimated because of multicollinearity. The variance inflation factor can be written as <span class="math inline">\((1-R^2_j)^{-1}\)</span>, where <span class="math inline">\(R^2_j\)</span> is the coefficient of determination obtained from regressing <span class="math inline">\(x_j\)</span> on the other regressor variables. For categorical variables, we may look at their VIF together, instead of for the individual dummy variables. This is done via the <a href="https://www.tandfonline.com/doi/abs/10.1080/01621459.1992.10475190#.U2jkTFdMzTo">generalized VIF (GVIF)</a>, which was developed by our very own Georges Monette and John Fox <span class="citation" data-cites="Monette1992">(<a href="references.html#ref-Monette1992" role="doc-biblioref">Fox and Monette 1992</a>)</span>. We can consider the <span class="math inline">\((GVIF^{(1/(2\text{number of dummy variables})))}\)</span>. However, we want to compare these to the square root of our rules of thumb, so <span class="math inline">\(\sqrt{3},\sqrt{5},\sqrt{10}\)</span>. The values <span class="math inline">\((GVIF^{(1/(2\text{number of dummy variables})))}\)</span> are computed automatically in R. When your model has interaction effects, or polynomial terms, it is best to exclude those and compute the VIFs. In summary:</p>
<ul>
<li>Compare the VIF of continuous variables to 3, 5 or 10, above those values signals multicollinearity</li>
<li>Compare the <span class="math inline">\((GVIF^{(1/(2\text{number of dummy variables})))}\)</span> of categorical variables to <span class="math inline">\(\sqrt{3},\sqrt{5},\text{ or }\sqrt{10}\)</span>, above those values signals multicollinearity</li>
<li>When computing VIF and GVIF, it is best to exclude interaction effects and or polynomial terms</li>
<li>The given thresholds are rules of thumb, and we should not discard evidence of multicollinearity of we are very close to a threshold, e.g., 9.9.</li>
</ul>
</section>
<section id="condition-number" class="level3" data-number="8.2.2">
<h3 data-number="8.2.2" class="anchored" data-anchor-id="condition-number"><span class="header-section-number">8.2.2</span> Condition number</h3>
<p>One can also look at the eigenvalues of <span class="math inline">\(X^\top X\)</span>, where the regressors are centered and normalized to unit length. If the eigenvalues are small, this indicates multicollinearity. One metric computed from the eigenvalues is the <strong>condition number</strong> of <span class="math inline">\(X^\top X\)</span>: <span class="math inline">\(\kappa=\max \lambda_j/\min \lambda_j\)</span>, where the regressors are centered and normalized to unit length. Condition numbers between 100 and 1000 imply moderate to strong multicollinearity, and if <span class="math inline">\(\kappa\)</span> exceeds 1000, severe multicollinearity is indicated. Diagonalizing via <span class="math inline">\(X^\top X=\Lambda D \Lambda^\top\)</span> yields the eigenvectors, which help us determine the exact dependence between variables is. You can check the eigenvectors associated with the small eigenvalues. Components that are large in the eigenvector indicate that that variable is contributing to the multicollinearity. Again, for this computation, it is best to exclude interaction effects and or polynomial terms.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>While the method of least squares will generally produce poor estimates of the individual model parameters when strong multicollinearity is present, this does not necessarily imply that the fitted model is a poor predictor.</p>
<ol type="1">
<li>If predictions are confined to regions of the <span class="math inline">\(X\)</span>-space where the multicollinearity holds approximately, the fitted model often produces satisfactory predictions.</li>
<li>The linear combinations <span class="math inline">\(X\beta\)</span> may be estimated well, even if <span class="math inline">\(\beta\)</span> is not.</li>
</ol>
</div>
</div>
<div id="exm-7-3-1" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.1</strong></span> Recall example <a href="Unit_5.html#exm-6-4-1" class="quarto-xref">Example&nbsp;<span>6.6</span></a>. Check for multicollinearity in the proposed models.</p>
</div>
<p>I will load in the data below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>model2<span class="ot">=</span><span class="fu">lm</span>(Sale_price<span class="sc">~</span>.<span class="sc">+</span>District<span class="sc">*</span>Year_Built<span class="sc">+</span>District<span class="sc">*</span>Lotsize<span class="sc">+</span>District<span class="sc">*</span>Fin_sqft</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>          ,df)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span><span class="fu">model.matrix</span>(model2)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>depths<span class="ot">=</span>ddalpha<span class="sc">::</span><span class="fu">depth.projection</span>(<span class="fu">cbind</span>(X,df<span class="sc">$</span>Sale_price),<span class="fu">cbind</span>(X,df<span class="sc">$</span>Sale_price))</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>model3<span class="ot">=</span><span class="fu">lm</span>(Sale_price<span class="sc">~</span>.<span class="sc">+</span>District<span class="sc">*</span>Year_Built<span class="sc">+</span>District<span class="sc">*</span>Lotsize<span class="sc">+</span>District<span class="sc">*</span>Fin_sqft</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>         ,df[<span class="sc">-</span>(<span class="fu">order</span>(depths)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]),])</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Sale_price ~ . + District * Year_Built + District * 
    Lotsize + District * Fin_sqft, data = df[-(order(depths)[1:100]), 
    ])

Residuals:
    Min      1Q  Median      3Q     Max 
-546901  -27395     678   26713  331140 

Coefficients:
                         Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)             3.707e+05  7.658e+04   4.840 1.30e-06 ***
District               -9.869e+04  7.346e+03 -13.434  &lt; 2e-16 ***
ExtwallBlock           -2.870e+03  4.323e+03  -0.664 0.506824    
ExtwallBrick            7.323e+03  8.497e+02   8.619  &lt; 2e-16 ***
ExtwallFiber-Cement     3.498e+04  4.376e+03   7.993 1.38e-15 ***
ExtwallFrame           -4.870e+03  1.145e+03  -4.253 2.12e-05 ***
ExtwallMasonry / Frame  3.673e+03  2.011e+03   1.826 0.067876 .  
ExtwallPrem Wood        1.316e+04  6.688e+03   1.968 0.049049 *  
ExtwallStone            4.418e+03  1.796e+03   2.461 0.013874 *  
ExtwallStucco           1.440e+04  2.525e+03   5.705 1.18e-08 ***
Stories1                1.831e+04  1.205e+04   1.519 0.128880    
Stories1.5              3.026e+04  1.203e+04   2.515 0.011917 *  
Stories2                3.728e+04  1.198e+04   3.111 0.001867 ** 
Year_Built             -3.746e+02  3.767e+01  -9.946  &lt; 2e-16 ***
Fin_sqft                1.141e+02  1.573e+00  72.526  &lt; 2e-16 ***
Units1                  1.004e+05  8.606e+03  11.666  &lt; 2e-16 ***
Units2                  2.299e+04  8.606e+03   2.672 0.007555 ** 
Units3                 -1.511e+04  9.265e+03  -1.631 0.102820    
Bdrms0                  1.318e+05  2.173e+04   6.065 1.34e-09 ***
Bdrms1                  1.067e+05  1.198e+04   8.905  &lt; 2e-16 ***
Bdrms2                  1.131e+05  1.073e+04  10.540  &lt; 2e-16 ***
Bdrms3                  1.160e+05  1.067e+04  10.878  &lt; 2e-16 ***
Bdrms4                  1.044e+05  1.062e+04   9.833  &lt; 2e-16 ***
Bdrms5                  1.029e+05  1.062e+04   9.693  &lt; 2e-16 ***
Bdrms6                  8.401e+04  1.064e+04   7.900 2.92e-15 ***
Bdrms7                  6.147e+04  1.134e+04   5.422 5.96e-08 ***
Bdrms8                  7.115e+04  1.194e+04   5.961 2.53e-09 ***
Fbath0                 -2.283e+04  1.773e+04  -1.288 0.197810    
Fbath1                 -1.019e+04  1.355e+04  -0.752 0.452223    
Fbath2                  1.012e+04  1.349e+04   0.750 0.453131    
Fbath3                  4.598e+04  1.344e+04   3.422 0.000622 ***
Fbath4                  5.227e+04  1.433e+04   3.648 0.000265 ***
Lotsize                 4.938e-01  3.044e-01   1.622 0.104811    
Sale_date               4.706e+00  3.051e-01  15.422  &lt; 2e-16 ***
District:Year_Built     5.542e+01  3.794e+00  14.606  &lt; 2e-16 ***
District:Lotsize        1.351e-01  3.342e-02   4.041 5.34e-05 ***
District:Fin_sqft      -4.961e+00  1.414e-01 -35.091  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 51340 on 24338 degrees of freedom
Multiple R-squared:  0.4958,    Adjusted R-squared:  0.495 
F-statistic: 664.7 on 36 and 24338 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlations </span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span><span class="fu">model.matrix</span>(model3)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(<span class="fu">cor</span>(X[,<span class="sc">-</span><span class="dv">1</span>]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_7_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(<span class="fu">cor</span>(X[,<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">23</span>)]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_7_files/figure-html/unnamed-chunk-3-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VIFS</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="co"># predictor removes the interactions</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(model3,<span class="at">type =</span> <span class="st">'predictor'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>GVIFs computed for predictors</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                   GVIF Df GVIF^(1/(2*Df))                Interacts With
District       5.767239  7        1.133326 Year_Built, Lotsize, Fin_sqft
Extwall        1.408369  8        1.021633                          --  
Stories        2.843683  3        1.190274                          --  
Year_Built    26.199665  3        1.723386                      District
Fin_sqft   39201.142639  3        5.828406                      District
Units          3.319982  3        1.221395                          --  
Bdrms          4.211501  9        1.083156                          --  
Fbath          3.208287  5        1.123640                          --  
Lotsize    11980.755137  3        4.783517                      District
Sale_date      1.018352  1        1.009134                          --  
                                                                             Other Predictors
District                                     Extwall, Stories, Units, Bdrms, Fbath, Sale_date
Extwall      District, Stories, Year_Built, Fin_sqft, Units, Bdrms, Fbath, Lotsize, Sale_date
Stories      District, Extwall, Year_Built, Fin_sqft, Units, Bdrms, Fbath, Lotsize, Sale_date
Year_Built                Extwall, Stories, Fin_sqft, Units, Bdrms, Fbath, Lotsize, Sale_date
Fin_sqft                Extwall, Stories, Year_Built, Units, Bdrms, Fbath, Lotsize, Sale_date
Units      District, Extwall, Stories, Year_Built, Fin_sqft, Bdrms, Fbath, Lotsize, Sale_date
Bdrms      District, Extwall, Stories, Year_Built, Fin_sqft, Units, Fbath, Lotsize, Sale_date
Fbath      District, Extwall, Stories, Year_Built, Fin_sqft, Units, Bdrms, Lotsize, Sale_date
Lotsize                Extwall, Stories, Year_Built, Fin_sqft, Units, Bdrms, Fbath, Sale_date
Sale_date      District, Extwall, Stories, Year_Built, Fin_sqft, Units, Bdrms, Fbath, Lotsize</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>model4<span class="ot">=</span><span class="fu">lm</span>(Sale_price<span class="sc">~</span>Extwall <span class="sc">+</span>Stories<span class="sc">+</span>Year_Built<span class="sc">+</span>Fin_sqft<span class="sc">+</span>Units<span class="sc">+</span>Bdrms<span class="sc">+</span>Fbath<span class="sc">+</span>Sale_date<span class="sc">+</span>District<span class="sc">*</span>Year_Built<span class="sc">+</span>District<span class="sc">+</span>District<span class="sc">*</span>Fin_sqft</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>         ,df[<span class="sc">-</span>(<span class="fu">order</span>(depths)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]),])</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(model4,<span class="at">type =</span> <span class="st">'predictor'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>GVIFs computed for predictors</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                   GVIF Df GVIF^(1/(2*Df))       Interacts With
Extwall        1.394954  8        1.021022                 --  
Stories        2.801098  3        1.187284                 --  
Year_Built    10.399682  3        1.477418             District
Fin_sqft   30704.624901  3        5.595866             District
Units          3.282532  3        1.219087                 --  
Bdrms          4.168077  9        1.082532                 --  
Fbath          3.206209  5        1.123568                 --  
Sale_date      1.018219  1        1.009068                 --  
District       5.397265  5        1.183634 Year_Built, Fin_sqft
                                                                    Other Predictors
Extwall      Stories, Year_Built, Fin_sqft, Units, Bdrms, Fbath, Sale_date, District
Stories      Extwall, Year_Built, Fin_sqft, Units, Bdrms, Fbath, Sale_date, District
Year_Built                Extwall, Stories, Fin_sqft, Units, Bdrms, Fbath, Sale_date
Fin_sqft                Extwall, Stories, Year_Built, Units, Bdrms, Fbath, Sale_date
Units      Extwall, Stories, Year_Built, Fin_sqft, Bdrms, Fbath, Sale_date, District
Bdrms      Extwall, Stories, Year_Built, Fin_sqft, Units, Fbath, Sale_date, District
Fbath      Extwall, Stories, Year_Built, Fin_sqft, Units, Bdrms, Sale_date, District
Sale_date      Extwall, Stories, Year_Built, Fin_sqft, Units, Bdrms, Fbath, District
District                            Extwall, Stories, Units, Bdrms, Fbath, Sale_date</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>model4<span class="ot">=</span><span class="fu">lm</span>(Sale_price<span class="sc">~</span>Extwall <span class="sc">+</span>Stories<span class="sc">+</span>Year_Built<span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>            Lotsize<span class="sc">+</span>Units<span class="sc">+</span>Bdrms<span class="sc">+</span>Fbath<span class="sc">+</span>Sale_date<span class="sc">+</span>District<span class="sc">*</span>Year_Built<span class="sc">+</span>District<span class="sc">+</span>District<span class="sc">*</span>Lotsize</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>         ,df[<span class="sc">-</span>(<span class="fu">order</span>(depths)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]),])</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span><span class="fu">model.matrix</span>(model4)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(model4,<span class="at">type =</span> <span class="st">'predictor'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>GVIFs computed for predictors</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>                  GVIF Df GVIF^(1/(2*Df))      Interacts With
Extwall       1.277945  8        1.015446                --  
Stories       2.158736  3        1.136842                --  
Year_Built   11.264887  3        1.497228            District
Lotsize    9854.235061  3        4.630243            District
Units         3.239363  3        1.216401                --  
Bdrms         3.128915  9        1.065423                --  
Fbath         2.651459  5        1.102424                --  
Sale_date     1.017879  1        1.008900                --  
District      1.368665  5        1.031881 Year_Built, Lotsize
                                                                   Other Predictors
Extwall      Stories, Year_Built, Lotsize, Units, Bdrms, Fbath, Sale_date, District
Stories      Extwall, Year_Built, Lotsize, Units, Bdrms, Fbath, Sale_date, District
Year_Built                Extwall, Stories, Lotsize, Units, Bdrms, Fbath, Sale_date
Lotsize                Extwall, Stories, Year_Built, Units, Bdrms, Fbath, Sale_date
Units      Extwall, Stories, Year_Built, Lotsize, Bdrms, Fbath, Sale_date, District
Bdrms      Extwall, Stories, Year_Built, Lotsize, Units, Fbath, Sale_date, District
Fbath      Extwall, Stories, Year_Built, Lotsize, Units, Bdrms, Sale_date, District
Sale_date      Extwall, Stories, Year_Built, Lotsize, Units, Bdrms, Fbath, District
District                           Extwall, Stories, Units, Bdrms, Fbath, Sale_date</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>model4<span class="ot">=</span><span class="fu">lm</span>(Sale_price<span class="sc">~</span>Extwall <span class="sc">+</span>Stories<span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>            Lotsize<span class="sc">+</span>Units<span class="sc">+</span>Bdrms<span class="sc">+</span>Fbath<span class="sc">+</span>Sale_date<span class="sc">+</span>District<span class="sc">+</span>District<span class="sc">*</span>Lotsize</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>         ,df[<span class="sc">-</span>(<span class="fu">order</span>(depths)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]),])</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(model4,<span class="at">type =</span> <span class="st">'predictor'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>GVIFs computed for predictors</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>              GVIF Df GVIF^(1/(2*Df)) Interacts With
Extwall   1.195579  8        1.011227           --  
Stories   2.069609  3        1.128881           --  
Lotsize   1.105862  3        1.016912       District
Units     3.216062  3        1.214938           --  
Bdrms     3.044742  9        1.063810           --  
Fbath     2.634924  5        1.101734           --  
Sale_date 1.017669  1        1.008796           --  
District  1.105862  3        1.016912        Lotsize
                                                      Other Predictors
Extwall     Stories, Lotsize, Units, Bdrms, Fbath, Sale_date, District
Stories     Extwall, Lotsize, Units, Bdrms, Fbath, Sale_date, District
Lotsize               Extwall, Stories, Units, Bdrms, Fbath, Sale_date
Units     Extwall, Stories, Lotsize, Bdrms, Fbath, Sale_date, District
Bdrms     Extwall, Stories, Lotsize, Units, Fbath, Sale_date, District
Fbath     Extwall, Stories, Lotsize, Units, Bdrms, Sale_date, District
Sale_date     Extwall, Stories, Lotsize, Units, Bdrms, Fbath, District
District              Extwall, Stories, Units, Bdrms, Fbath, Sale_date</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's go back to </span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>model4<span class="ot">=</span><span class="fu">lm</span>(Sale_price<span class="sc">~</span>Extwall <span class="sc">+</span>Stories<span class="sc">+</span>Year_Built<span class="sc">+</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>            Lotsize<span class="sc">+</span>Units<span class="sc">+</span>Bdrms<span class="sc">+</span>Fbath<span class="sc">+</span>Sale_date<span class="sc">+</span>District<span class="sc">*</span>Year_Built<span class="sc">+</span>District<span class="sc">+</span>District<span class="sc">*</span>Lotsize</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>         ,df[<span class="sc">-</span>(<span class="fu">order</span>(depths)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]),])</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># remove interactions to compute the condition number</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>model4<span class="ot">=</span><span class="fu">lm</span>(Sale_price<span class="sc">~</span>Extwall <span class="sc">+</span>Stories<span class="sc">+</span>Year_Built<span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>            Lotsize<span class="sc">+</span>Units<span class="sc">+</span>Bdrms<span class="sc">+</span>Fbath<span class="sc">+</span>Sale_date<span class="sc">+</span>District</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>         ,df[<span class="sc">-</span>(<span class="fu">order</span>(depths)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]),])</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span><span class="fu">model.matrix</span>(model4)</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlations </span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co"># X=X[,-1]</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>X2<span class="ot">=</span><span class="fu">apply</span>(X,<span class="dv">2</span>,<span class="cf">function</span>(x){(x<span class="sc">-</span><span class="fu">mean</span>(x))<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">sum</span>((x<span class="sc">-</span><span class="fu">mean</span>(x))<span class="sc">^</span><span class="dv">2</span>))}); <span class="fu">dim</span>(X2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 24375    33</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>X2[,<span class="dv">1</span>]<span class="ot">=</span>X[,<span class="dv">1</span>]</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span>X2</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>A<span class="ot">=</span><span class="fu">eigen</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">sort</span>(A<span class="sc">$</span>values)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_7_files/figure-html/unnamed-chunk-3-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(A<span class="sc">$</span>values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 33</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(A<span class="sc">$</span>vectors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 33 33</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Condition number </span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(A<span class="sc">$</span>values)<span class="sc">/</span><span class="fu">min</span>(A<span class="sc">$</span>values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 21815940</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(A<span class="sc">$</span>vectors)<span class="ot">=</span><span class="fu">names</span>(model4<span class="sc">$</span>coefficients)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Which components are important here</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>A<span class="sc">$</span>vectors[,<span class="fu">which.min</span>(A<span class="sc">$</span>values)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           (Intercept)           ExtwallBlock           ExtwallBrick 
          0.000000e+00           1.391074e-04           5.763959e-04 
   ExtwallFiber-Cement           ExtwallFrame ExtwallMasonry / Frame 
          7.879780e-04          -4.339565e-04           2.722384e-05 
      ExtwallPrem Wood           ExtwallStone          ExtwallStucco 
          4.839041e-05           2.244173e-04          -1.570899e-04 
              Stories1             Stories1.5               Stories2 
         -1.575615e-01          -1.128492e-01          -1.359987e-01 
            Year_Built                Lotsize                 Units1 
         -9.132545e-04           1.338492e-03           3.847841e-02 
                Units2                 Units3                 Bdrms0 
          3.628193e-02           7.148591e-03          -8.517787e-03 
                Bdrms1                 Bdrms2                 Bdrms3 
         -3.017921e-02          -1.683173e-01          -2.482580e-01 
                Bdrms4                 Bdrms5                 Bdrms6 
         -2.098523e-01          -1.112468e-01          -1.056495e-01 
                Bdrms7                 Bdrms8                 Fbath0 
         -3.000050e-02          -2.391364e-02           3.698662e-02 
                Fbath1                 Fbath2                 Fbath3 
          6.075369e-01           5.951386e-01           2.263102e-01 
                Fbath4              Sale_date               District 
          7.226936e-02          -1.469709e-04          -2.934949e-04 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># round(A$vectors[,which.min(A$values)],1)</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(A<span class="sc">$</span>vectors[,<span class="fu">which.min</span>(A<span class="sc">$</span>values)][<span class="fu">abs</span>(<span class="fu">round</span>(A<span class="sc">$</span>vectors[,<span class="fu">which.min</span>(A<span class="sc">$</span>values)],<span class="dv">1</span>))<span class="sc">&gt;</span><span class="dv">0</span>],<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Stories1 Stories1.5   Stories2     Bdrms2     Bdrms3     Bdrms4     Bdrms5 
      -0.2       -0.1       -0.1       -0.2       -0.2       -0.2       -0.1 
    Bdrms6     Fbath1     Fbath2     Fbath3     Fbath4 
      -0.1        0.6        0.6        0.2        0.1 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>min_4<span class="ot">=</span><span class="fu">order</span>(A<span class="sc">$</span>values)[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>A<span class="sc">$</span>vectors[,min_4]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                [,1]          [,2]          [,3]          [,4]
(Intercept)             0.000000e+00  0.000000e+00  0.000000e+00  0.000000e+00
ExtwallBlock            1.391074e-04  1.642796e-04 -2.852157e-04 -1.667256e-03
ExtwallBrick            5.763959e-04  1.716474e-04  8.272060e-04 -7.002591e-04
ExtwallFiber-Cement     7.879780e-04  4.952025e-04  5.838351e-04 -3.575749e-06
ExtwallFrame           -4.339565e-04 -2.879957e-04  7.306945e-04 -4.410216e-03
ExtwallMasonry / Frame  2.722384e-05 -5.716739e-04  6.180125e-04  1.037622e-03
ExtwallPrem Wood        4.839041e-05 -2.895207e-06 -1.261004e-04 -6.127120e-06
ExtwallStone            2.244173e-04  2.078023e-04  1.318375e-04 -3.901803e-04
ExtwallStucco          -1.570899e-04  7.695650e-04  3.160665e-05 -1.559053e-03
Stories1               -1.575615e-01  5.284560e-01  3.701829e-01  2.333908e-03
Stories1.5             -1.128492e-01  3.816103e-01  2.669972e-01  1.061492e-03
Stories2               -1.359987e-01  4.560078e-01  3.205924e-01 -2.506628e-03
Year_Built             -9.132545e-04  2.241938e-04 -1.128521e-03  2.609039e-03
Lotsize                 1.338492e-03 -6.007263e-04  1.166352e-03 -6.628360e-04
Units1                  3.847841e-02  5.537283e-02 -6.223713e-02 -6.982024e-01
Units2                  3.628193e-02  5.323831e-02 -5.977815e-02 -6.829975e-01
Units3                  7.148591e-03  1.055348e-02 -1.040676e-02 -1.714447e-01
Bdrms0                 -8.517787e-03 -1.269415e-02  1.449406e-02 -1.160624e-02
Bdrms1                 -3.017921e-02 -4.503160e-02  5.136970e-02 -1.165637e-02
Bdrms2                 -1.683173e-01 -2.506245e-01  2.865852e-01 -5.345643e-02
Bdrms3                 -2.482580e-01 -3.699267e-01  4.226535e-01 -7.853337e-02
Bdrms4                 -2.098523e-01 -3.133173e-01  3.577005e-01 -6.662211e-02
Bdrms5                 -1.112468e-01 -1.669102e-01  1.902303e-01 -3.499806e-02
Bdrms6                 -1.056495e-01 -1.597889e-01  1.820544e-01 -3.366018e-02
Bdrms7                 -3.000050e-02 -4.937932e-02  5.804960e-02 -1.519200e-02
Bdrms8                 -2.391364e-02 -3.807613e-02  4.521302e-02 -1.341423e-02
Fbath0                  3.698662e-02 -2.825043e-03  1.965569e-02  2.998768e-03
Fbath1                  6.075369e-01 -4.294394e-02  3.176212e-01  6.274509e-05
Fbath2                  5.951386e-01 -4.144521e-02  3.120655e-01  2.866405e-03
Fbath3                  2.263102e-01 -1.630349e-02  1.220151e-01  1.273003e-03
Fbath4                  7.226936e-02 -4.471698e-03  3.852752e-02 -3.781872e-03
Sale_date              -1.469709e-04 -7.856620e-04 -3.463682e-04  7.182772e-03
District               -2.934949e-04  3.993424e-04 -4.440268e-04  7.881361e-04</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># round(A$vectors[,which.min(A$values)],1)</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> min_4)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">round</span>(A<span class="sc">$</span>vectors[,i][<span class="fu">abs</span>(<span class="fu">round</span>(A<span class="sc">$</span>vectors[,i],<span class="dv">1</span>))<span class="sc">&gt;</span><span class="dv">0</span>],<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Stories1 Stories1.5   Stories2     Bdrms2     Bdrms3     Bdrms4     Bdrms5 
      -0.2       -0.1       -0.1       -0.2       -0.2       -0.2       -0.1 
    Bdrms6     Fbath1     Fbath2     Fbath3     Fbath4 
      -0.1        0.6        0.6        0.2        0.1 
  Stories1 Stories1.5   Stories2     Units1     Units2     Bdrms2     Bdrms3 
       0.5        0.4        0.5        0.1        0.1       -0.3       -0.4 
    Bdrms4     Bdrms5     Bdrms6 
      -0.3       -0.2       -0.2 
  Stories1 Stories1.5   Stories2     Units1     Units2     Bdrms1     Bdrms2 
       0.4        0.3        0.3       -0.1       -0.1        0.1        0.3 
    Bdrms3     Bdrms4     Bdrms5     Bdrms6     Bdrms7     Fbath1     Fbath2 
       0.4        0.4        0.2        0.2        0.1        0.3        0.3 
    Fbath3 
       0.1 
Units1 Units2 Units3 Bdrms2 Bdrms3 Bdrms4 
  -0.7   -0.7   -0.2   -0.1   -0.1   -0.1 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>model5<span class="ot">=</span><span class="fu">lm</span>(Sale_price<span class="sc">~</span>Extwall <span class="sc">+</span>Year_Built<span class="sc">+</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>            Lotsize<span class="sc">+</span>Bdrms<span class="sc">+</span>Sale_date<span class="sc">+</span>District</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>         ,df[<span class="sc">-</span>(<span class="fu">order</span>(depths)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]),])</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span><span class="fu">model.matrix</span>(model5)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlations </span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co"># X=X[,-1]</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>X2<span class="ot">=</span><span class="fu">apply</span>(X,<span class="dv">2</span>,<span class="cf">function</span>(x){(x<span class="sc">-</span><span class="fu">mean</span>(x))<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">sum</span>((x<span class="sc">-</span><span class="fu">mean</span>(x))<span class="sc">^</span><span class="dv">2</span>))}); <span class="fu">dim</span>(X2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 24375    22</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>X2[,<span class="dv">1</span>]<span class="ot">=</span>X[,<span class="dv">1</span>]</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span>X2</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>A<span class="ot">=</span><span class="fu">eigen</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">sort</span>(A<span class="sc">$</span>values)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_7_files/figure-html/unnamed-chunk-3-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(A<span class="sc">$</span>values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 22</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(A<span class="sc">$</span>vectors)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 22 22</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Condition number </span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(A<span class="sc">$</span>values)<span class="sc">/</span><span class="fu">min</span>(A<span class="sc">$</span>values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15011026</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(A<span class="sc">$</span>vectors)<span class="ot">=</span><span class="fu">names</span>(model5<span class="sc">$</span>coefficients)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Which components are important here</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>A<span class="sc">$</span>vectors[,<span class="fu">which.min</span>(A<span class="sc">$</span>values)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           (Intercept)           ExtwallBlock           ExtwallBrick 
          0.000000e+00           4.201696e-05          -4.827182e-04 
   ExtwallFiber-Cement           ExtwallFrame ExtwallMasonry / Frame 
         -8.958733e-05          -1.491693e-03          -1.071520e-03 
      ExtwallPrem Wood           ExtwallStone          ExtwallStucco 
          2.559829e-05           9.905531e-05           1.525812e-04 
            Year_Built                Lotsize                 Bdrms0 
          1.320928e-03          -7.937453e-04          -2.238258e-02 
                Bdrms1                 Bdrms2                 Bdrms3 
         -7.537762e-02          -4.187624e-01          -6.179084e-01 
                Bdrms4                 Bdrms5                 Bdrms6 
         -5.240748e-01          -2.801570e-01          -2.680278e-01 
                Bdrms7                 Bdrms8              Sale_date 
         -8.499657e-02          -6.657667e-02           3.872069e-04 
              District 
          5.441947e-04 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># round(A$vectors[,which.min(A$values)],1)</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(A<span class="sc">$</span>vectors[,<span class="fu">which.min</span>(A<span class="sc">$</span>values)][<span class="fu">abs</span>(<span class="fu">round</span>(A<span class="sc">$</span>vectors[,<span class="fu">which.min</span>(A<span class="sc">$</span>values)],<span class="dv">1</span>))<span class="sc">&gt;</span><span class="dv">0</span>],<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Bdrms1 Bdrms2 Bdrms3 Bdrms4 Bdrms5 Bdrms6 Bdrms7 Bdrms8 
  -0.1   -0.4   -0.6   -0.5   -0.3   -0.3   -0.1   -0.1 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is fine</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="exm-7-3-1" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.2</strong></span> Example 9.1 from the textbook - The Acetylene Data. Below presents data concerning the percentage of conversion of <span class="math inline">\(n\)</span> - heptane to acetylene and three explanatory variables. These are typical chemical process data for which a full quadratic response surface in all three regressors is often considered to be an appropriate tentative model. Let’s build the model and see how the extrapolation performs.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="do">########### Example 2 </span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">Conversion_of_n_Heptane_to_Acetylene =</span> <span class="fu">c</span>(<span class="fl">49.0</span>, <span class="fl">50.2</span>, <span class="fl">50.5</span>, <span class="fl">48.5</span>, <span class="fl">47.5</span>, <span class="fl">44.5</span>, <span class="fl">28.0</span>, <span class="fl">31.5</span>, <span class="fl">34.5</span>, <span class="fl">35.0</span>, <span class="fl">38.0</span>, <span class="fl">38.5</span>, <span class="fl">15.0</span>, <span class="fl">17.0</span>, <span class="fl">20.5</span>, <span class="fl">29.5</span>),</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Reactor_Temperature_deg_C =</span> <span class="fu">c</span>(<span class="dv">1300</span>, <span class="dv">1300</span>, <span class="dv">1300</span>, <span class="dv">1300</span>, <span class="dv">1300</span>, <span class="dv">1300</span>, <span class="dv">1200</span>, <span class="dv">1200</span>, <span class="dv">1200</span>, <span class="dv">1200</span>, <span class="dv">1200</span>, <span class="dv">1200</span>, <span class="dv">1100</span>, <span class="dv">1100</span>, <span class="dv">1100</span>, <span class="dv">1100</span>),</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">Ratio_of_H2_to_n_Heptane_mole_ratio =</span> <span class="fu">c</span>(<span class="fl">7.5</span>, <span class="fl">9.0</span>, <span class="fl">11.0</span>, <span class="fl">13.5</span>, <span class="fl">17.0</span>, <span class="fl">23.0</span>, <span class="fl">5.3</span>, <span class="fl">7.5</span>, <span class="fl">11.0</span>, <span class="fl">13.5</span>, <span class="fl">17.0</span>, <span class="fl">23.0</span>, <span class="fl">5.3</span>, <span class="fl">7.5</span>, <span class="fl">11.0</span>, <span class="fl">17.0</span>),</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">Contact_Time_sec =</span> <span class="fu">c</span>(<span class="fl">0.0120</span>, <span class="fl">0.0120</span>, <span class="fl">0.0115</span>, <span class="fl">0.0130</span>, <span class="fl">0.0135</span>, <span class="fl">0.0120</span>, <span class="fl">0.0400</span>, <span class="fl">0.0380</span>, <span class="fl">0.0320</span>, <span class="fl">0.0260</span>, <span class="fl">0.0340</span>, <span class="fl">0.0410</span>, <span class="fl">0.0840</span>, <span class="fl">0.0980</span>, <span class="fl">0.0920</span>, <span class="fl">0.0860</span>)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Printing the dataframe</span></span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Conversion_of_n_Heptane_to_Acetylene Reactor_Temperature_deg_C
1                                 49.0                      1300
2                                 50.2                      1300
3                                 50.5                      1300
4                                 48.5                      1300
5                                 47.5                      1300
6                                 44.5                      1300
  Ratio_of_H2_to_n_Heptane_mole_ratio Contact_Time_sec
1                                 7.5           0.0120
2                                 9.0           0.0120
3                                11.0           0.0115
4                                13.5           0.0130
5                                17.0           0.0135
6                                23.0           0.0120</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For standardizing via Z scores</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>unit_norm<span class="ot">=</span><span class="cf">function</span>(x){</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  x<span class="ot">=</span>x<span class="sc">-</span><span class="fu">mean</span>(x)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">sqrt</span>(<span class="fu">length</span>(x)<span class="sc">-</span><span class="dv">1</span>)<span class="sc">*</span>x<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>)))</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>df2<span class="ot">=</span>df</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="co">#standardizing the regressors</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>df2[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]<span class="ot">=</span><span class="fu">apply</span>(df[,<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>],<span class="dv">2</span>,unit_norm)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>df2<span class="ot">=</span><span class="fu">data.frame</span>(df2)</span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(<span class="fu">cor</span>(df2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_7_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Observe the high correlations between Contact time and Reactor temperature</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df2<span class="sc">$</span>Reactor_Temperature_deg_C,df2<span class="sc">$</span>Contact_Time_sec,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_7_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>orig<span class="ot">=</span><span class="fu">names</span>(df2)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df2)<span class="ot">=</span><span class="fu">c</span>(<span class="st">'P'</span>,<span class="st">'t'</span>,<span class="st">'H'</span>,<span class="st">'C'</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>t2<span class="ot">=</span>df2<span class="sc">$</span>t<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>H2<span class="ot">=</span>df2<span class="sc">$</span>H<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>df2<span class="sc">$</span>C2<span class="ot">=</span>df2<span class="sc">$</span>C<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>RS<span class="ot">=</span><span class="fu">lm</span>(P<span class="sc">~</span>t<span class="sc">+</span>H<span class="sc">+</span>C<span class="sc">+</span>t<span class="sc">*</span>H<span class="sc">+</span>t<span class="sc">*</span>C<span class="sc">+</span>C<span class="sc">*</span>H<span class="sc">+</span>t2<span class="sc">+</span>H2<span class="sc">+</span>C2  ,df2)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(RS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = P ~ t + H + C + t * H + t * C + C * H + t2 + H2 + 
    C2, data = df2)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.3499 -0.3411  0.1297  0.5011  0.6720 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  35.8958     1.0916  32.884 5.26e-08 ***
t             4.0038     4.5087   0.888 0.408719    
H             2.7783     0.3071   9.048 0.000102 ***
C            -8.0423     6.0707  -1.325 0.233461    
t2          -12.5236    12.3238  -1.016 0.348741    
H2           -0.9727     0.3746  -2.597 0.040844 *  
C2          -11.5932     7.7063  -1.504 0.183182    
t:H          -6.4568     1.4660  -4.404 0.004547 ** 
t:C         -26.9804    21.0213  -1.283 0.246663    
H:C          -3.7681     1.6553  -2.276 0.063116 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.9014 on 6 degrees of freedom
Multiple R-squared:  0.9977,    Adjusted R-squared:  0.9943 
F-statistic: 289.7 on 9 and 6 DF,  p-value: 3.225e-07</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Crazy high VIF</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(RS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>there are higher-order terms (interactions) in this model
consider setting type = 'predictor'; see ?vif</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>          t           H           C          t2          H2          C2 
 375.247759    1.740631  680.280039 1762.575365    3.164318 1156.766284 
        t:H         t:C         H:C 
  31.037059 6563.345193   35.611286 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(RS,<span class="at">type=</span><span class="st">'predictor'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>GVIFs computed for predictors</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>           GVIF Df GVIF^(1/(2*Df)) Interacts With Other Predictors
t  51654.740516  6        2.470354           H, C       t2, H2, C2
H  51654.740516  6        2.470354           t, C       t2, H2, C2
C  51654.740516  6        2.470354           t, H       t2, H2, C2
t2  1762.575365  1       41.983037           --    t, H, C, H2, C2
H2     3.164318  1        1.778853           --    t, H, C, t2, C2
C2  1156.766284  1       34.011267           --    t, H, C, t2, H2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hidden extrapolation - be careful</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a grid to extrapolate over</span></span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>c_grid<span class="ot">=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">l=</span><span class="dv">100</span>)</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>t_grid<span class="ot">=</span><span class="fu">seq</span>(<span class="sc">-</span><span class="dv">2</span>,<span class="dv">2</span>,<span class="at">l=</span><span class="dv">100</span>)</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>g<span class="ot">=</span><span class="fu">expand.grid</span>(t_grid,c_grid)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding a fixed value of H=-0.6082179</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>g<span class="ot">=</span><span class="fu">cbind</span>(g,<span class="fu">rep</span>(<span class="sc">-</span><span class="fl">0.6082179</span>,<span class="fu">nrow</span>(g)))</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Adding H^2</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>g<span class="ot">=</span><span class="fu">cbind</span>(g,g<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Making new dataframe for predictions</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>new_dat<span class="ot">=</span><span class="fu">data.frame</span>(g)</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(new_dat)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"t"</span>,<span class="st">"C"</span>,<span class="st">"H"</span>,<span class="st">"t2"</span>,<span class="st">"C2"</span>,<span class="st">"H2"</span>)</span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicting the values on the grid</span></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>Z<span class="ot">=</span><span class="fu">predict.lm</span>(RS,new_dat)</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(c_grid,t_grid,<span class="fu">matrix</span>(Z, <span class="at">ncol =</span> <span class="fu">length</span>(t_grid)),<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">labcex=</span><span class="dv">2</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">*</span><span class="dv">2</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">*</span><span class="dv">2</span>)</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(df2<span class="sc">$</span>t,df2<span class="sc">$</span>C,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_7_files/figure-html/unnamed-chunk-4-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Notice that as soon as we leave the region with data, the response becomes negative. </span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Recall that it is a percentage and can't be negative</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a><span class="do">## This shows that mild extrapolation dangerous!</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="exm-7-3-2" class="theorem example">
<p><span class="theorem-title"><strong>Example 8.3</strong></span> Use the NFL data from the textbook - regress the number of wins against all variables. Check for multicollinearity. Propose a method to resolve the multicollinearity.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################################</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co">#              </span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co">#           NFL DATA EXAMPLE</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                        </span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="do">#####################################################</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span>MPV<span class="sc">::</span>table.b1</span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Note</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    y   x1   x2   x3   x4  x5   x6   x7   x8   x9
1  10 2113 1985 38.9 64.7   4  868 59.7 2205 1917
2  11 2003 2855 38.8 61.3   3  615 55.0 2096 1575
3  11 2957 1737 40.1 60.0  14  914 65.6 1847 2175
4  13 2285 2905 41.6 45.3  -4  957 61.4 1903 2476
5  10 2971 1666 39.2 53.8  15  836 66.1 1457 1866
6  11 2309 2927 39.7 74.1   8  786 61.0 1848 2339
7  10 2528 2341 38.1 65.4  12  754 66.1 1564 2092
8  11 2147 2737 37.0 78.3  -1  761 58.0 1821 1909
9   4 1689 1414 42.1 47.6  -3  714 57.0 2577 2001
10  2 2566 1838 42.3 54.2  -1  797 58.9 2476 2254
11  7 2363 1480 37.3 48.0  19  984 67.5 1984 2217
12 10 2109 2191 39.5 51.9   6  700 57.2 1917 1758
13  9 2295 2229 37.4 53.6  -5 1037 58.8 1761 2032
14  9 1932 2204 35.1 71.4   3  986 58.6 1709 2025
15  6 2213 2140 38.8 58.3   6  819 59.2 1901 1686
16  5 1722 1730 36.6 52.6 -19  791 54.4 2288 1835
17  5 1498 2072 35.3 59.3  -5  776 49.6 2072 1914
18  5 1873 2929 41.1 55.3  10  789 54.3 2861 2496
19  6 2118 2268 38.2 69.6   6  582 58.7 2411 2670
20  4 1775 1983 39.3 78.3   7  901 51.7 2289 2202
21  3 1904 1792 39.7 38.1  -9  734 61.9 2203 1988
22  3 1929 1606 39.7 68.8 -21  627 52.7 2592 2324
23  4 2080 1492 35.5 68.8  -8  722 57.8 2053 2550
24 10 2301 2835 35.3 74.1   2  683 59.7 1979 2110
25  6 2040 2416 38.7 50.0   0  576 54.9 2048 2628
26  8 2447 1638 39.9 57.1  -8  848 65.3 1786 1776
27  2 1416 2649 37.4 56.3 -22  684 43.8 2876 2524
28  0 1503 1503 39.3 47.0  -9  875 53.5 2560 2241</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       y                x1             x2             x3              x4       
 Min.   : 0.000   Min.   :1416   Min.   :1414   Min.   :35.10   Min.   :38.10  
 1st Qu.: 4.000   1st Qu.:1896   1st Qu.:1714   1st Qu.:37.38   1st Qu.:52.42  
 Median : 6.500   Median :2111   Median :2106   Median :38.85   Median :57.70  
 Mean   : 6.964   Mean   :2110   Mean   :2127   Mean   :38.64   Mean   :59.40  
 3rd Qu.:10.000   3rd Qu.:2303   3rd Qu.:2474   3rd Qu.:39.70   3rd Qu.:68.80  
 Max.   :13.000   Max.   :2971   Max.   :2929   Max.   :42.30   Max.   :78.30  
       x5               x6               x7              x8      
 Min.   :-22.00   Min.   : 576.0   Min.   :43.80   Min.   :1457  
 1st Qu.: -5.75   1st Qu.: 710.5   1st Qu.:54.77   1st Qu.:1848  
 Median :  1.00   Median : 787.5   Median :58.65   Median :2050  
 Mean   :  0.00   Mean   : 789.9   Mean   :58.16   Mean   :2110  
 3rd Qu.:  6.25   3rd Qu.: 869.8   3rd Qu.:61.10   3rd Qu.:2320  
 Max.   : 19.00   Max.   :1037.0   Max.   :67.50   Max.   :2876  
       x9      
 Min.   :1575  
 1st Qu.:1913  
 Median :2101  
 Mean   :2128  
 3rd Qu.:2328  
 Max.   :2670  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "y"  "x1" "x2" "x3" "x4" "x5" "x6" "x7" "x8" "x9"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"Wins"</span>,<span class="st">"RushY"</span>,<span class="st">"PassY"</span>,</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>            <span class="st">"PuntA"</span>,<span class="st">"FGP"</span>,<span class="st">"TurnD"</span>,</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>            <span class="st">"PenY"</span>,<span class="st">"PerR"</span>,<span class="st">"ORY"</span>,<span class="st">"OPY"</span>)</span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Wins            RushY          PassY          PuntA            FGP       
 Min.   : 0.000   Min.   :1416   Min.   :1414   Min.   :35.10   Min.   :38.10  
 1st Qu.: 4.000   1st Qu.:1896   1st Qu.:1714   1st Qu.:37.38   1st Qu.:52.42  
 Median : 6.500   Median :2111   Median :2106   Median :38.85   Median :57.70  
 Mean   : 6.964   Mean   :2110   Mean   :2127   Mean   :38.64   Mean   :59.40  
 3rd Qu.:10.000   3rd Qu.:2303   3rd Qu.:2474   3rd Qu.:39.70   3rd Qu.:68.80  
 Max.   :13.000   Max.   :2971   Max.   :2929   Max.   :42.30   Max.   :78.30  
     TurnD             PenY             PerR            ORY      
 Min.   :-22.00   Min.   : 576.0   Min.   :43.80   Min.   :1457  
 1st Qu.: -5.75   1st Qu.: 710.5   1st Qu.:54.77   1st Qu.:1848  
 Median :  1.00   Median : 787.5   Median :58.65   Median :2050  
 Mean   :  0.00   Mean   : 789.9   Mean   :58.16   Mean   :2110  
 3rd Qu.:  6.25   3rd Qu.: 869.8   3rd Qu.:61.10   3rd Qu.:2320  
 Max.   : 19.00   Max.   :1037.0   Max.   :67.50   Max.   :2876  
      OPY      
 Min.   :1575  
 1st Qu.:1913  
 Median :2101  
 Mean   :2128  
 3rd Qu.:2328  
 Max.   :2670  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_7_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>model<span class="ot">=</span><span class="fu">lm</span>(Wins<span class="sc">~</span>.,<span class="at">data=</span>df)</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="do">################## Multicollinearity</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="do">###### Corr plot</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(<span class="fu">cor</span>(df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_7_files/figure-html/unnamed-chunk-5-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="do">###### VIF</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   RushY    PassY    PuntA      FGP    TurnD     PenY     PerR      ORY 
4.827645 1.420161 2.126597 1.566107 1.924035 1.275979 5.414572 4.535643 
     OPY 
1.423390 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># recalculating via the X'X matrix</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span><span class="fu">model.matrix</span>(model)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 28 10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co">#standardizing</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>X2<span class="ot">=</span><span class="fu">apply</span>(X,<span class="dv">2</span>,<span class="cf">function</span>(x){(x<span class="sc">-</span><span class="fu">mean</span>(x))<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">sum</span>((x<span class="sc">-</span><span class="fu">mean</span>(x))<span class="sc">^</span><span class="dv">2</span>))}); <span class="fu">dim</span>(X2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 28 10</code></pre>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co">#replacing with column of ones again </span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>X2[,<span class="dv">1</span>]<span class="ot">=</span>X[,<span class="dv">1</span>]</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span>X2</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(<span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)       RushY       PassY       PuntA         FGP       TurnD 
 0.03571429  4.82764538  1.42016105  2.12659726  1.56610698  1.92403474 
       PenY        PerR         ORY         OPY 
 1.27597850  5.41457162  4.53564335  1.42338989 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># observe that</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>model<span class="ot">=</span><span class="fu">lm</span>(RushY<span class="sc">~</span>.,<span class="at">data=</span>df[,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>s<span class="ot">=</span><span class="fu">summary</span>(model)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a>(<span class="dv">1</span><span class="sc">-</span>s<span class="sc">$</span>r.squared)<span class="sc">^</span>(<span class="sc">-</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.827645</code></pre>
</div>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="do">###### Condition Number / Eigenvalue / Eigenvector</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span><span class="fu">model.matrix</span>(model)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(X)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 28  9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co">#standardizing</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>X2<span class="ot">=</span><span class="fu">apply</span>(X,<span class="dv">2</span>,<span class="cf">function</span>(x){(x<span class="sc">-</span><span class="fu">mean</span>(x))<span class="sc">/</span><span class="fu">sqrt</span>(<span class="fu">sum</span>((x<span class="sc">-</span><span class="fu">mean</span>(x))<span class="sc">^</span><span class="dv">2</span>))}); <span class="fu">dim</span>(X2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 28  9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>X2[,<span class="dv">1</span>]<span class="ot">=</span>X[,<span class="dv">1</span>]</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span>X2</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>ev<span class="ot">=</span><span class="fu">eigen</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X)</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>xev<span class="ot">=</span>ev<span class="sc">$</span>values</span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>condition_number<span class="ot">=</span><span class="fu">max</span>(xev)<span class="sc">/</span><span class="fu">min</span>(xev)</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>condition_number</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 215.646</code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(xev)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  0.1298424  0.3552922  0.5328487  0.6867363  0.8232325  1.2191453  1.6977743
[8]  2.5551283 28.0000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="co">#index of minimum eigenvalue</span></span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>minn<span class="ot">=</span><span class="fu">which.min</span>(xev)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>ev<span class="sc">$</span>vectors[,minn]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1.675215e-16 -2.109094e-01  2.615778e-01 -4.250523e-02  1.442042e-01
[6] -4.744502e-02 -6.475229e-01 -6.423531e-01  1.741790e-01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(ev<span class="sc">$</span>vectors)<span class="ot">=</span><span class="fu">names</span>(model<span class="sc">$</span>coefficients)</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>ev<span class="sc">$</span>vectors</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                     [,1]          [,2]          [,3]          [,4]
(Intercept)  1.000000e+00 -3.434947e-17  5.656001e-17 -1.332883e-16
PassY       -1.931673e-17  8.040232e-02  4.548137e-01  4.590825e-01
PuntA        1.733313e-16  2.847481e-02 -5.282204e-01  5.050070e-01
FGP          6.643674e-18 -1.498563e-02  6.360469e-01  4.652414e-02
TurnD        1.358771e-18 -4.436052e-01  9.254740e-02  4.700157e-01
PenY        -4.747269e-17 -3.638914e-01 -1.751243e-01 -1.469074e-01
PerR        -4.843659e-17 -5.401530e-01 -1.437332e-01  1.847958e-01
ORY         -9.496374e-17  5.364518e-01 -2.217080e-01  1.153371e-01
OPY          1.353659e-16  2.893988e-01  2.291129e-02  4.920345e-01
                     [,5]          [,6]          [,7]          [,8]
(Intercept)  1.753269e-17  4.497241e-17 -8.295922e-18 -9.898359e-17
PassY        3.414787e-01  5.912719e-01  2.410126e-01  8.451722e-02
PuntA        2.835269e-01  3.495064e-02 -3.785463e-01  4.145009e-01
FGP         -1.687798e-01 -2.417375e-01 -6.140270e-01  3.567854e-01
TurnD       -9.900605e-03 -1.291665e-01 -2.199263e-01 -6.984198e-01
PenY        -5.210958e-01  6.822653e-01 -2.680418e-01  6.487362e-02
PerR        -4.221330e-02 -3.015818e-01  2.274534e-01  2.994520e-01
ORY         -9.681973e-02  2.538335e-02 -3.566234e-01 -3.161428e-01
OPY         -7.012299e-01 -1.302810e-01  3.499387e-01  1.101525e-01
                     [,9]
(Intercept) -1.675215e-16
PassY       -2.109094e-01
PuntA        2.615778e-01
FGP         -4.250523e-02
TurnD        1.442042e-01
PenY        -4.744502e-02
PerR        -6.475229e-01
ORY         -6.423531e-01
OPY          1.741790e-01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># names(model$coefficients)[abs(round(ev$vectors[,minn],1))&gt;0]</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(ev<span class="sc">$</span>vectors[,minn],<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)       PassY       PuntA         FGP       TurnD        PenY 
        0.0        -0.2         0.3         0.0         0.1         0.0 
       PerR         ORY         OPY 
       -0.6        -0.6         0.2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="co"># What should we do?</span></span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>RushDiff<span class="ot">=</span>(df<span class="sc">$</span>RushY<span class="sc">-</span>df<span class="sc">$</span>ORY)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a><span class="co"># df$RushDiffPer=df$RushY/(df$RushY+df$ORY)</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a><span class="co"># paste(names(df),collapse='+')</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>model<span class="ot">=</span><span class="fu">lm</span>(Wins<span class="sc">~</span>PassY<span class="sc">+</span>PuntA<span class="sc">+</span>FGP<span class="sc">+</span>TurnD<span class="sc">+</span>PenY<span class="sc">+</span>PerR<span class="sc">+</span>OPY<span class="sc">+</span>RushDiff,<span class="at">data=</span>df)</span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Wins ~ PassY + PuntA + FGP + TurnD + PenY + PerR + 
    OPY + RushDiff, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.6976 -0.8333  0.0823  0.7845  2.7968 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -6.5581613 12.7312595  -0.515 0.612409    
PassY        0.0037880  0.0008196   4.622 0.000186 ***
PuntA       -0.0208741  0.2052446  -0.102 0.920057    
FGP          0.0249704  0.0407274   0.613 0.547073    
TurnD       -0.0029187  0.0465199  -0.063 0.950628    
PenY         0.0021519  0.0031747   0.678 0.506053    
PerR         0.1388836  0.1504572   0.923 0.367542    
OPY         -0.0023446  0.0012749  -1.839 0.081587 .  
RushDiff     0.0023289  0.0011199   2.080 0.051347 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.822 on 19 degrees of freedom
Multiple R-squared:  0.8071,    Adjusted R-squared:  0.7258 
F-statistic: 9.935 on 8 and 19 DF,  p-value: 2.305e-05</code></pre>
</div>
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(<span class="fu">cor</span>(df))</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   PassY    PuntA      FGP    TurnD     PenY     PerR      OPY RushDiff 
1.360875 1.347757 1.514088 1.914974 1.230133 5.347319 1.162295 4.774672 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>model<span class="ot">=</span><span class="fu">lm</span>(Wins<span class="sc">~</span>PassY<span class="sc">+</span>PuntA<span class="sc">+</span>FGP<span class="sc">+</span>TurnD<span class="sc">+</span>PenY<span class="sc">+</span>OPY<span class="sc">+</span>RushDiff,<span class="at">data=</span>df)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Wins ~ PassY + PuntA + FGP + TurnD + PenY + OPY + 
    RushDiff, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.9325 -0.9011 -0.1062  0.9020  3.0495 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.8643720  9.8338943   0.088 0.930833    
PassY        0.0035079  0.0007586   4.624 0.000164 ***
PuntA        0.0143946  0.2009097   0.072 0.943594    
FGP          0.0156562  0.0393115   0.398 0.694659    
TurnD        0.0114784  0.0436650   0.263 0.795336    
PenY         0.0023024  0.0031587   0.729 0.474510    
OPY         -0.0021934  0.0012596  -1.741 0.096996 .  
RushDiff     0.0031495  0.0006787   4.641 0.000158 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.815 on 20 degrees of freedom
Multiple R-squared:  0.7984,    Adjusted R-squared:  0.7279 
F-statistic: 11.32 on 7 and 20 DF,  p-value: 9.485e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(<span class="fu">cor</span>(df))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_7_files/figure-html/unnamed-chunk-5-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   PassY    PuntA      FGP    TurnD     PenY      OPY RushDiff 
1.174416 1.301051 1.421150 1.699715 1.226886 1.143100 1.766523 </code></pre>
</div>
</div>
<p>There are four primary sources/causes of multicollinearity :</p>
<ul>
<li>The data collection method employed: In this case, some of the variables are typically confounded and/or the experiment/study was not well-designed.</li>
<li>Constraints on the model or in the population: Sometimes, only certain combinations of levels of variables can be observed together.</li>
<li>Model specification: Sometimes you have two or more variables in your model that are measuring the same thing.</li>
<li>An overdefined model: You have too many variables in your model.</li>
</ul>
<p>Make sure to check for each of these. Sometimes, regression coefficients have the wrong sign. This is likely due to one of the following:</p>
<ul>
<li>The range of some of the regressors is too small – if the range of some of the regressors is too small, then the variance of <span class="math inline">\(\hat\beta\)</span> is high.</li>
<li>Important regressors have not been included in the model.</li>
<li><strong>Multicollinearity is present.</strong></li>
<li>Computational errors have been made.</li>
</ul>
<p>Multicollinearity can be cured with:</p>
<ol type="1">
<li>more data (lol often not possible), 2, model re-specification: Can you include a function of the variables that preserves the information, but aren’t linearly dependent? Can you remove a variable?</li>
<li>Or, a modified version of regression, one of Lasso, ridge or elastic net regression.</li>
</ol>
</section>
</section>
<section id="homework-questions" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="homework-questions"><span class="header-section-number">8.3</span> Homework questions</h2>
<p>Complete the Chapter 9 textbook questions.</p>
<div id="exr-8-4-1" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 8.1</strong></span> Check for multicollinearity in all of our past examples.</p>
</div>
<div id="exr-8-4-2" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 8.2</strong></span> Summarize the 3 multicollinearity diagnostics.</p>
</div>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-Monette1992" class="csl-entry" role="listitem">
Fox, John, and Georges Monette. 1992. <span>“Generalized Collinearity Diagnostics.”</span> <em>Journal of the American Statistical Association</em> 87 (417): 178–83. <a href="https://doi.org/10.1080/01621459.1992.10475190">https://doi.org/10.1080/01621459.1992.10475190</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Unit_6.html" class="pagination-link" aria-label="Leverage and Influence">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Leverage and Influence</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Unit_8.html" class="pagination-link" aria-label="Variable/Model Selection">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Variable/Model Selection</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>