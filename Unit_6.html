<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.53">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>7&nbsp; Leverage and Influence – Math 3330: Regression Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Unit_7.html" rel="next">
<link href="./Unit_5.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Unit_6.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Leverage and Influence</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Math 3330: Regression Notes</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Review material</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Linear Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Residual analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Transformations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Indicator Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_6.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Leverage and Influence</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Multicollinearity</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Variable/Model Selection</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Robust Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Appendix_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Introduction to R software</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#influential-observations-and-leverage" id="toc-influential-observations-and-leverage" class="nav-link active" data-scroll-target="#influential-observations-and-leverage"><span class="header-section-number">7.1</span> Influential observations and leverage</a></li>
  <li><a href="#cooks-distance" id="toc-cooks-distance" class="nav-link" data-scroll-target="#cooks-distance"><span class="header-section-number">7.2</span> Cook’s Distance</a></li>
  <li><a href="#data-depth-functions" id="toc-data-depth-functions" class="nav-link" data-scroll-target="#data-depth-functions"><span class="header-section-number">7.3</span> Data depth functions</a></li>
  <li><a href="#homework-questions" id="toc-homework-questions" class="nav-link" data-scroll-target="#homework-questions"><span class="header-section-number">7.4</span> Homework questions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Leverage and Influence</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="influential-observations-and-leverage" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="influential-observations-and-leverage"><span class="header-section-number">7.1</span> Influential observations and leverage</h2>
<p>Recall that violations of model assumptions are more likely at remote points, and these violations may be hard to detect from inspection of the ordinary residuals because their residuals will usually be smaller. Points that are outlying in the <span class="math inline">\(x\)</span>-direction are known as <strong>leverage points</strong>. <strong>Influential points</strong> are not only remote in terms of the specific values for the regressors, but the observed response is not consistent with the values that would be predicted based on only the other data points. It is important to find these influential points and assess their impact on the model.</p>
<p>Below gives an example of an influential point. The seventh point in the data set is outlying in the <span class="math inline">\(x\)</span>-direction, and it’s response value is not consistent with the regression line based on the other six observations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">330</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">c</span>(<span class="fu">rnorm</span>(<span class="dv">6</span>),<span class="fl">2.5</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>y<span class="ot">=</span>x<span class="sc">*</span><span class="dv">2</span><span class="sc">+</span><span class="dv">3</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">7</span>]<span class="ot">=</span>y[<span class="dv">7</span>]<span class="sc">+</span><span class="dv">7</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,y,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>a<span class="ot">=</span><span class="fu">lm</span>(y<span class="sc">~</span>x)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(a<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>x<span class="sc">*</span>a<span class="sc">$</span>coefficients[<span class="dv">2</span>],<span class="at">add=</span>T,<span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(x<span class="sc">*</span><span class="dv">2</span><span class="sc">+</span><span class="dv">3</span>,<span class="at">add=</span>T,<span class="at">col=</span><span class="dv">2</span>,<span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>a2<span class="ot">=</span><span class="fu">lm</span>(y[<span class="sc">-</span><span class="dv">7</span>]<span class="sc">~</span>x[<span class="sc">-</span><span class="dv">7</span>])</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(a2<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>x<span class="sc">*</span>a2<span class="sc">$</span>coefficients[<span class="dv">2</span>],<span class="at">add=</span>T,<span class="at">lwd=</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">'blue'</span>,<span class="at">lty=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_6_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>a<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)           x 
   2.048937    3.979977 </code></pre>
</div>
</div>
<p>Sometimes we find that a regression coefficient may have a sign that does not make engineering or scientific sense, a regressor known to be important may be statistically insignificant, or a model that fits the data well and that is logical from an application – environment perspective may produce poor predictions. These situations may be the result of one or, perhaps, a few influential observations.</p>
<p>Recall the hat matrix <span class="math inline">\(H=X(X^\top X)^{-1}X^\top\)</span>, as well as that it holds that <span class="math inline">\({\textrm{Var}}\left[\hat\epsilon\right]=\sigma^2(I-H)\)</span> and <span class="math inline">\({\textrm{Var}}\left[\hat Y\right]=\sigma^2 H\)</span>. Note that <span class="math inline">\(h_{ij}\)</span> can be interpreted as the amount of leverage exerted by the <span class="math inline">\(ith\)</span> observation <span class="math inline">\(y_i\)</span> on the <span class="math inline">\(jth\)</span> fitted value <span class="math inline">\(\hat y_j\)</span>. We usually focus attention on the diagonal elements <span class="math inline">\(h_{ii}\)</span> of the hat matrix <span class="math inline">\(H\)</span>, which may be written as <span class="math display">\[h_{ii}=x_i^\top (X^\top X)^{-1} x_i,\]</span> where <span class="math inline">\(X_i^\top\)</span> is the <span class="math inline">\(i\)</span>th row of <span class="math inline">\(X\)</span>. The hat matrix diagonal is a standardized measure of the distance of the <span class="math inline">\(i\)</span>th observation from the center (or centroid) of the <span class="math inline">\(x\)</span>-space. Therefore, large values of <span class="math inline">\(h_{ii}\)</span> implies that <span class="math inline">\(x_i\)</span> is potentially influential. Furthermore, note that <span class="math inline">\(rank(H)=p\)</span> since the trace of an idempotent matrix equals its rank, which means that <span class="math inline">\(\bar h= p/n\)</span>. It follows that values well above <span class="math inline">\(p/n\)</span>, say <span class="math inline">\(h_{ii}&gt;2p/n\)</span>, can be called leverage points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span><span class="fu">as.matrix</span>(<span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">length</span>(x)),x))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span><span class="fu">model.matrix</span>(a)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>hat<span class="ot">=</span>X<span class="sc">%*%</span><span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X)<span class="sc">%*%</span><span class="fu">t</span>(X)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(hat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        1         2         3         4         5         6         7 
0.2027453 0.2288737 0.2596869 0.1751432 0.1735495 0.3887329 0.5712686 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>p<span class="ot">=</span><span class="dv">2</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="dv">7</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(hat)<span class="sc">&gt;</span><span class="dv">2</span><span class="sc">*</span>p<span class="sc">/</span>n</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    1     2     3     4     5     6     7 
FALSE FALSE FALSE FALSE FALSE FALSE FALSE </code></pre>
</div>
</div>
</section>
<section id="cooks-distance" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="cooks-distance"><span class="header-section-number">7.2</span> Cook’s Distance</h2>
<p>Cook’s Distance is one way to incorporate both the <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> values into an outlyingness measure:</p>
<p><span class="math display">\[
D_i\left(X^{\top} X, p, MSE\right) \equiv D_i=\frac{\left(\hat{\beta}_{(i)}-\hat{\beta}\right)^{\top} X^{\top} X\left(\hat{\beta}_{(i)}-\hat{\beta}\right)}{p MSE}, \  i=\in [n],
\]</span> where <span class="math inline">\(\hat{\beta}_{(i)}\)</span> is the OLS estimator with the <span class="math inline">\(i\)</span>th point removed.Large values of Cook’s distance signal a leverage point.</p>
<p>What do we mean by a large value? We can compare <span class="math inline">\(D_i\)</span> to the 50th percentile of the <span class="math inline">\(F_{p,n-p}\)</span> distribution. This gives the interpretation that deleting the <span class="math inline">\(i\)</span>th point moves the estimate to the boundary of a 50% confidence interval. <span class="math inline">\(F_{p,n-p}\approx 1\)</span>, and so usually take <span class="math inline">\(D_i\geq 1\)</span> to be large.</p>
<p>Observe that <span class="math display">\[
D_i=\frac{r_i^2}{p} \frac{\operatorname{Var}\left(\hat{Y}_i\right)}{\operatorname{Var}\left(\hat\epsilon_i\right)}=\frac{r_i^2}{p} \frac{h_{i i}}{1-h_{i i}}, \quad i=1,2, \ldots, n,\]</span> where it is important to recall that <span class="math inline">\(r_i\)</span> is the studentized residual. Now, the quantity <span class="math inline">\(\frac{h_{i i}}{1-h_{i i}}\)</span> can be shown to be the distance from the vector <span class="math inline">\(x_i\)</span> to the centroid of the remaining data. Therefore, <span class="math inline">\(D_i\)</span> is the product of outlyingness in both the <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> directions. We may also write <span class="math inline">\(D_i\)</span> as <span class="math display">\[D_i=\frac{\left\lVert\hat{y}_{(i)}-\hat{y}\right\rVert^2}{p MSE},\]</span> which allows for the interpretation: The Cook’s distance of the <span class="math inline">\(i\)</span>th point is the normalized distance between the fitted value with and without point <span class="math inline">\(i\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#cut off</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cooks.distance</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           1            2            3            4            5            6 
0.1708029420 0.2516095165 0.0180669722 0.0009569213 0.0011772793 0.2002829110 
           7 
3.3311562309 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cooks.distance</span>(a)<span class="sc">&gt;</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    1     2     3     4     5     6     7 
FALSE FALSE FALSE FALSE FALSE FALSE  TRUE </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(y,x))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">cooks.distance</span>(a)<span class="sc">&gt;</span><span class="dv">1</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   y   x
7 15 2.5</code></pre>
</div>
</div>
</section>
<section id="data-depth-functions" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="data-depth-functions"><span class="header-section-number">7.3</span> Data depth functions</h2>
<p>A more modern approach and nonparametric approach to outlier detection is through data depth. A data depth function gives meaning to centrality, order and outlyingness in spaces beyond <span class="math inline">\(\mathbb{R}\)</span>. A data depth function is a function which takes a sample and a point, and returns how central the point is, with respect to the sample. Depth functions can be written as <span class="math inline">\({\textrm{D}}\colon \mathbb{R}^{d}\times \text{Sample} \rightarrow \mathbb{R}^+\)</span>. There are different definitions of depth, so I will give a few.</p>
<p>Let <span class="math inline">\(S^{d-1}= \{x\in \mathbb{R}^{d}\colon \left\lVert x\right\rVert=1\}\)</span> be the set of unit vectors in <span class="math inline">\(\mathbb{R}^{d}\)</span>, let <span class="math inline">\(\mathbb{X}_{n}=\{(Y_1,X_{1,1},\ldots,X_{1,p-1}),\ldots, (Y_n,X_{n,1},\ldots,X_{n,p-1})\}\)</span>, let <span class="math inline">\(\mathbb{X}_{n}^\top u\)</span> be <span class="math inline">\(\mathbb{X}_{n}\)</span> projected onto <span class="math inline">\(u\in S^{d-1}\)</span> and let <span class="math inline">\(\widehat F_u\)</span> be the empirical CDF with respect to <span class="math inline">\(\mathbb{X}_{n}^\top u\)</span>.</p>
<div id="dfn-7-1-1">
<p>The halfspace depth <span class="math inline">\({\textrm{D}}_H\)</span> of a point <span class="math inline">\(x\in \mathbb{R}^{d}\)</span> with respect to a distribution <span class="math inline">\(F\)</span> over <span class="math inline">\(\mathbb{R}^{d}\)</span> is <span class="math display">\[
{\textrm{D}}_H(x;F)=\inf_{u\in S^{d-1}} \widehat F_u(x^\top u)\wedge (1-F_u(x^\top u))=\inf_{u\in S^{d-1}}
F_u(x^\top u).
\]</span></p>
</div>
<div id="dfn-7-1-2">
<p>Given a translation and scale equivariant location estimate <span class="math inline">\(\mu\)</span> and a translation and scale invariant scale estimate <span class="math inline">\(\sigma\)</span>, the outlyingness at <span class="math inline">\(x\in\mathbb{R}^{d}\)</span> is defined as <span class="math display">\[O(x)=\sup _{u\in S^{d-1}} \frac{\left|x^\top u-\mu(\mathbb{X}_{n}^\top u)\right|}{\sigma(\mathbb{X}_{n}^\top u)}.\]</span> Define projection depth as <span class="math display">\[{\textrm{D}}_p(x)=(1+O(x))^{-1}.\]</span></p>
</div>
<p>In order to detect outliers, we look for observations that have low depth. See, continuing our toy example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages('ddalpha')</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>depths<span class="ot">=</span>ddalpha<span class="sc">::</span><span class="fu">depth.projection</span>(<span class="fu">cbind</span>(x,y),<span class="fu">cbind</span>(x,y))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>depths</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.276409011 0.255272074 0.500000000 0.973754328 0.973046927 0.338954415
[7] 0.002525114</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>depths<span class="sc">&lt;</span><span class="fl">0.015</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE</code></pre>
</div>
</div>
<div id="exm-6-3-1" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.1</strong></span> Recall example <a href="Unit_5.html#exm-6-4-1" class="quarto-xref">Example&nbsp;<span>6.6</span></a>. Check for leverage and influential points in the proposed models. Compute all three measures of leverage/influence/outlyingness introduced in this lesson. What do you find?</p>
</div>
<p>I will load in the data below:</p>
<p>We can now analyze the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># df=df[df$Lotsize&lt;70000,]</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>custom_palette <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#1f77b4"</span>, <span class="st">"#ff7f0e"</span>, <span class="st">"#2ca02c"</span>, <span class="st">"#d62728"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#9467bd"</span>, <span class="st">"#8c564b"</span>, <span class="st">"#e377c2"</span>, <span class="st">"#7f7f7f"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#bcbd22"</span>, <span class="st">"#17becf"</span>, <span class="st">"#393b79"</span>, </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#8c6d31"</span>, <span class="st">"#9c9ede"</span>, <span class="st">"#637939"</span>, <span class="st">"#eb348f"</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Our model from the previous lecture</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span>df_clean2[<span class="sc">-</span><span class="fu">which.max</span>(df_clean2<span class="sc">$</span>Lotsize),]</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span>df[df<span class="sc">$</span>Lotsize<span class="sc">&gt;</span><span class="dv">0</span>,]</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'district_3'</span>]<span class="ot">=</span>df[<span class="st">'District'</span>]<span class="sc">==</span><span class="dv">3</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'district_4'</span>]<span class="ot">=</span>df[<span class="st">'District'</span>]<span class="sc">==</span><span class="dv">4</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'district_15'</span>]<span class="ot">=</span>df[<span class="st">'District'</span>]<span class="sc">==</span><span class="dv">15</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>model2<span class="ot">=</span><span class="fu">lm</span>(Sale_price<span class="sc">~</span>.<span class="sc">-</span>district_3<span class="sc">-</span>district_4<span class="sc">-</span>district_15<span class="sc">+</span>district_3<span class="sc">*</span>Year_Built<span class="sc">+</span>district_3<span class="sc">*</span>Lotsize<span class="sc">+</span>district_4<span class="sc">*</span>Lotsize<span class="sc">+</span>district_4<span class="sc">*</span>Year_Built<span class="sc">+</span>district_15<span class="sc">*</span>Year_Built<span class="sc">+</span>district_15<span class="sc">*</span>Lotsize<span class="sc">+</span>district_3<span class="sc">*</span>Fin_sqft<span class="sc">+</span>district_4<span class="sc">*</span>Fin_sqft<span class="sc">+</span>district_15<span class="sc">*</span>Fin_sqft,df)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute residuals</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>student_res2<span class="ot">=</span><span class="fu">rstudent</span>(model2)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>summ2<span class="ot">=</span><span class="fu">summary</span>(model2); summ2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Sale_price ~ . - district_3 - district_4 - district_15 + 
    district_3 * Year_Built + district_3 * Lotsize + district_4 * 
    Lotsize + district_4 * Year_Built + district_15 * Year_Built + 
    district_15 * Lotsize + district_3 * Fin_sqft + district_4 * 
    Fin_sqft + district_15 * Fin_sqft, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-303393  -24422    -942   23352  719561 

Coefficients:
                             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                -1.129e+06  3.625e+04 -31.143  &lt; 2e-16 ***
District                    5.695e+03  7.701e+01  73.950  &lt; 2e-16 ***
ExtwallBlock               -3.944e+03  3.688e+03  -1.069 0.284879    
ExtwallBrick                6.725e+03  7.245e+02   9.281  &lt; 2e-16 ***
ExtwallFiber-Cement         3.847e+04  3.754e+03  10.246  &lt; 2e-16 ***
ExtwallFrame               -4.986e+03  9.786e+02  -5.095 3.51e-07 ***
ExtwallMasonry / Frame      3.751e+03  1.711e+03   2.192 0.028404 *  
ExtwallPrem Wood            1.894e+04  5.596e+03   3.385 0.000714 ***
ExtwallStone                1.162e+04  1.531e+03   7.594 3.22e-14 ***
ExtwallStucco               3.514e+03  2.149e+03   1.635 0.102070    
Stories1                    3.684e+02  1.047e+04   0.035 0.971935    
Stories1.5                  1.317e+04  1.046e+04   1.259 0.207954    
Stories2                    1.451e+04  1.042e+04   1.392 0.163802    
Year_Built                  4.629e+02  1.606e+01  28.823  &lt; 2e-16 ***
Fin_sqft                    6.048e+01  1.080e+00  55.986  &lt; 2e-16 ***
Units1                      5.778e+04  7.389e+03   7.820 5.48e-15 ***
Units2                     -9.774e+03  7.386e+03  -1.323 0.185735    
Units3                     -4.087e+04  7.940e+03  -5.147 2.67e-07 ***
Bdrms0                      1.155e+05  1.854e+04   6.227 4.82e-10 ***
Bdrms1                      7.894e+04  1.016e+04   7.766 8.41e-15 ***
Bdrms2                      8.331e+04  9.086e+03   9.170  &lt; 2e-16 ***
Bdrms3                      8.791e+04  9.033e+03   9.733  &lt; 2e-16 ***
Bdrms4                      7.905e+04  9.001e+03   8.782  &lt; 2e-16 ***
Bdrms5                      7.507e+04  9.002e+03   8.340  &lt; 2e-16 ***
Bdrms6                      6.149e+04  9.006e+03   6.828 8.80e-12 ***
Bdrms7                      2.462e+04  9.572e+03   2.573 0.010100 *  
Bdrms8                      1.242e+04  1.008e+04   1.233 0.217672    
Fbath0                     -1.936e+04  1.388e+04  -1.395 0.162964    
Fbath1                     -1.050e+04  9.795e+03  -1.072 0.283695    
Fbath2                      7.289e+03  9.751e+03   0.748 0.454721    
Fbath3                      2.935e+04  9.641e+03   3.044 0.002339 ** 
Fbath4                      6.757e+04  1.025e+04   6.595 4.35e-11 ***
Lotsize                     1.419e+00  1.131e-01  12.545  &lt; 2e-16 ***
Sale_date                   4.839e+00  2.603e-01  18.587  &lt; 2e-16 ***
district_3TRUE              9.189e+05  1.373e+05   6.693 2.23e-11 ***
district_4TRUE              1.088e+06  2.504e+05   4.346 1.39e-05 ***
district_15TRUE             4.475e+05  1.212e+05   3.692 0.000223 ***
Year_Built:district_3TRUE  -5.100e+02  7.205e+01  -7.078 1.51e-12 ***
Lotsize:district_3TRUE      1.227e+01  4.803e-01  25.549  &lt; 2e-16 ***
Lotsize:district_4TRUE     -3.796e+00  1.569e+00  -2.420 0.015512 *  
Year_Built:district_4TRUE  -5.558e+02  1.306e+02  -4.255 2.09e-05 ***
Year_Built:district_15TRUE -2.829e+02  6.295e+01  -4.493 7.05e-06 ***
Lotsize:district_15TRUE     3.140e+00  1.213e+00   2.589 0.009620 ** 
Fin_sqft:district_3TRUE     6.621e+01  1.517e+00  43.639  &lt; 2e-16 ***
Fin_sqft:district_4TRUE    -2.049e+01  4.181e+00  -4.901 9.61e-07 ***
Fin_sqft:district_15TRUE   -1.161e+01  3.163e+00  -3.672 0.000241 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 43870 on 24429 degrees of freedom
Multiple R-squared:  0.7301,    Adjusted R-squared:  0.7296 
F-statistic:  1468 on 45 and 24429 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>summ2<span class="sc">$</span>adj.r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7295574</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute residual analysis</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>MSE2<span class="ot">=</span>summ2<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(student_res2,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_6_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(student_res2,<span class="at">freq=</span>F,<span class="at">breaks=</span><span class="dv">100</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x,<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">add=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_6_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hist(student_res2,freq=F,breaks=100)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># curve(dnorm(x,0,1),add=T)</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model2<span class="sc">$</span>fitted.values,student_res2,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_6_files/figure-html/unnamed-chunk-6-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First measure</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span><span class="fu">model.matrix</span>(model2)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>hat<span class="ot">=</span>X<span class="sc">%*%</span><span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X)<span class="sc">%*%</span><span class="fu">t</span>(X)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># diag(hat)</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>p<span class="ot">=</span><span class="fu">ncol</span>(X)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="fu">nrow</span>(X)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>out_1<span class="ot">=</span><span class="fu">which</span>(<span class="fu">diag</span>(hat)<span class="sc">&gt;</span><span class="dv">2</span><span class="sc">*</span>p<span class="sc">/</span>n)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">sort</span>(<span class="fu">diag</span>(hat)[out_1]))</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">2</span><span class="sc">*</span>p<span class="sc">/</span>n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_6_files/figure-html/unnamed-chunk-6-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I would still look at those after the elbow</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Cooks distances</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>CDS<span class="ot">=</span><span class="fu">cooks.distance</span>(model2)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">sort</span>(CDS,T)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_6_files/figure-html/unnamed-chunk-6-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(CDS<span class="sc">&gt;</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>22532 
22398 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(CDS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.075144</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df[CDS<span class="sc">&gt;</span><span class="dv">1</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      District Extwall Stories Year_Built Fin_sqft Units Bdrms Fbath Lotsize
22532        3   Block       1       1960     4323     1     4     3   72480
      Sale_date Sale_price District District District
22532     17713    1250000     TRUE    FALSE    FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I would still look at those two values that are far from the other distances</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># I would still look at those before the elbow</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># We may only look at numeric values for depth functions - so we can either</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>numer<span class="ot">=</span><span class="cn">NULL</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">names</span>(df)){</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.factor</span>(df[<span class="dv">1</span>,i])){</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    numer<span class="ot">=</span><span class="fu">c</span>(numer,i)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>numer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "District"    "Year_Built"  "Fin_sqft"    "Lotsize"     "Sale_date"  
[6] "Sale_price"  "district_3"  "district_4"  "district_15"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df_mat<span class="ot">=</span><span class="fu">as.matrix</span>(df[,numer])</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>depths<span class="ot">=</span>ddalpha<span class="sc">::</span><span class="fu">depth.projection</span>(df_mat,df_mat)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(depths<span class="sc">&lt;</span><span class="fl">0.1</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]   5 130 326 471 473 593 637 669 673 735</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">sort</span>(depths,F)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_6_files/figure-html/unnamed-chunk-6-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice there is a crack around 0.035, I would look at those observations</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">sort</span>(depths,F)[<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_6_files/figure-html/unnamed-chunk-6-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">sort</span>(depths,F))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_6_files/figure-html/unnamed-chunk-6-8.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OR </span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>depths<span class="ot">=</span>ddalpha<span class="sc">::</span><span class="fu">depth.projection</span>(<span class="fu">cbind</span>(X,df<span class="sc">$</span>Sale_price),<span class="fu">cbind</span>(X,df<span class="sc">$</span>Sale_price))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(depths<span class="sc">&lt;</span><span class="fl">0.1</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  3  4  5  7 13 15 16 17 20 22</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">sort</span>(depths,F)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_6_files/figure-html/unnamed-chunk-6-9.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.max</span>(<span class="fu">diag</span>(hat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>22532 
22398 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.max</span>(CDS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>22532 
22398 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(depths)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 22398</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hugely expensive home!</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">which.min</span>(depths),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      District Extwall Stories Year_Built Fin_sqft Units Bdrms Fbath Lotsize
22532        3   Block       1       1960     4323     1     4     3   72480
      Sale_date Sale_price District District District
22532     17713    1250000     TRUE    FALSE    FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">which.max</span>(CDS),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      District Extwall Stories Year_Built Fin_sqft Units Bdrms Fbath Lotsize
22532        3   Block       1       1960     4323     1     4     3   72480
      Sale_date Sale_price District District District
22532     17713    1250000     TRUE    FALSE    FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">which.max</span>(<span class="fu">diag</span>(hat)),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      District Extwall Stories Year_Built Fin_sqft Units Bdrms Fbath Lotsize
22532        3   Block       1       1960     4323     1     4     3   72480
      Sale_date Sale_price District District District
22532     17713    1250000     TRUE    FALSE    FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>model3<span class="ot">=</span><span class="fu">lm</span>(Sale_price<span class="sc">~</span>.<span class="sc">-</span>district_3<span class="sc">-</span>district_4<span class="sc">-</span>district_15<span class="sc">+</span>district_3<span class="sc">*</span>Year_Built<span class="sc">+</span>district_3<span class="sc">*</span>Lotsize<span class="sc">+</span>district_4<span class="sc">*</span>Lotsize<span class="sc">+</span>district_4<span class="sc">*</span>Year_Built<span class="sc">+</span>district_15<span class="sc">*</span>Year_Built<span class="sc">+</span>district_15<span class="sc">*</span>Lotsize<span class="sc">+</span>district_3<span class="sc">*</span>Fin_sqft<span class="sc">+</span>district_4<span class="sc">*</span>Fin_sqft<span class="sc">+</span>district_15<span class="sc">*</span>Fin_sqft,df[<span class="sc">-</span>(<span class="fu">order</span>(depths)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]),])</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co"># OR </span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>model4<span class="ot">=</span><span class="fu">lm</span>(Sale_price<span class="sc">~</span>.<span class="sc">-</span>district_3<span class="sc">-</span>district_4<span class="sc">-</span>district_15<span class="sc">+</span>district_3<span class="sc">*</span>Year_Built<span class="sc">+</span>district_3<span class="sc">*</span>Lotsize<span class="sc">+</span>district_4<span class="sc">*</span>Lotsize<span class="sc">+</span>district_4<span class="sc">*</span>Year_Built<span class="sc">+</span>district_15<span class="sc">*</span>Year_Built<span class="sc">+</span>district_15<span class="sc">*</span>Lotsize<span class="sc">+</span>district_3<span class="sc">*</span>Fin_sqft<span class="sc">+</span>district_4<span class="sc">*</span>Fin_sqft<span class="sc">+</span>district_15<span class="sc">*</span>Fin_sqft,df[<span class="sc">-</span>(<span class="fu">order</span>(CDS,<span class="at">decreasing =</span> T)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]),])</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>s<span class="ot">=</span><span class="fu">summary</span>(model3)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Sale_price ~ . - district_3 - district_4 - district_15 + 
    district_3 * Year_Built + district_3 * Lotsize + district_4 * 
    Lotsize + district_4 * Year_Built + district_15 * Year_Built + 
    district_15 * Lotsize + district_3 * Fin_sqft + district_4 * 
    Fin_sqft + district_15 * Fin_sqft, data = df[-(order(depths)[1:100]), 
    ])

Residuals:
    Min      1Q  Median      3Q     Max 
-275464  -24296   -1130   23011  413904 

Coefficients:
                             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                -1.059e+06  3.584e+04 -29.552  &lt; 2e-16 ***
District                    5.683e+03  7.314e+01  77.696  &lt; 2e-16 ***
ExtwallBlock               -2.205e+03  3.507e+03  -0.629 0.529622    
ExtwallBrick                6.891e+03  6.909e+02   9.973  &lt; 2e-16 ***
ExtwallFiber-Cement         4.232e+04  3.579e+03  11.824  &lt; 2e-16 ***
ExtwallFrame               -4.552e+03  9.310e+02  -4.890 1.02e-06 ***
ExtwallMasonry / Frame      4.251e+03  1.637e+03   2.597 0.009404 ** 
ExtwallPrem Wood            2.150e+04  5.350e+03   4.018 5.88e-05 ***
ExtwallStone                1.030e+04  1.460e+03   7.057 1.74e-12 ***
ExtwallStucco               6.137e+03  2.057e+03   2.984 0.002850 ** 
Stories1                   -2.147e+04  1.027e+04  -2.090 0.036629 *  
Stories1.5                 -8.279e+03  1.026e+04  -0.807 0.419894    
Stories2                   -5.041e+03  1.023e+04  -0.493 0.622253    
Year_Built                  4.535e+02  1.542e+01  29.411  &lt; 2e-16 ***
Fin_sqft                    5.666e+01  1.038e+00  54.565  &lt; 2e-16 ***
Units1                      5.580e+04  7.135e+03   7.820 5.48e-15 ***
Units2                     -1.043e+04  7.130e+03  -1.463 0.143438    
Units3                     -4.314e+04  7.650e+03  -5.638 1.74e-08 ***
Bdrms0                      9.457e+04  1.774e+04   5.331 9.84e-08 ***
Bdrms1                      5.261e+04  9.902e+03   5.313 1.09e-07 ***
Bdrms2                      5.917e+04  8.904e+03   6.646 3.08e-11 ***
Bdrms3                      6.469e+04  8.852e+03   7.308 2.80e-13 ***
Bdrms4                      5.649e+04  8.821e+03   6.404 1.54e-10 ***
Bdrms5                      5.409e+04  8.819e+03   6.133 8.74e-10 ***
Bdrms6                      4.095e+04  8.822e+03   4.642 3.47e-06 ***
Bdrms7                      1.641e+04  9.389e+03   1.748 0.080510 .  
Bdrms8                      8.067e+03  9.895e+03   0.815 0.414955    
Fbath0                     -2.109e+04  1.525e+04  -1.383 0.166577    
Fbath1                     -9.763e+03  1.205e+04  -0.810 0.417884    
Fbath2                      8.813e+03  1.202e+04   0.733 0.463373    
Fbath3                      3.049e+04  1.197e+04   2.548 0.010841 *  
Fbath4                      3.856e+04  1.265e+04   3.048 0.002309 ** 
Lotsize                     1.668e+00  1.153e-01  14.469  &lt; 2e-16 ***
Sale_date                   4.687e+00  2.476e-01  18.927  &lt; 2e-16 ***
district_3TRUE              9.318e+05  1.356e+05   6.870 6.59e-12 ***
district_4TRUE              1.067e+06  2.437e+05   4.378 1.21e-05 ***
district_15TRUE             4.884e+05  1.170e+05   4.174 3.00e-05 ***
Year_Built:district_3TRUE  -5.020e+02  7.134e+01  -7.036 2.03e-12 ***
Lotsize:district_3TRUE      1.581e+01  8.257e-01  19.143  &lt; 2e-16 ***
Lotsize:district_4TRUE     -8.562e-01  2.348e+00  -0.365 0.715328    
Year_Built:district_4TRUE  -5.586e+02  1.279e+02  -4.369 1.25e-05 ***
Year_Built:district_15TRUE -3.064e+02  6.097e+01  -5.025 5.08e-07 ***
Lotsize:district_15TRUE     4.567e+00  1.259e+00   3.628 0.000286 ***
Fin_sqft:district_3TRUE     4.404e+01  1.689e+00  26.079  &lt; 2e-16 ***
Fin_sqft:district_4TRUE    -1.496e+01  4.817e+00  -3.107 0.001894 ** 
Fin_sqft:district_15TRUE   -1.301e+01  3.015e+00  -4.314 1.61e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 41640 on 24329 degrees of freedom
Multiple R-squared:  0.677, Adjusted R-squared:  0.6764 
F-statistic:  1133 on 45 and 24329 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Sale_price ~ . - district_3 - district_4 - district_15 + 
    district_3 * Year_Built + district_3 * Lotsize + district_4 * 
    Lotsize + district_4 * Year_Built + district_15 * Year_Built + 
    district_15 * Lotsize + district_3 * Fin_sqft + district_4 * 
    Fin_sqft + district_15 * Fin_sqft, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-303393  -24422    -942   23352  719561 

Coefficients:
                             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                -1.129e+06  3.625e+04 -31.143  &lt; 2e-16 ***
District                    5.695e+03  7.701e+01  73.950  &lt; 2e-16 ***
ExtwallBlock               -3.944e+03  3.688e+03  -1.069 0.284879    
ExtwallBrick                6.725e+03  7.245e+02   9.281  &lt; 2e-16 ***
ExtwallFiber-Cement         3.847e+04  3.754e+03  10.246  &lt; 2e-16 ***
ExtwallFrame               -4.986e+03  9.786e+02  -5.095 3.51e-07 ***
ExtwallMasonry / Frame      3.751e+03  1.711e+03   2.192 0.028404 *  
ExtwallPrem Wood            1.894e+04  5.596e+03   3.385 0.000714 ***
ExtwallStone                1.162e+04  1.531e+03   7.594 3.22e-14 ***
ExtwallStucco               3.514e+03  2.149e+03   1.635 0.102070    
Stories1                    3.684e+02  1.047e+04   0.035 0.971935    
Stories1.5                  1.317e+04  1.046e+04   1.259 0.207954    
Stories2                    1.451e+04  1.042e+04   1.392 0.163802    
Year_Built                  4.629e+02  1.606e+01  28.823  &lt; 2e-16 ***
Fin_sqft                    6.048e+01  1.080e+00  55.986  &lt; 2e-16 ***
Units1                      5.778e+04  7.389e+03   7.820 5.48e-15 ***
Units2                     -9.774e+03  7.386e+03  -1.323 0.185735    
Units3                     -4.087e+04  7.940e+03  -5.147 2.67e-07 ***
Bdrms0                      1.155e+05  1.854e+04   6.227 4.82e-10 ***
Bdrms1                      7.894e+04  1.016e+04   7.766 8.41e-15 ***
Bdrms2                      8.331e+04  9.086e+03   9.170  &lt; 2e-16 ***
Bdrms3                      8.791e+04  9.033e+03   9.733  &lt; 2e-16 ***
Bdrms4                      7.905e+04  9.001e+03   8.782  &lt; 2e-16 ***
Bdrms5                      7.507e+04  9.002e+03   8.340  &lt; 2e-16 ***
Bdrms6                      6.149e+04  9.006e+03   6.828 8.80e-12 ***
Bdrms7                      2.462e+04  9.572e+03   2.573 0.010100 *  
Bdrms8                      1.242e+04  1.008e+04   1.233 0.217672    
Fbath0                     -1.936e+04  1.388e+04  -1.395 0.162964    
Fbath1                     -1.050e+04  9.795e+03  -1.072 0.283695    
Fbath2                      7.289e+03  9.751e+03   0.748 0.454721    
Fbath3                      2.935e+04  9.641e+03   3.044 0.002339 ** 
Fbath4                      6.757e+04  1.025e+04   6.595 4.35e-11 ***
Lotsize                     1.419e+00  1.131e-01  12.545  &lt; 2e-16 ***
Sale_date                   4.839e+00  2.603e-01  18.587  &lt; 2e-16 ***
district_3TRUE              9.189e+05  1.373e+05   6.693 2.23e-11 ***
district_4TRUE              1.088e+06  2.504e+05   4.346 1.39e-05 ***
district_15TRUE             4.475e+05  1.212e+05   3.692 0.000223 ***
Year_Built:district_3TRUE  -5.100e+02  7.205e+01  -7.078 1.51e-12 ***
Lotsize:district_3TRUE      1.227e+01  4.803e-01  25.549  &lt; 2e-16 ***
Lotsize:district_4TRUE     -3.796e+00  1.569e+00  -2.420 0.015512 *  
Year_Built:district_4TRUE  -5.558e+02  1.306e+02  -4.255 2.09e-05 ***
Year_Built:district_15TRUE -2.829e+02  6.295e+01  -4.493 7.05e-06 ***
Lotsize:district_15TRUE     3.140e+00  1.213e+00   2.589 0.009620 ** 
Fin_sqft:district_3TRUE     6.621e+01  1.517e+00  43.639  &lt; 2e-16 ***
Fin_sqft:district_4TRUE    -2.049e+01  4.181e+00  -4.901 9.61e-07 ***
Fin_sqft:district_15TRUE   -1.161e+01  3.163e+00  -3.672 0.000241 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 43870 on 24429 degrees of freedom
Multiple R-squared:  0.7301,    Adjusted R-squared:  0.7296 
F-statistic:  1468 on 45 and 24429 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice that some of the coefficients moved several standard errors!! This is a huge change - recall that outside 2 SE is outside the confidence interval. </span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">abs</span>(model3<span class="sc">$</span>coefficients<span class="sc">-</span>model2<span class="sc">$</span>coefficients)<span class="sc">/</span>s<span class="sc">$</span>coefficients[,<span class="dv">2</span>],T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Fin_sqft:district_3TRUE     Lotsize:district_3TRUE 
               13.12921244                 4.28251228 
                  Fin_sqft                     Bdrms2 
                3.67632675                 2.71135819 
                    Bdrms1                     Bdrms3 
                2.65942115                 2.62300725 
                    Bdrms4                     Bdrms5 
                2.55803659                 2.37931980 
                    Bdrms6                     Fbath4 
                2.32800514                 2.29254969 
                   Lotsize                   Stories1 
                2.15917623                 2.12584336 
                Stories1.5                (Intercept) 
                2.08951428                 1.94622311 
                  Stories2              ExtwallStucco 
                1.91130562                 1.27508213 
    Lotsize:district_4TRUE                     Bdrms0 
                1.25254634                 1.17834538 
   Fin_sqft:district_4TRUE    Lotsize:district_15TRUE 
                1.14722302                 1.13324660 
       ExtwallFiber-Cement               ExtwallStone 
                1.07699381                 0.90638984 
                    Bdrms7                  Sale_date 
                0.87503687                 0.61281368 
                Year_Built               ExtwallBlock 
                0.61059285                 0.49592917 
          ExtwallPrem Wood               ExtwallFrame 
                0.47860061                 0.46639106 
  Fin_sqft:district_15TRUE                     Bdrms8 
                0.46190677                 0.44003527 
Year_Built:district_15TRUE            district_15TRUE 
                0.38551372                 0.35010067 
    ExtwallMasonry / Frame                     Units3 
                0.30538360                 0.29642777 
                    Units1               ExtwallBrick 
                0.27784255                 0.24013191 
                  District                     Fbath2 
                0.16381293                 0.12675423 
                    Fbath0  Year_Built:district_3TRUE 
                0.11329164                 0.11171876 
                    Fbath3             district_3TRUE 
                0.09596028                 0.09539010 
                    Units2             district_4TRUE 
                0.09240725                 0.08640950 
                    Fbath1  Year_Built:district_4TRUE 
                0.06130014                 0.02182735 </code></pre>
</div>
</div>
<p>How should we treat influential observations? The easiest course of action is removal. If there are many influential observations, then you might want to try robust model fitting methods, which automatically account for outliers and influential observations.</p>
</section>
<section id="homework-questions" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="homework-questions"><span class="header-section-number">7.4</span> Homework questions</h2>
<p>Complete the Chapter 6 textbook questions.</p>
<div id="exr-7-4-1" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.1</strong></span> What are the three methods we have learned for detecting influential/leverage points?</p>
</div>
<div id="exr-7-4-2" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.2</strong></span> Compute the hat values, Cook’s distances and the depth values for the body weight example. Are there any influential/leverage points/outliers?</p>
</div>
<div id="exr-7-4-3" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.3</strong></span> Compute the hat values, Cook’s distances and the depth values for the cars example. Are there any outliers/influential/leverage points?</p>
</div>
<div id="exr-7-4-4" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.4</strong></span> Fit a model without location to the real estate data of your choosing. Compute the hat values, Cook’s distances and the depth values for the cars example. Are there any influential/leverage points/outliers? Print out the influential/leverage points/outliers. Why do you think they are outlying? Should we remove them?</p>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Unit_5.html" class="pagination-link" aria-label="Indicator Variables">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Indicator Variables</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Unit_7.html" class="pagination-link" aria-label="Multicollinearity">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Multicollinearity</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>