<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Math 3330: Regression Notes - 7&nbsp; Leverage and Influence</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Unit_7.html" rel="next">
<link href="./Unit_5.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Unit_6.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Leverage and Influence</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Math 3330: Regression Notes</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Review material</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Linear Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Residual analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Transformations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Indicator Variables</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_6.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Leverage and Influence</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_7.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Multicollinearity</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_8.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Variable/Model Selection</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_9.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Robust Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Appendix_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Introduction to R software</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#influential-observations-and-leverage" id="toc-influential-observations-and-leverage" class="nav-link active" data-scroll-target="#influential-observations-and-leverage"><span class="header-section-number">7.1</span> Influential observations and leverage</a></li>
  <li><a href="#cooks-distance" id="toc-cooks-distance" class="nav-link" data-scroll-target="#cooks-distance"><span class="header-section-number">7.2</span> Cook’s Distance</a></li>
  <li><a href="#data-depth-functions" id="toc-data-depth-functions" class="nav-link" data-scroll-target="#data-depth-functions"><span class="header-section-number">7.3</span> Data depth functions</a></li>
  <li><a href="#homework-questions" id="toc-homework-questions" class="nav-link" data-scroll-target="#homework-questions"><span class="header-section-number">7.4</span> Homework questions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Leverage and Influence</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="influential-observations-and-leverage" class="level2" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="influential-observations-and-leverage"><span class="header-section-number">7.1</span> Influential observations and leverage</h2>
<p>Recall that violations of model assumptions are more likely at remote points, and these violations may be hard to detect from inspection of the ordinary residuals because their residuals will usually be smaller. Points that are outlying in the <span class="math inline">\(x\)</span>-direction are known as <strong>leverage points</strong>. <strong>Influential points</strong> are not only remote in terms of the specific values for the regressors, but the observed response is not consistent with the values that would be predicted based on only the other data points. It is important to find these influential points and assess their impact on the model.</p>
<p>Below gives an example of an influential point. The seventh point in the data set is outlying in the <span class="math inline">\(x\)</span>-direction, and it’s response value is not consistent with the regression line based on the other six observations:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">330</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>x<span class="ot">=</span><span class="fu">c</span>(<span class="fu">rnorm</span>(<span class="dv">6</span>),<span class="fl">2.5</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>y<span class="ot">=</span>x<span class="sc">*</span><span class="dv">2</span><span class="sc">+</span><span class="dv">3</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>y[<span class="dv">7</span>]<span class="ot">=</span>y[<span class="dv">7</span>]<span class="sc">+</span><span class="dv">7</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x,y,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>a<span class="ot">=</span><span class="fu">lm</span>(y<span class="sc">~</span>x)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(a<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>x<span class="sc">*</span>a<span class="sc">$</span>coefficients[<span class="dv">2</span>],<span class="at">add=</span>T,<span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(x<span class="sc">*</span><span class="dv">2</span><span class="sc">+</span><span class="dv">3</span>,<span class="at">add=</span>T,<span class="at">col=</span><span class="dv">2</span>,<span class="at">lwd=</span><span class="dv">3</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>a2<span class="ot">=</span><span class="fu">lm</span>(y[<span class="sc">-</span><span class="dv">7</span>]<span class="sc">~</span>x[<span class="sc">-</span><span class="dv">7</span>])</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(a2<span class="sc">$</span>coefficients[<span class="dv">1</span>]<span class="sc">+</span>x<span class="sc">*</span>a2<span class="sc">$</span>coefficients[<span class="dv">2</span>],<span class="at">add=</span>T,<span class="at">lwd=</span><span class="dv">3</span>,<span class="at">col=</span><span class="st">'blue'</span>,<span class="at">lty=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Unit_6_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>a<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)           x 
   2.048937    3.979977 </code></pre>
</div>
</div>
<p>Sometimes we find that a regression coefficient may have a sign that does not make engineering or scientific sense, a regressor known to be important may be statistically insignificant, or a model that fits the data well and that is logical from an application – environment perspective may produce poor predictions. These situations may be the result of one or, perhaps, a few influential observations.</p>
<p>Recall the hat matrix <span class="math inline">\(H=X(X^\top X)^{-1}X^\top\)</span>, as well as that it holds that <span class="math inline">\({\textrm{Var}}\left[\hat\epsilon\right]=\sigma^2(I-H)\)</span> and <span class="math inline">\({\textrm{Var}}\left[\hat Y\right]=\sigma^2 H\)</span>. Note that <span class="math inline">\(h_{ij}\)</span> can be interpreted as the amount of leverage exerted by the <span class="math inline">\(ith\)</span> observation <span class="math inline">\(y_i\)</span> on the <span class="math inline">\(jth\)</span> fitted value <span class="math inline">\(\hat y_j\)</span>. We usually focus attention on the diagonal elements <span class="math inline">\(h_{ii}\)</span> of the hat matrix <span class="math inline">\(H\)</span>, which may be written as <span class="math display">\[h_{ii}=x_i^\top (X^\top X)^{-1} x_i,\]</span> where <span class="math inline">\(X_i^\top\)</span> is the <span class="math inline">\(i\)</span>th row of <span class="math inline">\(X\)</span>. The hat matrix diagonal is a standardized measure of the distance of the <span class="math inline">\(i\)</span>th observation from the center (or centroid) of the <span class="math inline">\(x\)</span>-space. Therefore, large values of <span class="math inline">\(h_{ii}\)</span> implies that <span class="math inline">\(x_i\)</span> is potentially influential. Furthermore, note that <span class="math inline">\(rank(H)=p\)</span> since the trace of an idempotent matrix equals its rank, which means that <span class="math inline">\(\bar h= p/n\)</span>. It follows that values well above <span class="math inline">\(p/n\)</span>, say <span class="math inline">\(h_{ii}&gt;2p/n\)</span>, can be called leverage points.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span><span class="fu">as.matrix</span>(<span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">length</span>(x)),x))</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># or</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span><span class="fu">model.matrix</span>(a)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>hat<span class="ot">=</span>X<span class="sc">%*%</span><span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X)<span class="sc">%*%</span><span class="fu">t</span>(X)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(hat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        1         2         3         4         5         6         7 
0.2027453 0.2288737 0.2596869 0.1751432 0.1735495 0.3887329 0.5712686 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>p<span class="ot">=</span><span class="dv">2</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="dv">7</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(hat)<span class="sc">&gt;</span><span class="dv">2</span><span class="sc">*</span>p<span class="sc">/</span>n</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    1     2     3     4     5     6     7 
FALSE FALSE FALSE FALSE FALSE FALSE FALSE </code></pre>
</div>
</div>
</section>
<section id="cooks-distance" class="level2" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="cooks-distance"><span class="header-section-number">7.2</span> Cook’s Distance</h2>
<p>Cook’s Distance is one way to incorporate both the <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> values into an outlyingness measure:</p>
<p><span class="math display">\[
D_i\left(X^{\top} X, p, MSE\right) \equiv D_i=\frac{\left(\hat{\beta}_{(i)}-\hat{\beta}\right)^{\top} X^{\top} X\left(\hat{\beta}_{(i)}-\hat{\beta}\right)}{p MSE}, \  i=\in [n],
\]</span> where <span class="math inline">\(\hat{\beta}_{(i)}\)</span> is the OLS estimator with the <span class="math inline">\(i\)</span>th point removed.Large values of Cook’s distance signal a leverage point.</p>
<p>What do we mean by a large value? We can compare <span class="math inline">\(D_i\)</span> to the 50th percentile of the <span class="math inline">\(F_{p,n-p}\)</span> distribution. This gives the interpretation that deleting the <span class="math inline">\(i\)</span>th point moves the estimate to the boundary of a 50% confidence interval. <span class="math inline">\(F_{p,n-p}\approx 1\)</span>, and so usually take <span class="math inline">\(D_i\geq 1\)</span> to be large.</p>
<p>Observe that <span class="math display">\[
D_i=\frac{r_i^2}{p} \frac{\operatorname{Var}\left(\hat{Y}_i\right)}{\operatorname{Var}\left(\hat\epsilon_i\right)}=\frac{r_i^2}{p} \frac{h_{i i}}{1-h_{i i}}, \quad i=1,2, \ldots, n,\]</span> where it is important to recall that <span class="math inline">\(r_i\)</span> is the studentized residual. Now, the quantity <span class="math inline">\(\frac{h_{i i}}{1-h_{i i}}\)</span> can be shown to be the distance from the vector <span class="math inline">\(x_i\)</span> to the centroid of the remaining data. Therefore, <span class="math inline">\(D_i\)</span> is the product of outlyingness in both the <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> directions. We may also write <span class="math inline">\(D_i\)</span> as <span class="math display">\[D_i=\frac{\left\lVert\hat{y}_{(i)}-\hat{y}\right\rVert^2}{p MSE},\]</span> which allows for the interpretation: The Cook’s distance of the <span class="math inline">\(i\)</span>th point is the normalized distance between the fitted value with and without point <span class="math inline">\(i\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co">#cut off</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cooks.distance</span>(a)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           1            2            3            4            5            6 
0.1708029420 0.2516095165 0.0180669722 0.0009569213 0.0011772793 0.2002829110 
           7 
3.3311562309 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cooks.distance</span>(a)<span class="sc">&gt;</span><span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    1     2     3     4     5     6     7 
FALSE FALSE FALSE FALSE FALSE FALSE  TRUE </code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(y,x))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">cooks.distance</span>(a)<span class="sc">&gt;</span><span class="dv">1</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   y   x
7 15 2.5</code></pre>
</div>
</div>
</section>
<section id="data-depth-functions" class="level2" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="data-depth-functions"><span class="header-section-number">7.3</span> Data depth functions</h2>
<p>A more modern approach and nonparametric approach to outlier detection is through data depth. A data depth function gives meaning to centrality, order and outlyingness in spaces beyond <span class="math inline">\(\mathbb{R}\)</span>. A data depth function is a function which takes a sample and a point, and returns how central the point is, with respect to the sample. Depth functions can be written as <span class="math inline">\({\textrm{D}}\colon \mathbb{R}^{d}\times \text{Sample} \rightarrow \mathbb{R}^+\)</span>. There are different definitions of depth, so I will give a few.</p>
<p>Let <span class="math inline">\(S^{d-1}= \{x\in \mathbb{R}^{d}\colon \left\lVert x\right\rVert=1\}\)</span> be the set of unit vectors in <span class="math inline">\(\mathbb{R}^{d}\)</span>, let <span class="math inline">\(\mathbb{X}_{n}=\{(Y_1,X_{1,1},\ldots,X_{1,p-1}),\ldots, (Y_n,X_{n,1},\ldots,X_{n,p-1})\}\)</span>, let <span class="math inline">\(\mathbb{X}_{n}^\top u\)</span> be <span class="math inline">\(\mathbb{X}_{n}\)</span> projected onto <span class="math inline">\(u\in S^{d-1}\)</span> and let <span class="math inline">\(\widehat F_u\)</span> be the empirical CDF with respect to <span class="math inline">\(\mathbb{X}_{n}^\top u\)</span>.</p>
<div id="dfn-7-1-1">
<p>The halfspace depth <span class="math inline">\({\textrm{D}}_H\)</span> of a point <span class="math inline">\(x\in \mathbb{R}^{d}\)</span> with respect to a distribution <span class="math inline">\(F\)</span> over <span class="math inline">\(\mathbb{R}^{d}\)</span> is <span class="math display">\[
{\textrm{D}}_H(x;F)=\inf_{u\in S^{d-1}} \widehat F_u(x^\top u)\wedge (1-F_u(x^\top u))=\inf_{u\in S^{d-1}}
F_u(x^\top u).
\]</span></p>
</div>
<div id="dfn-7-1-2">
<p>Given a translation and scale equivariant location estimate <span class="math inline">\(\mu\)</span> and a translation and scale invariant scale estimate <span class="math inline">\(\sigma\)</span>, the outlyingness at <span class="math inline">\(x\in\mathbb{R}^{d}\)</span> is defined as <span class="math display">\[O(x)=\sup _{u\in S^{d-1}} \frac{\left|x^\top u-\mu(\mathbb{X}_{n}^\top u)\right|}{\sigma(\mathbb{X}_{n}^\top u)}.\]</span> Define projection depth as <span class="math display">\[{\textrm{D}}_p(x)=(1+O(x))^{-1}.\]</span></p>
</div>
<p>In order to detect outliers, we look for observations that have low depth. See, continuing our toy example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages('ddalpha')</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>depths<span class="ot">=</span>ddalpha<span class="sc">::</span><span class="fu">depth.projection</span>(<span class="fu">cbind</span>(x,y),<span class="fu">cbind</span>(x,y))</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>depths</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2764090105 0.2552720744 0.5000000000 0.9746926931 0.9730469270
[6] 0.3389544152 0.0005839796</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>depths<span class="sc">&lt;</span><span class="fl">0.015</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE</code></pre>
</div>
</div>
<div id="exm-6-3-1" class="theorem example">
<p><span class="theorem-title"><strong>Example 7.1 </strong></span>Recall example <a href="Unit_5.html#exm-6-4-1">Example&nbsp;<span>6.6</span></a>. Check for leverage and influential points in the proposed models. Compute all three measures of leverage/influence/outlyingness introduced in this lesson. What do you find?</p>
</div>
<p>I will load in the data below:</p>
<p>We can now analyze the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># df=df[df$Lotsize&lt;70000,]</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>custom_palette <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#1f77b4"</span>, <span class="st">"#ff7f0e"</span>, <span class="st">"#2ca02c"</span>, <span class="st">"#d62728"</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#9467bd"</span>, <span class="st">"#8c564b"</span>, <span class="st">"#e377c2"</span>, <span class="st">"#7f7f7f"</span>,</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#bcbd22"</span>, <span class="st">"#17becf"</span>, <span class="st">"#393b79"</span>, </span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"#8c6d31"</span>, <span class="st">"#9c9ede"</span>, <span class="st">"#637939"</span>, <span class="st">"#eb348f"</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Our model from the previous lecture</span></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span>df_clean2[<span class="sc">-</span><span class="fu">which.max</span>(df_clean2<span class="sc">$</span>Lotsize),]</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span>df[df<span class="sc">$</span>Lotsize<span class="sc">&gt;</span><span class="dv">0</span>,]</span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'district_3'</span>]<span class="ot">=</span>df[<span class="st">'District'</span>]<span class="sc">==</span><span class="dv">3</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'district_4'</span>]<span class="ot">=</span>df[<span class="st">'District'</span>]<span class="sc">==</span><span class="dv">4</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'district_15'</span>]<span class="ot">=</span>df[<span class="st">'District'</span>]<span class="sc">==</span><span class="dv">15</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>model2<span class="ot">=</span><span class="fu">lm</span>(Sale_price<span class="sc">~</span>.<span class="sc">-</span>district_3<span class="sc">-</span>district_4<span class="sc">-</span>district_15<span class="sc">+</span>district_3<span class="sc">*</span>Year_Built<span class="sc">+</span>district_3<span class="sc">*</span>Lotsize<span class="sc">+</span>district_4<span class="sc">*</span>Lotsize<span class="sc">+</span>district_4<span class="sc">*</span>Year_Built<span class="sc">+</span>district_15<span class="sc">*</span>Year_Built<span class="sc">+</span>district_15<span class="sc">*</span>Lotsize<span class="sc">+</span>district_3<span class="sc">*</span>Fin_sqft<span class="sc">+</span>district_4<span class="sc">*</span>Fin_sqft<span class="sc">+</span>district_15<span class="sc">*</span>Fin_sqft,df)</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute residuals</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>student_res2<span class="ot">=</span><span class="fu">rstudent</span>(model2)</span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>summ2<span class="ot">=</span><span class="fu">summary</span>(model2); summ2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Sale_price ~ . - district_3 - district_4 - district_15 + 
    district_3 * Year_Built + district_3 * Lotsize + district_4 * 
    Lotsize + district_4 * Year_Built + district_15 * Year_Built + 
    district_15 * Lotsize + district_3 * Fin_sqft + district_4 * 
    Fin_sqft + district_15 * Fin_sqft, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-303393  -24422    -942   23352  719561 

Coefficients:
                             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                -1.129e+06  3.625e+04 -31.143  &lt; 2e-16 ***
District                    5.695e+03  7.701e+01  73.950  &lt; 2e-16 ***
ExtwallBlock               -3.944e+03  3.688e+03  -1.069 0.284879    
ExtwallBrick                6.725e+03  7.245e+02   9.281  &lt; 2e-16 ***
ExtwallFiber-Cement         3.847e+04  3.754e+03  10.246  &lt; 2e-16 ***
ExtwallFrame               -4.986e+03  9.786e+02  -5.095 3.51e-07 ***
ExtwallMasonry / Frame      3.751e+03  1.711e+03   2.192 0.028404 *  
ExtwallPrem Wood            1.894e+04  5.596e+03   3.385 0.000714 ***
ExtwallStone                1.162e+04  1.531e+03   7.594 3.22e-14 ***
ExtwallStucco               3.514e+03  2.149e+03   1.635 0.102070    
Stories1                    3.684e+02  1.047e+04   0.035 0.971935    
Stories1.5                  1.317e+04  1.046e+04   1.259 0.207954    
Stories2                    1.451e+04  1.042e+04   1.392 0.163802    
Year_Built                  4.629e+02  1.606e+01  28.823  &lt; 2e-16 ***
Fin_sqft                    6.048e+01  1.080e+00  55.986  &lt; 2e-16 ***
Units1                      5.778e+04  7.389e+03   7.820 5.48e-15 ***
Units2                     -9.774e+03  7.386e+03  -1.323 0.185735    
Units3                     -4.087e+04  7.940e+03  -5.147 2.67e-07 ***
Bdrms0                      1.155e+05  1.854e+04   6.227 4.82e-10 ***
Bdrms1                      7.894e+04  1.016e+04   7.766 8.41e-15 ***
Bdrms2                      8.331e+04  9.086e+03   9.170  &lt; 2e-16 ***
Bdrms3                      8.791e+04  9.033e+03   9.733  &lt; 2e-16 ***
Bdrms4                      7.905e+04  9.001e+03   8.782  &lt; 2e-16 ***
Bdrms5                      7.507e+04  9.002e+03   8.340  &lt; 2e-16 ***
Bdrms6                      6.149e+04  9.006e+03   6.828 8.80e-12 ***
Bdrms7                      2.462e+04  9.572e+03   2.573 0.010100 *  
Bdrms8                      1.242e+04  1.008e+04   1.233 0.217672    
Fbath0                     -1.936e+04  1.388e+04  -1.395 0.162964    
Fbath1                     -1.050e+04  9.795e+03  -1.072 0.283695    
Fbath2                      7.289e+03  9.751e+03   0.748 0.454721    
Fbath3                      2.935e+04  9.641e+03   3.044 0.002339 ** 
Fbath4                      6.757e+04  1.025e+04   6.595 4.35e-11 ***
Lotsize                     1.419e+00  1.131e-01  12.545  &lt; 2e-16 ***
Sale_date                   4.839e+00  2.603e-01  18.587  &lt; 2e-16 ***
district_3TRUE              9.189e+05  1.373e+05   6.693 2.23e-11 ***
district_4TRUE              1.088e+06  2.504e+05   4.346 1.39e-05 ***
district_15TRUE             4.475e+05  1.212e+05   3.692 0.000223 ***
Year_Built:district_3TRUE  -5.100e+02  7.205e+01  -7.078 1.51e-12 ***
Lotsize:district_3TRUE      1.227e+01  4.803e-01  25.549  &lt; 2e-16 ***
Lotsize:district_4TRUE     -3.796e+00  1.569e+00  -2.420 0.015512 *  
Year_Built:district_4TRUE  -5.558e+02  1.306e+02  -4.255 2.09e-05 ***
Year_Built:district_15TRUE -2.829e+02  6.295e+01  -4.493 7.05e-06 ***
Lotsize:district_15TRUE     3.140e+00  1.213e+00   2.589 0.009620 ** 
Fin_sqft:district_3TRUE     6.621e+01  1.517e+00  43.639  &lt; 2e-16 ***
Fin_sqft:district_4TRUE    -2.049e+01  4.181e+00  -4.901 9.61e-07 ***
Fin_sqft:district_15TRUE   -1.161e+01  3.163e+00  -3.672 0.000241 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 43870 on 24429 degrees of freedom
Multiple R-squared:  0.7301,    Adjusted R-squared:  0.7296 
F-statistic:  1468 on 45 and 24429 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>summ2<span class="sc">$</span>adj.r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7295574</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute residual analysis</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>MSE2<span class="ot">=</span>summ2<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(student_res2,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Unit_6_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(student_res2,<span class="at">freq=</span>F,<span class="at">breaks=</span><span class="dv">100</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="fu">dnorm</span>(x,<span class="dv">0</span>,<span class="dv">1</span>),<span class="at">add=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Unit_6_files/figure-html/unnamed-chunk-6-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hist(student_res2,freq=F,breaks=100)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># curve(dnorm(x,0,1),add=T)</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model2<span class="sc">$</span>fitted.values,student_res2,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Unit_6_files/figure-html/unnamed-chunk-6-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First measure</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span><span class="fu">model.matrix</span>(model2)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>hat<span class="ot">=</span>X<span class="sc">%*%</span><span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X)<span class="sc">%*%</span><span class="fu">t</span>(X)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a><span class="co"># diag(hat)</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>p<span class="ot">=</span><span class="fu">ncol</span>(X)</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="fu">nrow</span>(X)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>out_1<span class="ot">=</span><span class="fu">which</span>(<span class="fu">diag</span>(hat)<span class="sc">&gt;</span><span class="dv">2</span><span class="sc">*</span>p<span class="sc">/</span>n)</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">sort</span>(<span class="fu">diag</span>(hat)[out_1]))</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">2</span><span class="sc">*</span>p<span class="sc">/</span>n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Unit_6_files/figure-html/unnamed-chunk-6-4.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I would still look at those after the elbow</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Cooks distances</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>CDS<span class="ot">=</span><span class="fu">cooks.distance</span>(model2)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">sort</span>(CDS,T)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Unit_6_files/figure-html/unnamed-chunk-6-5.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(CDS<span class="sc">&gt;</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>22532 
22398 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(CDS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.075144</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df[CDS<span class="sc">&gt;</span><span class="dv">1</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      District Extwall Stories Year_Built Fin_sqft Units Bdrms Fbath Lotsize
22532        3   Block       1       1960     4323     1     4     3   72480
      Sale_date Sale_price District District District
22532     17713    1250000     TRUE    FALSE    FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I would still look at those two values that are far from the other distances</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># I would still look at those before the elbow</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># We may only look at numeric values for depth functions - so we can either</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>numer<span class="ot">=</span><span class="cn">NULL</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">names</span>(df)){</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.factor</span>(df[<span class="dv">1</span>,i])){</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    numer<span class="ot">=</span><span class="fu">c</span>(numer,i)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>numer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "District"    "Year_Built"  "Fin_sqft"    "Lotsize"     "Sale_date"  
[6] "Sale_price"  "district_3"  "district_4"  "district_15"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df_mat<span class="ot">=</span><span class="fu">as.matrix</span>(df[,numer])</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>depths<span class="ot">=</span>ddalpha<span class="sc">::</span><span class="fu">depth.projection</span>(df_mat,df_mat)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(depths<span class="sc">&lt;</span><span class="fl">0.1</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]   5  64 130 326 471 473 593 637 669 673</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">sort</span>(depths,F)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Unit_6_files/figure-html/unnamed-chunk-6-6.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice there is a crack around 0.035, I would look at those observations</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">sort</span>(depths,F)[<span class="dv">1</span><span class="sc">:</span><span class="dv">1000</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Unit_6_files/figure-html/unnamed-chunk-6-7.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">sort</span>(depths,F))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Unit_6_files/figure-html/unnamed-chunk-6-8.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># OR </span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>depths<span class="ot">=</span>ddalpha<span class="sc">::</span><span class="fu">depth.projection</span>(<span class="fu">cbind</span>(X,df<span class="sc">$</span>Sale_price),<span class="fu">cbind</span>(X,df<span class="sc">$</span>Sale_price))</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">which</span>(depths<span class="sc">&lt;</span><span class="fl">0.1</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  2  4  5  7 13 15 16 17 20 22</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">sort</span>(depths,F)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="Unit_6_files/figure-html/unnamed-chunk-6-9.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.max</span>(<span class="fu">diag</span>(hat))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>22532 
22398 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.max</span>(CDS)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>22532 
22398 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">which.min</span>(depths)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 22398</code></pre>
</div>
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hugely expensive home!</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">which.min</span>(depths),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      District Extwall Stories Year_Built Fin_sqft Units Bdrms Fbath Lotsize
22532        3   Block       1       1960     4323     1     4     3   72480
      Sale_date Sale_price District District District
22532     17713    1250000     TRUE    FALSE    FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">which.max</span>(CDS),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      District Extwall Stories Year_Built Fin_sqft Units Bdrms Fbath Lotsize
22532        3   Block       1       1960     4323     1     4     3   72480
      Sale_date Sale_price District District District
22532     17713    1250000     TRUE    FALSE    FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">which.max</span>(<span class="fu">diag</span>(hat)),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      District Extwall Stories Year_Built Fin_sqft Units Bdrms Fbath Lotsize
22532        3   Block       1       1960     4323     1     4     3   72480
      Sale_date Sale_price District District District
22532     17713    1250000     TRUE    FALSE    FALSE</code></pre>
</div>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>model3<span class="ot">=</span><span class="fu">lm</span>(Sale_price<span class="sc">~</span>.<span class="sc">-</span>district_3<span class="sc">-</span>district_4<span class="sc">-</span>district_15<span class="sc">+</span>district_3<span class="sc">*</span>Year_Built<span class="sc">+</span>district_3<span class="sc">*</span>Lotsize<span class="sc">+</span>district_4<span class="sc">*</span>Lotsize<span class="sc">+</span>district_4<span class="sc">*</span>Year_Built<span class="sc">+</span>district_15<span class="sc">*</span>Year_Built<span class="sc">+</span>district_15<span class="sc">*</span>Lotsize<span class="sc">+</span>district_3<span class="sc">*</span>Fin_sqft<span class="sc">+</span>district_4<span class="sc">*</span>Fin_sqft<span class="sc">+</span>district_15<span class="sc">*</span>Fin_sqft,df[<span class="sc">-</span>(<span class="fu">order</span>(depths)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]),])</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co"># OR </span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>model4<span class="ot">=</span><span class="fu">lm</span>(Sale_price<span class="sc">~</span>.<span class="sc">-</span>district_3<span class="sc">-</span>district_4<span class="sc">-</span>district_15<span class="sc">+</span>district_3<span class="sc">*</span>Year_Built<span class="sc">+</span>district_3<span class="sc">*</span>Lotsize<span class="sc">+</span>district_4<span class="sc">*</span>Lotsize<span class="sc">+</span>district_4<span class="sc">*</span>Year_Built<span class="sc">+</span>district_15<span class="sc">*</span>Year_Built<span class="sc">+</span>district_15<span class="sc">*</span>Lotsize<span class="sc">+</span>district_3<span class="sc">*</span>Fin_sqft<span class="sc">+</span>district_4<span class="sc">*</span>Fin_sqft<span class="sc">+</span>district_15<span class="sc">*</span>Fin_sqft,df[<span class="sc">-</span>(<span class="fu">order</span>(CDS,<span class="at">decreasing =</span> T)[<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>]),])</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>s<span class="ot">=</span><span class="fu">summary</span>(model3)</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Sale_price ~ . - district_3 - district_4 - district_15 + 
    district_3 * Year_Built + district_3 * Lotsize + district_4 * 
    Lotsize + district_4 * Year_Built + district_15 * Year_Built + 
    district_15 * Lotsize + district_3 * Fin_sqft + district_4 * 
    Fin_sqft + district_15 * Fin_sqft, data = df[-(order(depths)[1:100]), 
    ])

Residuals:
    Min      1Q  Median      3Q     Max 
-275370  -24253   -1103   23096  635597 

Coefficients:
                             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                -1.037e+06  3.633e+04 -28.541  &lt; 2e-16 ***
District                    5.699e+03  7.341e+01  77.629  &lt; 2e-16 ***
ExtwallBlock               -2.064e+03  3.522e+03  -0.586 0.557918    
ExtwallBrick                6.899e+03  6.933e+02   9.950  &lt; 2e-16 ***
ExtwallFiber-Cement         4.061e+04  3.582e+03  11.338  &lt; 2e-16 ***
ExtwallFrame               -4.666e+03  9.335e+02  -4.998 5.82e-07 ***
ExtwallMasonry / Frame      4.791e+03  1.644e+03   2.915 0.003563 ** 
ExtwallPrem Wood            2.079e+04  5.372e+03   3.869 0.000109 ***
ExtwallStone                1.024e+04  1.464e+03   6.993 2.76e-12 ***
ExtwallStucco               6.926e+03  2.064e+03   3.355 0.000794 ***
Stories1                   -1.488e+04  1.009e+04  -1.475 0.140341    
Stories1.5                 -2.032e+03  1.008e+04  -0.202 0.840248    
Stories2                    9.328e+02  1.004e+04   0.093 0.926011    
Year_Built                  4.599e+02  1.541e+01  29.851  &lt; 2e-16 ***
Fin_sqft                    5.769e+01  1.040e+00  55.494  &lt; 2e-16 ***
Units1                      5.691e+04  7.060e+03   8.062 7.88e-16 ***
Units2                     -9.225e+03  7.057e+03  -1.307 0.191157    
Units3                     -4.351e+04  7.591e+03  -5.733 1.00e-08 ***
Bdrms0                      8.562e+04  1.785e+04   4.798 1.61e-06 ***
Bdrms1                      4.430e+04  1.004e+04   4.411 1.03e-05 ***
Bdrms2                      5.055e+04  9.051e+03   5.585 2.36e-08 ***
Bdrms3                      5.586e+04  9.001e+03   6.206 5.52e-10 ***
Bdrms4                      4.768e+04  8.971e+03   5.315 1.08e-07 ***
Bdrms5                      4.474e+04  8.971e+03   4.988 6.16e-07 ***
Bdrms6                      3.155e+04  8.979e+03   3.514 0.000443 ***
Bdrms7                      4.656e+03  9.563e+03   0.487 0.626325    
Bdrms8                     -3.406e+03  1.004e+04  -0.339 0.734486    
Fbath0                     -5.601e+04  1.659e+04  -3.375 0.000738 ***
Fbath1                     -4.463e+04  1.370e+04  -3.257 0.001126 ** 
Fbath2                     -2.627e+04  1.367e+04  -1.922 0.054672 .  
Fbath3                     -4.149e+03  1.365e+04  -0.304 0.761115    
Fbath4                      9.982e+03  1.429e+04   0.699 0.484777    
Lotsize                     1.619e+00  1.126e-01  14.373  &lt; 2e-16 ***
Sale_date                   4.708e+00  2.485e-01  18.943  &lt; 2e-16 ***
district_3TRUE              1.053e+06  1.350e+05   7.800 6.46e-15 ***
district_4TRUE              1.078e+06  2.387e+05   4.516 6.33e-06 ***
district_15TRUE             4.518e+05  1.170e+05   3.862 0.000113 ***
Year_Built:district_3TRUE  -5.607e+02  7.103e+01  -7.894 3.04e-15 ***
Lotsize:district_3TRUE      1.293e+01  8.001e-01  16.165  &lt; 2e-16 ***
Lotsize:district_4TRUE     -2.976e+00  1.595e+00  -1.866 0.062066 .  
Year_Built:district_4TRUE  -5.539e+02  1.246e+02  -4.447 8.75e-06 ***
Year_Built:district_15TRUE -2.840e+02  6.079e+01  -4.672 3.00e-06 ***
Lotsize:district_15TRUE     3.626e+00  1.205e+00   3.010 0.002613 ** 
Fin_sqft:district_3TRUE     4.568e+01  1.711e+00  26.699  &lt; 2e-16 ***
Fin_sqft:district_4TRUE    -1.978e+01  4.078e+00  -4.850 1.24e-06 ***
Fin_sqft:district_15TRUE   -1.422e+01  3.036e+00  -4.685 2.82e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 41810 on 24329 degrees of freedom
Multiple R-squared:  0.6584,    Adjusted R-squared:  0.6578 
F-statistic:  1042 on 45 and 24329 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Sale_price ~ . - district_3 - district_4 - district_15 + 
    district_3 * Year_Built + district_3 * Lotsize + district_4 * 
    Lotsize + district_4 * Year_Built + district_15 * Year_Built + 
    district_15 * Lotsize + district_3 * Fin_sqft + district_4 * 
    Fin_sqft + district_15 * Fin_sqft, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-303393  -24422    -942   23352  719561 

Coefficients:
                             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)                -1.129e+06  3.625e+04 -31.143  &lt; 2e-16 ***
District                    5.695e+03  7.701e+01  73.950  &lt; 2e-16 ***
ExtwallBlock               -3.944e+03  3.688e+03  -1.069 0.284879    
ExtwallBrick                6.725e+03  7.245e+02   9.281  &lt; 2e-16 ***
ExtwallFiber-Cement         3.847e+04  3.754e+03  10.246  &lt; 2e-16 ***
ExtwallFrame               -4.986e+03  9.786e+02  -5.095 3.51e-07 ***
ExtwallMasonry / Frame      3.751e+03  1.711e+03   2.192 0.028404 *  
ExtwallPrem Wood            1.894e+04  5.596e+03   3.385 0.000714 ***
ExtwallStone                1.162e+04  1.531e+03   7.594 3.22e-14 ***
ExtwallStucco               3.514e+03  2.149e+03   1.635 0.102070    
Stories1                    3.684e+02  1.047e+04   0.035 0.971935    
Stories1.5                  1.317e+04  1.046e+04   1.259 0.207954    
Stories2                    1.451e+04  1.042e+04   1.392 0.163802    
Year_Built                  4.629e+02  1.606e+01  28.823  &lt; 2e-16 ***
Fin_sqft                    6.048e+01  1.080e+00  55.986  &lt; 2e-16 ***
Units1                      5.778e+04  7.389e+03   7.820 5.48e-15 ***
Units2                     -9.774e+03  7.386e+03  -1.323 0.185735    
Units3                     -4.087e+04  7.940e+03  -5.147 2.67e-07 ***
Bdrms0                      1.155e+05  1.854e+04   6.227 4.82e-10 ***
Bdrms1                      7.894e+04  1.016e+04   7.766 8.41e-15 ***
Bdrms2                      8.331e+04  9.086e+03   9.170  &lt; 2e-16 ***
Bdrms3                      8.791e+04  9.033e+03   9.733  &lt; 2e-16 ***
Bdrms4                      7.905e+04  9.001e+03   8.782  &lt; 2e-16 ***
Bdrms5                      7.507e+04  9.002e+03   8.340  &lt; 2e-16 ***
Bdrms6                      6.149e+04  9.006e+03   6.828 8.80e-12 ***
Bdrms7                      2.462e+04  9.572e+03   2.573 0.010100 *  
Bdrms8                      1.242e+04  1.008e+04   1.233 0.217672    
Fbath0                     -1.936e+04  1.388e+04  -1.395 0.162964    
Fbath1                     -1.050e+04  9.795e+03  -1.072 0.283695    
Fbath2                      7.289e+03  9.751e+03   0.748 0.454721    
Fbath3                      2.935e+04  9.641e+03   3.044 0.002339 ** 
Fbath4                      6.757e+04  1.025e+04   6.595 4.35e-11 ***
Lotsize                     1.419e+00  1.131e-01  12.545  &lt; 2e-16 ***
Sale_date                   4.839e+00  2.603e-01  18.587  &lt; 2e-16 ***
district_3TRUE              9.189e+05  1.373e+05   6.693 2.23e-11 ***
district_4TRUE              1.088e+06  2.504e+05   4.346 1.39e-05 ***
district_15TRUE             4.475e+05  1.212e+05   3.692 0.000223 ***
Year_Built:district_3TRUE  -5.100e+02  7.205e+01  -7.078 1.51e-12 ***
Lotsize:district_3TRUE      1.227e+01  4.803e-01  25.549  &lt; 2e-16 ***
Lotsize:district_4TRUE     -3.796e+00  1.569e+00  -2.420 0.015512 *  
Year_Built:district_4TRUE  -5.558e+02  1.306e+02  -4.255 2.09e-05 ***
Year_Built:district_15TRUE -2.829e+02  6.295e+01  -4.493 7.05e-06 ***
Lotsize:district_15TRUE     3.140e+00  1.213e+00   2.589 0.009620 ** 
Fin_sqft:district_3TRUE     6.621e+01  1.517e+00  43.639  &lt; 2e-16 ***
Fin_sqft:district_4TRUE    -2.049e+01  4.181e+00  -4.901 9.61e-07 ***
Fin_sqft:district_15TRUE   -1.161e+01  3.163e+00  -3.672 0.000241 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 43870 on 24429 degrees of freedom
Multiple R-squared:  0.7301,    Adjusted R-squared:  0.7296 
F-statistic:  1468 on 45 and 24429 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice that some of the coefficients moved several standard errors!! This is a huge change - recall that outside 2 SE is outside the confidence interval. </span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sort</span>(<span class="fu">abs</span>(model3<span class="sc">$</span>coefficients<span class="sc">-</span>model2<span class="sc">$</span>coefficients)<span class="sc">/</span>s<span class="sc">$</span>coefficients[,<span class="dv">2</span>],T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Fin_sqft:district_3TRUE                     Fbath4 
               11.99363889                 4.03115873 
                    Bdrms2                     Bdrms3 
                3.61968880                 3.56125479 
                    Bdrms4                     Bdrms1 
                3.49662258                 3.44909820 
                    Bdrms5                     Bdrms6 
                3.38079527                 3.33465490 
                  Fin_sqft                (Intercept) 
                2.68380953                 2.52902410 
                    Fbath1                     Fbath2 
                2.49092989                 2.45478804 
                    Fbath3                     Fbath0 
                2.45446915                 2.20855631 
                    Bdrms7                    Lotsize 
                2.08818248                 1.77703029 
                    Bdrms0              ExtwallStucco 
                1.67270549                 1.65294669 
                    Bdrms8                   Stories1 
                1.57619716                 1.51107453 
                Stories1.5                   Stories2 
                1.50813878                 1.35206593 
            district_3TRUE               ExtwallStone 
                0.99086366                 0.94519289 
  Fin_sqft:district_15TRUE     Lotsize:district_3TRUE 
                0.85901755                 0.82983040 
 Year_Built:district_3TRUE     ExtwallMasonry / Frame 
                0.71450536                 0.63249134 
       ExtwallFiber-Cement               ExtwallBlock 
                0.59814335                 0.53401386 
                 Sale_date     Lotsize:district_4TRUE 
                0.52577077                 0.51421732 
   Lotsize:district_15TRUE                     Units3 
                0.40341837                 0.34857258 
          ExtwallPrem Wood               ExtwallFrame 
                0.34353337                 0.34307709 
              ExtwallBrick                 Year_Built 
                0.25072103                 0.19524702 
   Fin_sqft:district_4TRUE                     Units1 
                0.17369106                 0.12342228 
                    Units2                   District 
                0.07776454                 0.05450420 
            district_4TRUE            district_15TRUE 
                0.04259372                 0.03706108 
Year_Built:district_15TRUE  Year_Built:district_4TRUE 
                0.01893041                 0.01595313 </code></pre>
</div>
</div>
<p>How should we treat influential observations? The easiest course of action is removal. If there are many influential observations, then you might want to try robust model fitting methods, which automatically account for outliers and influential observations.</p>
</section>
<section id="homework-questions" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="homework-questions"><span class="header-section-number">7.4</span> Homework questions</h2>
<p>Complete the Chapter 6 textbook questions.</p>
<div id="exr-7-4-1" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.1 </strong></span>What are the three methods we have learned for detecting influential/leverage points?</p>
</div>
<div id="exr-7-4-2" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.2 </strong></span>Compute the hat values, Cook’s distances and the depth values for the body weight example. Are there any influential/leverage points/outliers?</p>
</div>
<div id="exr-7-4-3" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.3 </strong></span>Compute the hat values, Cook’s distances and the depth values for the cars example. Are there any outliers/influential/leverage points?</p>
</div>
<div id="exr-7-4-4" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 7.4 </strong></span>Fit a model without location to the real estate data of your choosing. Compute the hat values, Cook’s distances and the depth values for the cars example. Are there any influential/leverage points/outliers? Print out the influential/leverage points/outliers. Why do you think they are outlying? Should we remove them?</p>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Unit_5.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Indicator Variables</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Unit_7.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Multicollinearity</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>