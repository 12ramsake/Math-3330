<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.53">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Linear Regression – Math 3330: Regression Notes</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./Unit_3.html" rel="next">
<link href="./Unit_1.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./Unit_2.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Linear Regression</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Math 3330: Regression Notes</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_0.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Review material</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_2.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Linear Regression</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Residual analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Unit_4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Transformations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./Appendix_R.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Introduction to R software</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#basics-of-linear-regression" id="toc-basics-of-linear-regression" class="nav-link active" data-scroll-target="#basics-of-linear-regression"><span class="header-section-number">3.1</span> Basics of linear regression</a>
  <ul class="collapse">
  <li><a href="#the-linear-regression-model" id="toc-the-linear-regression-model" class="nav-link" data-scroll-target="#the-linear-regression-model"><span class="header-section-number">3.1.1</span> The linear regression model</a></li>
  <li><a href="#the-multiple-linear-regression-model" id="toc-the-multiple-linear-regression-model" class="nav-link" data-scroll-target="#the-multiple-linear-regression-model"><span class="header-section-number">3.1.2</span> The multiple linear regression model</a></li>
  <li><a href="#homework-stop-1" id="toc-homework-stop-1" class="nav-link" data-scroll-target="#homework-stop-1"><span class="header-section-number">3.1.3</span> Homework stop 1</a></li>
  </ul></li>
  <li><a href="#least-squares" id="toc-least-squares" class="nav-link" data-scroll-target="#least-squares"><span class="header-section-number">3.2</span> Least Squares</a>
  <ul class="collapse">
  <li><a href="#notation" id="toc-notation" class="nav-link" data-scroll-target="#notation"><span class="header-section-number">3.2.1</span> Notation</a></li>
  <li><a href="#least-squares-estimation" id="toc-least-squares-estimation" class="nav-link" data-scroll-target="#least-squares-estimation"><span class="header-section-number">3.2.2</span> Least squares estimation</a></li>
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example"><span class="header-section-number">3.2.3</span> Example</a></li>
  <li><a href="#homework-stop-2" id="toc-homework-stop-2" class="nav-link" data-scroll-target="#homework-stop-2"><span class="header-section-number">3.2.4</span> Homework stop 2</a></li>
  </ul></li>
  <li><a href="#least-squares-inference" id="toc-least-squares-inference" class="nav-link" data-scroll-target="#least-squares-inference"><span class="header-section-number">3.3</span> Least squares inference</a>
  <ul class="collapse">
  <li><a href="#important-quantities-residuals-and-fitted-values" id="toc-important-quantities-residuals-and-fitted-values" class="nav-link" data-scroll-target="#important-quantities-residuals-and-fitted-values"><span class="header-section-number">3.3.1</span> Important quantities: Residuals and fitted values</a></li>
  <li><a href="#variation-decomposition" id="toc-variation-decomposition" class="nav-link" data-scroll-target="#variation-decomposition"><span class="header-section-number">3.3.2</span> Variation decomposition</a></li>
  <li><a href="#coefficients-of-determination" id="toc-coefficients-of-determination" class="nav-link" data-scroll-target="#coefficients-of-determination"><span class="header-section-number">3.3.3</span> Coefficients of determination</a></li>
  <li><a href="#the-f-test" id="toc-the-f-test" class="nav-link" data-scroll-target="#the-f-test"><span class="header-section-number">3.3.4</span> The <span class="math inline">\(F\)</span> test</a></li>
  <li><a href="#homework-stop-3" id="toc-homework-stop-3" class="nav-link" data-scroll-target="#homework-stop-3"><span class="header-section-number">3.3.5</span> Homework stop 3</a></li>
  <li><a href="#significance-of-one-variable" id="toc-significance-of-one-variable" class="nav-link" data-scroll-target="#significance-of-one-variable"><span class="header-section-number">3.3.6</span> Significance of one variable</a></li>
  <li><a href="#inference-for-the-mean-response-and-prediction-intervals" id="toc-inference-for-the-mean-response-and-prediction-intervals" class="nav-link" data-scroll-target="#inference-for-the-mean-response-and-prediction-intervals"><span class="header-section-number">3.3.7</span> Inference for the mean response and prediction intervals</a></li>
  <li><a href="#homework-stop-4" id="toc-homework-stop-4" class="nav-link" data-scroll-target="#homework-stop-4"><span class="header-section-number">3.3.8</span> Homework stop 4</a></li>
  <li><a href="#partial-testing" id="toc-partial-testing" class="nav-link" data-scroll-target="#partial-testing"><span class="header-section-number">3.3.9</span> Partial testing</a></li>
  <li><a href="#partial-coefficient-of-determination" id="toc-partial-coefficient-of-determination" class="nav-link" data-scroll-target="#partial-coefficient-of-determination"><span class="header-section-number">3.3.10</span> Partial coefficient of determination</a></li>
  </ul></li>
  <li><a href="#checking-model-assumptions" id="toc-checking-model-assumptions" class="nav-link" data-scroll-target="#checking-model-assumptions"><span class="header-section-number">3.4</span> Checking model assumptions</a>
  <ul class="collapse">
  <li><a href="#checking-normality" id="toc-checking-normality" class="nav-link" data-scroll-target="#checking-normality"><span class="header-section-number">3.4.1</span> Checking normality</a></li>
  <li><a href="#checking-the-other-assumptions" id="toc-checking-the-other-assumptions" class="nav-link" data-scroll-target="#checking-the-other-assumptions"><span class="header-section-number">3.4.2</span> Checking the other assumptions</a></li>
  <li><a href="#homework-stop-5" id="toc-homework-stop-5" class="nav-link" data-scroll-target="#homework-stop-5"><span class="header-section-number">3.4.3</span> Homework stop 5</a></li>
  </ul></li>
  <li><a href="#simple-linear-regression" id="toc-simple-linear-regression" class="nav-link" data-scroll-target="#simple-linear-regression"><span class="header-section-number">3.5</span> Simple linear regression</a>
  <ul class="collapse">
  <li><a href="#estimated-coefficients" id="toc-estimated-coefficients" class="nav-link" data-scroll-target="#estimated-coefficients"><span class="header-section-number">3.5.1</span> Estimated Coefficients</a></li>
  <li><a href="#inference-in-slr" id="toc-inference-in-slr" class="nav-link" data-scroll-target="#inference-in-slr"><span class="header-section-number">3.5.2</span> Inference in SLR</a></li>
  <li><a href="#inference-for-the-correlation-coefficient" id="toc-inference-for-the-correlation-coefficient" class="nav-link" data-scroll-target="#inference-for-the-correlation-coefficient"><span class="header-section-number">3.5.3</span> Inference for the correlation coefficient</a></li>
  <li><a href="#homework-stop-6" id="toc-homework-stop-6" class="nav-link" data-scroll-target="#homework-stop-6"><span class="header-section-number">3.5.4</span> Homework stop 6</a></li>
  </ul></li>
  <li><a href="#additional-concepts-examples" id="toc-additional-concepts-examples" class="nav-link" data-scroll-target="#additional-concepts-examples"><span class="header-section-number">3.6</span> Additional concepts &amp; examples</a>
  <ul class="collapse">
  <li><a href="#beware-scatter-plots-in-mlr" id="toc-beware-scatter-plots-in-mlr" class="nav-link" data-scroll-target="#beware-scatter-plots-in-mlr"><span class="header-section-number">3.6.1</span> Beware scatter plots in MLR</a></li>
  <li><a href="#homework-questions" id="toc-homework-questions" class="nav-link" data-scroll-target="#homework-questions"><span class="header-section-number">3.6.2</span> Homework questions</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Linear Regression</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="basics-of-linear-regression" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="basics-of-linear-regression"><span class="header-section-number">3.1</span> Basics of linear regression</h2>
<p>By the end of this section, you should be able to say what the linear and normal linear regression models are. As well as what it means to assume either of these models.</p>
<section id="the-linear-regression-model" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="the-linear-regression-model"><span class="header-section-number">3.1.1</span> The linear regression model</h3>
<p>Consider the following example.</p>
<div id="exm-3-1-1" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.1</strong></span> It is difficult to accurately determine a person’s body fat percentage without immersing them in water. However, we can easily obtain the weight of a person. A researcher would like to know if weight and body fat percentage are related? If so, for a given weight, can the person’s body fat percentage be predicted? If so, how accurate is the prediction? This researcher collected the following data:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 19%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Individual</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
<th>6</th>
<th>7</th>
<th>8</th>
<th>9</th>
<th>10</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Weight (lb)</td>
<td>175</td>
<td>181</td>
<td>200</td>
<td>159</td>
<td>196</td>
<td>192</td>
<td>205</td>
<td>173</td>
<td>187</td>
<td>188</td>
</tr>
<tr class="even">
<td>Body Fat (%)</td>
<td>6</td>
<td>21</td>
<td>15</td>
<td>6</td>
<td>22</td>
<td>31</td>
<td>32</td>
<td>21</td>
<td>25</td>
<td>30</td>
</tr>
</tbody>
</table>
<table class="caption-top table">
<colgroup>
<col style="width: 19%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th>Individual</th>
<th>11</th>
<th>12</th>
<th>13</th>
<th>14</th>
<th>15</th>
<th>16</th>
<th>17</th>
<th>18</th>
<th>19</th>
<th>20</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Weight (lb)</td>
<td>188</td>
<td>240</td>
<td>175</td>
<td>168</td>
<td>246</td>
<td>160</td>
<td>215</td>
<td>159</td>
<td>146</td>
<td>219</td>
</tr>
<tr class="even">
<td>Body Fat (%)</td>
<td>10</td>
<td>20</td>
<td>22</td>
<td>9</td>
<td>38</td>
<td>10</td>
<td>27</td>
<td>12</td>
<td>10</td>
<td>28</td>
</tr>
</tbody>
</table>
<p>How can we (as statisticians / data scientists) answer the questions raised by the researcher?</p>
</div>
<p>The first thing we might do is explore the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">##################### Exploratory analysis</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the data frame</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>Weight<span class="ot">=</span><span class="fu">c</span>(<span class="dv">175</span> , <span class="dv">181</span> , <span class="dv">200</span> , <span class="dv">159</span> , <span class="dv">196</span> , <span class="dv">192</span> , <span class="dv">205</span> , <span class="dv">173</span> , <span class="dv">187</span> , <span class="dv">188</span> , </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>         <span class="dv">188</span> , <span class="dv">240</span> , <span class="dv">175</span> , <span class="dv">168</span> , <span class="dv">246</span> , <span class="dv">160</span> , <span class="dv">215</span> , <span class="dv">159</span> , <span class="dv">146</span> , <span class="dv">219</span> )</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>BodyFat <span class="ot">=</span><span class="fu">c</span>(<span class="dv">6</span> , <span class="dv">21</span> , <span class="dv">15</span> , <span class="dv">6</span> , <span class="dv">22</span> , <span class="dv">31</span> , <span class="dv">32</span> ,<span class="dv">21</span> , <span class="dv">25</span> , <span class="dv">30</span> , </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>           <span class="dv">10</span> , <span class="dv">20</span> , <span class="dv">22</span> , <span class="dv">9</span> , <span class="dv">38</span> , <span class="dv">10</span> , <span class="dv">27</span> , <span class="dv">12</span> , <span class="dv">10</span> , <span class="dv">28</span> )</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(<span class="at">Weight=</span>Weight,<span class="at">BodyFat=</span>BodyFat))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># make some histograms</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(df<span class="sc">$</span>Weight,<span class="at">freq=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(df<span class="sc">$</span>BodyFat,<span class="at">freq=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-1-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># print summary statistics</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Weight         BodyFat     
 Min.   :146.0   Min.   : 6.00  
 1st Qu.:171.8   1st Qu.:10.00  
 Median :187.5   Median :21.00  
 Mean   :188.6   Mean   :19.75  
 3rd Qu.:201.2   3rd Qu.:27.25  
 Max.   :246.0   Max.   :38.00  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># There seems to be some relationship here</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-1-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Here is the correlation matrix, notice it is high!</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Weight   BodyFat
Weight  1.0000000 0.6966328
BodyFat 0.6966328 1.0000000</code></pre>
</div>
</div>
<p>We have observed that there is a relatively strong linear relationship between these two variables. What next? We might ask, what is this relationship precisely?</p>
<p>In particular, note that we have observed a sample of vectors <span class="math inline">\((Y_1,X_1),\ldots,(Y_1,X_n)\)</span>. Now, we want to say something about the relationship between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> in general. One way to do that is to suppose at the <strong>population</strong> level that <span class="math display">\[{\textrm{E}}\left[Y|X\right]=f(X).\]</span> That is, on average, <span class="math inline">\(Y\)</span> is equal to <span class="math inline">\(f(X)\)</span>. One way to do that is to assume that <span class="math inline">\(Y|X=f(X)+\epsilon,\)</span> where <span class="math inline">\(\epsilon\)</span> is a random variable that satisfies <span class="math inline">\({\textrm{E}}\left[\epsilon\right]=0\)</span>. This assumption means that, for each <span class="math inline">\(Y_i\)</span>, given <span class="math inline">\(X_i\)</span>, we have that <span class="math inline">\(Y_i=f(X_i)+\epsilon_i\)</span>. Note that we do not observe <span class="math inline">\(\epsilon_i\)</span>, but we can assume it exists. We can read this as <span class="math inline">\(Y_i\)</span> is equal to <span class="math inline">\(f(X_i)\)</span>, plus some random, individual error <span class="math inline">\(\epsilon_i\)</span>. The next step is to use the data to determine <span class="math inline">\(f\)</span>.</p>
<p>Using the data analysis steps from the <a href="Introduction">Introduction</a> we can write out the first few steps:</p>
<ul>
<li>Question about a population: ``How can we use weight to determine body fat percentage?’’</li>
<li>Data: <span class="math inline">\((Y_1,X_1),\ldots,(Y_{20},X_{20})\)</span>, <span class="math inline">\((Y_{i},X_{i})\)</span> are the body fat percentage and weight of individual <span class="math inline">\(i\in [20]\)</span>.</li>
</ul>
<p>We have explored the data with graphs and summary statistics. Now, we have posited the model <span class="math inline">\(Y|X=f(X)+\epsilon\)</span>. Letting <span class="math inline">\(f\)</span> be any function is too general. In fact, we can use the data to learn more about what <span class="math inline">\(f\)</span> might be. Recall that earlier, we saw the scatter plot, where it looked like there was a linear relationship, (with some error), between <span class="math inline">\(Y\)</span> and <span class="math inline">\(X\)</span>. (We can draw a straight line through the middle of the data.)</p>
<p>Let’s make some assumptions that make the statistical analysis easier:</p>
<ol type="1">
<li><p>Assume that <span class="math inline">\(\forall i\in[20]\)</span>, it holds that <span class="math display">\[Y_i|X_i=\beta_0+\beta_1 X_i+\epsilon_i.\]</span> This means that we assume that <span class="math inline">\(f\)</span> is a line.</p></li>
<li><p>Next, we assume <span class="math inline">\(\forall i\in[20]\)</span>, <span class="math inline">\({\textrm{E}}\left[\epsilon_i\right]=0\)</span> and <span class="math inline">\({\textrm{Var}}\left[\epsilon_i\right]=\sigma^2\)</span>. That is, the random error have the same mean and variance for each individual. In addition, the random errors average to 0.</p></li>
<li><p>We also assume that the individuals’ Body fat percentage, weights and random errors are independent, that is, <span class="math inline">\(\epsilon_i\perp \epsilon_j\)</span> for <span class="math inline">\(i\neq j,\ i,j\in [20]\)</span>.</p></li>
</ol>
<p>This is the <strong>simple linear regression model</strong>. That is, the simple linear regression model is the set of assumptions 1-3 given above.</p>
<p>It is often also assumed:</p>
<ol start="4" type="1">
<li><span class="math inline">\(\epsilon_i\sim\mathcal{N}(0,\sigma^2)\)</span>,</li>
</ol>
<p>but not always. Including the normality assumption is known as the <strong>simple normal linear regression model.</strong></p>
<p>In general, a model is a set of assumptions about a population. The particular set of assumptions 1-3 is the simple linear regression model.</p>
<p>The following is some terminology used in regression analysis:</p>
<ul>
<li>Here, <span class="math inline">\(Y_i\)</span> is the <strong>response variable</strong>, also known as the dependent variable, or the outcome variable.</li>
<li>Here, <span class="math inline">\(X_i\)</span> is the <strong>covariate</strong>, also known as the explanatory variable, or the independent variable.</li>
</ul>
<p>Given a “question about a population” which involves regression, you should immediately identify the response variable and the covariates.</p>
<p>Now, how can we interpret this model? That is, what does it mean to assume this model?</p>
<p>First, observe that we assume that <span class="math inline">\({\textrm{E}}\left[Y|X\right]\)</span> is a line. This means there is a linear relationship between the average body fat percentage and weight.</p>
<p>Next, observe that for any individual, their actual body fat percentage is given by <span class="math inline">\(Y={\textrm{E}}\left[Y|X\right]+\epsilon_i=\beta_0+\beta_1 X_i+\epsilon_i\)</span>. Therefore, their body fat percentage will not fall exactly on the line <span class="math inline">\(\beta_0+\beta_1 X_i\)</span>. Rather, it will fall above or below the line, depending on <span class="math inline">\(\epsilon_i\)</span>. Furthermore, if we assume that <span class="math inline">\(\epsilon_i\sim \mathcal{N}(0,\sigma^2)\)</span>, then we know from the properties of the Normal distribution that this random error will not exceed <span class="math inline">\(2\sigma\)</span> with high probability. Therefore, most of the time, an individual’s body fat percentage will fall within <span class="math inline">\(2\sigma\)</span> of the line.</p>
<p>Third, notice that this quantity, <span class="math inline">\(2\sigma\)</span>, does not depend on <span class="math inline">\(X\)</span>. That is, for any weight, we still expect an individual’s body fat percentage to be within <span class="math inline">\(2\sigma\)</span> of the line, regardless of the value of weight.</p>
<p>Fourth, if we knew <span class="math inline">\(\beta_0,\beta_1\)</span>, then given someone’s weight, we could try to predict their body fat percentage given their weight. That is, we could calculate the expected body fat <span class="math inline">\({\textrm{E}}\left[Y|X\right]\)</span>. There would still be their individual random error <span class="math inline">\(\epsilon\)</span>, so we would not be able to predict it exactly. However, if <span class="math inline">\(\sigma^2\)</span> isn’t too big, then we could produce an accurate prediction.</p>
<p>Therefore, if the model assumptions are correct, we assume there exists some line, around which the body fat percentages are scattered uniformly.</p>
<p>Next, we will simulate data from the normal simple linear regression model to gain a better understanding of this model. Suppose that <span class="math inline">\(\beta_0=-15\)</span>, <span class="math inline">\(\beta_1=.2\)</span> and <span class="math inline">\(\sigma=5\)</span>. Then we would observe the following.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="do">############################ Simulation</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">3252</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppose that beta_0=-15 and beta_1=0.2 and sigma=5, </span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># then we would have that the mean function E(Y|X) is given by the following line:</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="sc">-</span><span class="dv">15</span><span class="fl">+.2</span><span class="sc">*</span>x,<span class="dv">125</span>,<span class="dv">280</span>,<span class="at">lwd=</span><span class="dv">3</span>,<span class="at">xlab=</span><span class="st">"Weight"</span>,<span class="at">ylab=</span><span class="st">"Expected BF % (E(Y|X))"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Next, let's simulate some body weights from the uniform distribution</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>Weight2<span class="ot">=</span><span class="fu">runif</span>(<span class="dv">20</span>,<span class="dv">135</span>,<span class="dv">250</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, we can simulate the population body fat percentages according to the model as follows:</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulating 20 values of the random error, </span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>epsilons<span class="ot">=</span><span class="fu">rnorm</span>(<span class="at">n=</span><span class="dv">20</span>,<span class="at">mean=</span><span class="dv">0</span>,<span class="at">sd=</span><span class="dv">5</span>)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing the simulated Body fat percentages: </span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>Bfs<span class="ot">=</span><span class="sc">-</span><span class="dv">15</span><span class="fl">+.2</span><span class="sc">*</span>Weight2<span class="sc">+</span>epsilons</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the simulated values, and the mean function</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(<span class="sc">-</span><span class="dv">15</span><span class="fl">+.2</span><span class="sc">*</span>x,<span class="dv">125</span>,<span class="dv">280</span>,<span class="at">lwd=</span><span class="dv">3</span>,<span class="at">xlab=</span><span class="st">"Weight"</span>,<span class="at">ylab=</span><span class="st">"BF %"</span>)</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(Weight2,Bfs,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-2-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Notice how the data are scatted around the line uniformly? This is what data from a simple linear regression model looks like. Try changing the value in <code>set.seed()</code> and re-running the code. Notice how the data changes, but it is always scatted around the line uniformly? This is what we expect to see if the data follow a simple linear regression model.</p>
<p>Notice how the data simulated from our model appears similar to the body fat percentage and weights data we observed? That means this model (set of assumptions) is a good fit for our data.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this model, and in regression in general, the response <span class="math inline">\(Y\)</span> is not exactly equal to some function of <span class="math inline">\(X\)</span> given by <span class="math inline">\(f(X)\)</span>. The model assumes that <strong>on average</strong> <span class="math inline">\(Y=f(X)\)</span>. Therefore, knowing someones “<span class="math inline">\(X\)</span>” value will not exactly give us their <span class="math inline">\(Y\)</span> value, but it would give us a good guess at it. The error <span class="math inline">\(\epsilon\)</span> is used to model the fact that someones “<span class="math inline">\(X\)</span>” value will not exactly give us their <span class="math inline">\(Y\)</span> value. Notice above how the actual points are scatted around the line, and not exactly equal to it! This is due to the errors <span class="math inline">\(\epsilon\)</span>.</p>
</div>
</div>
</section>
<section id="the-multiple-linear-regression-model" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="the-multiple-linear-regression-model"><span class="header-section-number">3.1.2</span> The multiple linear regression model</h3>
<p>But what about matrices? Why did we study matrices then? We can write the regression model in terms of matrices and vectors, to make it more compact.</p>
<p>Now, recall <span class="math display">\[Y_i|X_i=\beta_0+\beta_1 X_i+\epsilon_i,\]</span> with <span class="math inline">\(\epsilon_i\sim\mathcal{N}(0,\sigma^2)\)</span>. It is more convenient mathematically to let <span class="math inline">\(\mathbf{Y}=(Y_1,\ldots,Y_n)^\top\)</span>, <span class="math display">\[\mathbf{X}=\begin{bmatrix}
        1 &amp; X_1\\
        \vdots &amp; \vdots\\
        1 &amp; X_n\\
    \end{bmatrix}=\left[ 1_n\ |\  (X_1,\ldots,X_n)^\top\right],\]</span> <span class="math inline">\(\beta=(\beta_0,\beta_1)^\top\)</span> and <span class="math inline">\(\mathbf{\epsilon}=(\epsilon_1,\ldots,\epsilon_n)^\top\)</span>. Then we can write <span class="math display">\[\mathbf{Y}|\mathbf{X}=\mathbf{X}\beta+\mathbf{\epsilon}.\]</span> Often, we overload the notation <span class="math inline">\(Y\)</span>, and use <span class="math inline">\(Y\)</span> instead of <span class="math inline">\(\mathbf{Y}\)</span>, and <span class="math inline">\(X\)</span> instead of <span class="math inline">\(\mathbf{X}\)</span>.</p>
<p>This form allows us to go beyond one explanatory variable very easily! Just add one column to <span class="math inline">\(X\)</span> and one entry to <span class="math inline">\(\beta\)</span> for each new variable. Observe the following model: <span class="math display">\[Y_i|(X_{i1},\ldots,X_{ik})=\beta_0+\beta_1 X_{i1}+\ldots+\beta_k X_{ik}+\epsilon_i,\]</span> with <span class="math inline">\(\epsilon_i\sim\mathcal{N}(0,\sigma^2)\)</span> and <span class="math inline">\(\epsilon_i\perp \epsilon_j\)</span> for <span class="math inline">\(i\neq j,\ i,j\in [n]\)</span>. This is known as the <strong>multiple linear regression model</strong> (MLR), or just the linear regression model for short. We can write this model in the same for as above: Let <span class="math display">\[\mathbf{X}=\begin{bmatrix}
        1 &amp; X_{11}&amp;X_{1k}\\
        \vdots &amp; \vdots &amp;\vdots\\
        1 &amp; X_{n1}\ldots &amp;X_{nk}\\
    \end{bmatrix},\]</span> and <span class="math inline">\(\beta=(\beta_0,\ldots,\beta_k)^\top\)</span>. Then we can write the MLR as <span class="math display">\[\mathbf{Y}|\mathbf{X}=\mathbf{X}\beta+\mathbf{\epsilon},\]</span> where <span class="math inline">\({\textrm{E}}\left[(\right]\epsilon)=0\)</span> and <span class="math inline">\({\textrm{Var}}\left[\epsilon\right]=\sigma^2 I\)</span>. Notice how compact this is! As in the simple case, there is also the <strong>normal MLR</strong>, which further assumes that <span class="math inline">\(\epsilon\sim\mathcal{N}(0,\sigma^2 I)\)</span>.</p>
<p>We can then study the mathematical properties of <span class="math display">\[Y|X=X\beta+\epsilon\]</span> for general but fixed <span class="math inline">\(k\)</span>, under the normal or vanilla MLR, which will cover many models.</p>
</section>
<section id="homework-stop-1" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="homework-stop-1"><span class="header-section-number">3.1.3</span> Homework stop 1</h3>
<div id="exr-3-1-1" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.1</strong></span> Try adjusting the parameters <span class="math inline">\(\beta_0,\beta_1,\sigma\)</span> in the simulation, what happens to the data? What happens to the line?</p>
</div>
<div id="exr-3-1-2" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.2</strong></span> Is <span class="math inline">\(\beta\)</span> an estimate or a population parameter? Why?</p>
</div>
<div id="exr-3-1-3" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.3</strong></span> Come up with another possible form of <span class="math inline">\(f\)</span> that is not linear. Adjust the simulation to include this form of <span class="math inline">\(f\)</span>.</p>
</div>
<div id="exr-3-1-4" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.4</strong></span> Write down the assumptions of the MLR and the normal MLR. What is the difference between the two models?</p>
</div>
</section>
</section>
<section id="least-squares" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="least-squares"><span class="header-section-number">3.2</span> Least Squares</h2>
<p>Now that we have settled on a model for the population, the next step is to use the data to estimate the model parameters. In particular, we need to estimate <span class="math inline">\(\beta\)</span>. That will allow us to estimated <span class="math inline">\({\textrm{E}}\left[Y|X\right]\)</span> for any value of <span class="math inline">\(X\)</span>.</p>
<p>Recall that we want to study the <strong>population</strong> model: <span class="math display">\[Y|X=X\beta+\epsilon.\]</span></p>
<section id="notation" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="notation"><span class="header-section-number">3.2.1</span> Notation</h3>
<p>For the model <span class="math inline">\(Y|X=X\beta+\epsilon\)</span>, we have</p>
<ul>
<li><span class="math inline">\(Y\in \mathbb{R}^n\)</span> is the response variable (a continuous random variable).</li>
<li><span class="math inline">\(X\in \mathbb{R}^{n\times p}\)</span> is the covariate matrix (Note that the first column is often <span class="math inline">\(1_n\)</span>).</li>
<li><span class="math inline">\(X_i\in \mathbb{R}^p\)</span> is the <span class="math inline">\(i^{th}\)</span> observed explanatory variable <span class="math inline">\((i=1, \ldots, n)\)</span> (not a random variable, in the sense that we condition on it).</li>
<li><span class="math inline">\(\beta\in \mathbb{R}^{p\times 1}\)</span> is the coefficient vector .</li>
<li><span class="math inline">\(\epsilon\in\mathbb{R}^n\)</span> is the random error (continuous random variable) .</li>
</ul>
<p>We may also refer to the actual observed values (versus the abstract mathematical concept of a random variable) as follows:</p>
<ul>
<li><span class="math inline">\(y=(y_1,\ldots,y_n)^\top\in \mathbb{R}^n\)</span> is the observed response variable (fixed/observed)</li>
<li><span class="math inline">\(x_{ij}\)</span> is the <span class="math inline">\(i^{th}\)</span> observation of the <span class="math inline">\(j^{th}\)</span> explanatory variable (fixed/observed) Data:</li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Observation</th>
<th>Observed data point</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td><span class="math inline">\((y_1, x_{11}, x_{12}, \ldots x_{1p})\)</span></td>
</tr>
<tr class="even">
<td>2</td>
<td><span class="math inline">\((y_2, x_{21}, x_{22}, \ldots x_{2p})\)</span></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\vdots\)</span></td>
<td><span class="math inline">\(\vdots\)</span></td>
</tr>
<tr class="even">
<td>n</td>
<td><span class="math inline">\((y_n, x_{n1}, x_{n2}, \ldots x_{np})\)</span></td>
</tr>
</tbody>
</table>
<p>We posit that <span class="math display">\[Y|X=X\beta+\epsilon,\]</span></p>
<p>where we assume that</p>
<ul>
<li><span class="math inline">\(\forall i\in[n]\)</span>, <span class="math inline">\({\textrm{E}}\left[\epsilon_i\right]=0\)</span>.</li>
<li><span class="math inline">\(\forall i\in[n]\)</span>, <span class="math inline">\({\textrm{Var}}\left[\epsilon_i\right]=\sigma^2\)</span> (constant variance and is also known as homogeneity.)</li>
<li>We also would assume that <span class="math inline">\(\epsilon_i\perp \epsilon_j\)</span> for <span class="math inline">\(i\neq j,\ i,j\in [n]\)</span>.</li>
<li><span class="math inline">\(\beta\in \mathbb{R}^{p\times 1}\)</span> is the unknown, population coefficient vector.</li>
<li><span class="math inline">\(X\in \mathbb{R}^{n\times p}\)</span> is a covariate matrix.</li>
</ul>
<p>Let’s talk about <span class="math inline">\(\beta\)</span>. How do we interpret <span class="math inline">\(\beta\)</span>? Suppose we know <span class="math inline">\(\beta\)</span>. Then:</p>
<p>Note that <span class="math display">\[{\textrm{E}}\left[Y_i|X_{i}\right]={\textrm{E}}\left[\beta^\top X_i+\epsilon\right]=\beta^\top X_i=\beta_1X_{1,1}+\ldots+\beta_pX_{i,p}\]</span></p>
<p>What does each <span class="math inline">\(\beta_j\)</span> mean? Suppose that <span class="math inline">\(X_j\)</span> is a continuous covariate.</p>
<p>We can interpret (<span class="math inline">\(\beta_j\)</span>) as follows:</p>
<p>Holding <span class="math inline">\(X_{i,1},\ldots,X_{i,j-1},X_{i,j+1},\ldots, X_{i,p}\)</span> constant, a one unit increase in <span class="math inline">\(X_{i,j}\)</span> causes, on average, a <span class="math inline">\(\beta_j\)</span> unit increase in <span class="math inline">\(Y_i\)</span>.</p>
<p>From another angle, we have that <span class="math inline">\(\partial {\textrm{E}}\left[Y\right]/\partial X=\beta\)</span>, therefore, the rate of change with respect to the <span class="math inline">\(j^{th}\)</span> covariate is <span class="math inline">\(\beta_j\)</span>.</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>The “on average” and “holding other covariates constant” are very important components of the interpretation. First, the on average acknowledges the random error <span class="math inline">\(\epsilon\)</span>. In other words, a one unit increase in <span class="math inline">\(X_{i,j}\)</span> will not certainly increase <span class="math inline">\(Y_i\)</span>, but it will on average. Next, the “holding other covariates constant” is used to mention how correlations between covariates are handled by the model. Some of the covariates in the model may be correlated, so increases in a given covariate may often be associated with changes in another covariate. This is not accounted for in the coefficient vectors <span class="math inline">\(\beta\)</span>. That is why we must specify “holding other covariates constant”.</p>
<p>For instance, if a model includes a terms for years of education attained and income, we know that as the number of years of education increase we expect to see a rise in income levels. As a result, to interpret the effect of coefficient on income, we must “hold years of education constant”, comparing what is expected with income changes but education does not.</p>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>For now, we can assume that all of the covariates <span class="math inline">\(X_j\)</span> are continuous variables. Later in the course, there may be categorical covariates. In this case, the <span class="math inline">\(\beta_j\)</span> corresponding to the categorical covariates have a different interpretation. We will return to this later.</p>
</div>
</div>
<p>Recall <a href="#exm-3-1-1" class="quarto-xref">Example&nbsp;<span>3.1</span></a>. We assume <span class="math inline">\(\forall i\in[20]\)</span>, it holds that <span class="math display">\[Y_i|X_i=\beta^\top X_i+\epsilon_i,\]</span> with <span class="math inline">\(\epsilon_i\sim\mathcal{N}(0,\sigma^2)\)</span>, <span class="math inline">\(\epsilon_i\perp \epsilon_j\)</span> for <span class="math inline">\(i\neq j,\ i,j\in [20]\)</span>. A one unit increase in weight causes, on average, a <span class="math inline">\(\beta_2\)</span> unit increase in body fat percentage. Since <span class="math inline">\(\beta_1\)</span> is the intercept, it has a special interpretation. <span class="math inline">\(\beta_1\)</span> is the average value of <span class="math inline">\(Y_i\)</span> given <span class="math inline">\(X_i=0\)</span>. It is also helpful to note that <span class="math inline">\({\textrm{cov}}(Y)=\sigma^2 I\)</span>.</p>
</section>
<section id="least-squares-estimation" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="least-squares-estimation"><span class="header-section-number">3.2.2</span> Least squares estimation</h3>
<p>Okay, but we don’t know <span class="math inline">\(\beta\)</span>! Just like we estimate the population mean with the sample mean, we need to estimate <span class="math inline">\(\beta\)</span>. We would like an estimate <span class="math inline">\(\hat\beta\)</span>, so that we can predict body fat percentage from weight. What is our best guess at <span class="math inline">\(\beta\)</span>, given the data? One way to answer this, is through the method of <strong>least squares</strong>.</p>
<p>Returning to our example, recall that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For example, suppose we want to determine if <span class="math inline">\(\beta\)</span> is more likely to be <span class="math inline">\((-35,0.3)^\top\)</span> or <span class="math inline">\((-22,0.2)^\top\)</span> . How can we say which line is a better to our data? One way is to graph them on top of the data and determine which one looks better. Let’s plot these lines.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot Y=-35+0.3X</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="sc">-</span><span class="dv">35</span>,<span class="fl">0.3</span>,<span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plot Y=-25+0.2X</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="sc">-</span><span class="dv">22</span>,<span class="fl">0.2</span>,<span class="at">col=</span><span class="st">'red'</span>,<span class="at">lwd=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Its not clear which one fits the data better. Even if it was clear, obviously, we cannot plot all possible lines. So how can we determine which line fits the data the “best”?</p>
<p>To do this, we have to define what “best” means quantitatively. For instance, one might ask which line minimizes the sum of the squared distances of the observed data points to the line? This line is then said to be the “best” line. Mathematically, given a proposed value of <span class="math inline">\(\beta\)</span>, say <span class="math inline">\(\beta_0\in \mathbb{R}^p\)</span>, the signed distance to the hyperplane <span class="math inline">\(X\beta_0\)</span> is <span class="math inline">\(\epsilon_0=Y-X\beta_0\)</span>. The squared distances to the hyperplane <span class="math inline">\(X\beta_0\)</span> is then <span class="math inline">\(\epsilon_0^\top\epsilon_0 =(Y-X\beta_0)^\top (Y-X\beta_0)\)</span>. We can then formulate this as a math problem: Which <span class="math inline">\(\beta_0\in \mathbb{R}^p\)</span> minimizes <span class="math inline">\(\epsilon_0^\top\epsilon_0\)</span>? i.e., <span class="math inline">\(\hat\beta =\mathop{\mathrm{argmin}}_{\beta_0\in\mathbb{R}^p}\epsilon_0^\top\epsilon_0.\)</span> It is more convenient to just write <span class="math display">\[\hat\beta =\mathop{\mathrm{argmin}}_{\beta\in\mathbb{R}^p}(Y-X\beta)^\top (Y-X\beta).\]</span></p>
<p>In this framework, the “best” estimate is given by <span class="math display">\[\hat\beta =\mathop{\mathrm{argmin}}_{\beta\in\mathbb{R}^p}(Y-X\beta)^\top (Y-X\beta).\]</span> Note best is in the sense of minimizing the average squared distance to the hyperplane/line. We could also define best in terms of some other metric, such as average absolute distance to the hyperplane/line. For now, we will stick with this metric.</p>
<p>The next step is to solve: <span class="math display">\[\hat\beta =\mathop{\mathrm{argmin}}_{\beta\in\mathbb{R}^p}(Y-X\beta)^\top (Y-X\beta).\]</span></p>
<p>How do we minimize a function???</p>
<p>RECALL in calculus, to find the minimum of a function we:</p>
<ol type="1">
<li>Obtain the first two derivatives of the function.</li>
<li>Set the first derivative to zero and solve for the critical value.</li>
<li>Use the second derivative to verify the critical value minimized the function.</li>
</ol>
<p>Goal: Compute <span class="math inline">\(\hat\beta\)</span> – Minimize <span class="math inline">\(g(\beta)=(Y-X\beta)^\top (Y-X\beta)\)</span>. (It may be useful to review taking derivatives with respect to vectors <a href="https://www.math.uwaterloo.ca/~hwolkowi/matrixcookbook.pdf">here</a>.</p>
<p>Step 1a: <span class="math display">\[\begin{align*}
\frac{\partial g}{\partial\beta}&amp;= &amp;\frac{\partial g}{\partial\beta}(Y-X\beta)^\top (Y-X\beta)\\
&amp;= &amp;\frac{\partial g}{\partial\beta}\left[Y^\top Y-2(X\beta)^\top Y+(X\beta)^\top X\beta\right] \tag{Transpose and distribute}\\
&amp;= &amp;-2\frac{\partial g}{\partial\beta}\beta^\top X^\top Y+\frac{\partial g}{\partial\beta}\beta^\top X^\top X\beta \tag{$(AB)^\top=B^\top A^\top$}\\
&amp;= &amp;-2 X^\top Y+2X^\top X\beta \tag{$\frac{\partial }{\partial x}x^\top Ax=2 A$ if $A$ symmetric, $\frac{\partial }{\partial x}x^\top a=a$ }\\
&amp;= &amp;-2X^\top (Y-X\beta ).
\end{align*}\]</span></p>
<p>Step 1b: (Do this for homework) <span class="math display">\[\frac{\partial^2 g}{\partial\beta\partial\beta^\top}=2X^\top X.\]</span></p>
<p>Step 2: We now need <span class="math inline">\(X^\top X\)</span> to be invertible, so we will assume that <span class="math inline">\(X\)</span> is full rank and <span class="math inline">\(n\geq p\)</span>. <span class="math display">\[\begin{align*}
    -2X^\top (Y-X\beta )=0\\
    &amp;\implies X^\top Y=X^\top X\beta\\
    &amp;\implies \beta=(X^\top X)^{-1}X^\top Y.
\end{align*}\]</span></p>
<p>Step 3:</p>
<p>Recall that <strong>if the Hessian matrix is positive definite at a critical point, then that critical point is a local minimum.</strong> Since we have assumed <span class="math inline">\(X\)</span> is full rank, this implies that <span class="math inline">\(X^\top X\)</span> is positive definite.</p>
<p>To summarize, the steps have proceeded as follows:</p>
<ul>
<li>Step 1a: <span class="math inline">\(\frac{\partial g}{\partial\beta}=-2X^\top (Y-X\beta )\)</span></li>
<li>Step 1b: <span class="math inline">\(\frac{\partial^2 g}{\partial\beta\partial\beta^\top}=2X^\top X\)</span> (Do this for homework)</li>
<li>Step 2: <span class="math inline">\(-2X^\top (Y-X\beta )=0\implies X^\top Y=X^\top X\beta\)</span> <span class="math inline">\(\implies \beta=(X^\top X)^{-1}X^\top Y\)</span></li>
<li>Step 3: <span class="math inline">\(2X^\top X\)</span> is positive definite, and so <span class="math display">\[\hat\beta=(X^\top X)^{-1}X^\top Y.\]</span></li>
</ul>
<p>The estimate <span class="math inline">\(\hat\beta\)</span> is known as the <strong>least squares estimate</strong> of the regression coefficients.</p>
<div id="def-3-1-1" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3.1</strong></span> The <strong>least squares estimate</strong> of the regression coefficients is <span class="math display">\[\hat\beta=(X^\top X)^{-1}X^\top Y.\]</span></p>
</div>
</section>
<section id="example" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="example"><span class="header-section-number">3.2.3</span> Example</h3>
<div id="exm-3-1-2" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.2</strong></span> In the body weight example <a href="#exm-3-1-1" class="quarto-xref">Example&nbsp;<span>3.1</span></a>, write down <span class="math inline">\(X\)</span>, <span class="math inline">\(Y\)</span> and compute <span class="math inline">\(\hat\beta\)</span>. Interpret <span class="math inline">\(\hat\beta\)</span>.</p>
</div>
<p>First, we have that <span class="math display">\[Y=\left( 6   , 21  , 15  , 6   , 22  , 31  , 32  , 21  , 25  , 30  , 10  , 20  , 22  , 9   , 38  , 10  , 27  , 12  , 10  , 28  \right)^\top\]</span> <span class="math display">\[X=\left[1_{20}\ | \left( 175 , 181 , 200 , 159 , 196 , 192 , 205 , 173 , 187 , 188 ,
188 , 240 , 175 , 168 , 246 , 160 , 215 , 159 , 146 , 219  \right)^\top\right]\]</span></p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>For matrices <span class="math inline">\(A,B\)</span> which have the same number of rows, <span class="math inline">\(C=[A | B]\)</span> is horizontal concatenation of <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span>. This notation indicates that the matrix <span class="math inline">\(C\)</span> is formed by placing <span class="math inline">\(A\)</span> an <span class="math inline">\(B\)</span> side by side, joining them horizontally. Therefore, <span class="math inline">\(X\)</span> is the matrix whose first column is made up of ones, and second column is made up of the body weights.</p>
</div>
</div>
<p>Let’s use R to compute <span class="math inline">\(\hat\beta\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Define X and Y</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span><span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(df)), df<span class="sc">$</span>Weight)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>Y<span class="ot">=</span>df<span class="sc">$</span>BodyFat</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># cast to column vec</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>Y<span class="ot">=</span><span class="fu">matrix</span>(Y,<span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co">#X'X </span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>X_p_X<span class="ot">=</span><span class="fu">t</span>(X)<span class="sc">%*%</span>X</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co">#X'X inverse</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>X_p_X_inverse<span class="ot">=</span><span class="fu">solve</span>(X_p_X)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a><span class="co">#LS</span></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>beta_hat<span class="ot">=</span> X_p_X_inverse<span class="sc">%*%</span><span class="fu">t</span>(X)<span class="sc">%*%</span>Y</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>beta_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            [,1]
[1,] -27.3762623
[2,]   0.2498741</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can also use Rs lm() function to do this: </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This code is essential for the course. </span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># The first argument is the formula </span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>model<span class="ot">=</span><span class="fu">lm</span>(BodyFat <span class="sc">~</span> Weight, <span class="at">data=</span>df)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">#The summary function prints the model output. </span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = BodyFat ~ Weight, data = df)

Residuals:
     Min       1Q   Median       3Q      Max 
-12.5935  -5.7904   0.6536   5.2731  10.4004 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -27.37626   11.54743  -2.371 0.029119 *  
Weight        0.24987    0.06065   4.120 0.000643 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 7.049 on 18 degrees of freedom
Multiple R-squared:  0.4853,    Adjusted R-squared:  0.4567 
F-statistic: 16.97 on 1 and 18 DF,  p-value: 0.0006434</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The least squares estimates are given in the Estimate column of the summary. </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>lm()</code> function is used to fit multiple linear regression models in R. The basic usage involves specifying a formula and a data frame. The syntax is given by <code>lm(formula, data, ...)</code>.</p>
<p>The data argument should be the dataframe which contains your data. The formula argument is used to specify the model to be fitted. It provides a symbolic description of the model, indicating the response variable and the predictors/covariates, as well as the relationships between them. The left-hand side should be the name of your response variable, as it is named in your dataframe. To see the names of your variables use the <code>names()</code> function, e.g., <code>names(df)</code>. The right-hand side contains the covariates you want to include in your model. For instance, above, the formula is given by <code>BodyFat ~ Weight</code> . Note that <code>BodyFat</code> is the response and <code>Weight</code> is the covariate.</p>
<p>We now list some important properties of the least squares estimator.</p>
<div id="exr-3-1-1" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.5</strong></span> Compute <span class="math inline">\({\textrm{E}}\left[\hat\beta\right]\)</span> and <span class="math inline">\({\textrm{cov}}(\hat\beta)\)</span>.</p>
</div>
<div id="sol-3-1-1" class="proof solution">
<p><span class="proof-title"><em>Solution 3.1</em>. </span>It holds that <span class="math inline">\({\textrm{E}}\left[\hat\beta\right]=\beta\)</span> and <span class="math inline">\({\textrm{cov}}(\hat\beta)=\sigma^2 I\)</span>.</p>
</div>
<p>Recall that an estimator is <strong>unbiased</strong> if its expectation equals the population parameter it is trying to estimate. After completing <a href="#exr-3-1-1" class="quarto-xref">Exercise&nbsp;<span>3.5</span></a> you will see that <span class="math inline">\(\hat\beta\)</span> is unbiased for the parameter <span class="math inline">\(\beta\)</span>.</p>
<p>The least squares estimator is also the “best linear unbiased estimator”, or the BLUE. This is known as the <a href="https://en.wikipedia.org/wiki/Gauss%E2%80%93Markov_theorem">Gauss–Markov</a> theorem. This means that under the assumptions of the linear regression model, over any unbiased estimator of <span class="math inline">\(\beta\)</span> we can construct, which is a linear combination of <span class="math inline">\(Y_1,\ldots,Y_n\)</span>, the estimator <span class="math inline">\(\hat\beta\)</span> has the smallest variance (and therefore, the smallest mean squared error. Recall that for an estimator <span class="math inline">\(\hat\alpha\)</span>, the mean squared error is given by <span class="math inline">\({\textrm{E}}\left[||\beta-\hat\alpha||^2\right]\)</span>.)</p>
<p>The Gauss–Markov theorem does not require the random error to be normally distributed. If we are willing to assume that <span class="math inline">\(\epsilon\sim \mathcal{N}(0,\sigma^2 I)\)</span>, then <span class="math inline">\(\hat\beta\)</span> is also the <a href="https://en.wikipedia.org/wiki/Maximum_likelihood_estimation">maximum likelihood estimator</a> and the “uniformly minimum-variance unbiased estimator”, or <a href="https://en.wikipedia.org/wiki/Minimum-variance_unbiased_estimator#:~:text=In%20statistics%20a%20minimum%2Dvariance,possible%20values%20of%20the%20parameter">UMVUE</a>. This means that <span class="math inline">\(\hat\beta\)</span> has lower variance than any other unbiased estimator, no matter what the true value of <span class="math inline">\(\beta\)</span> is.</p>
<p>One might ask, how can we use <span class="math inline">\(\hat\beta\)</span> to predict body fat percentage given weight? The estimate <span class="math inline">\(\hat\beta\)</span> gives us a best guess at the coefficients. Therefore, our best guess at someones body fat is given by <span class="math display">\[Best\ Guess=-27.3762623+ 0.2498741 \times Weight.\]</span> For instance, for someone who is 170 pounds, we would guess that their body fat percentage is <span class="math inline">\(-27.3762623+ 0.2498741 \times 170=\)</span> 15.1023347.</p>
</section>
<section id="homework-stop-2" class="level3" data-number="3.2.4">
<h3 data-number="3.2.4" class="anchored" data-anchor-id="homework-stop-2"><span class="header-section-number">3.2.4</span> Homework stop 2</h3>
<div id="exr-3-1-2" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.6</strong></span> Why do we need <span class="math inline">\(\hat\beta\)</span>, why not use <span class="math inline">\(\beta\)</span>?.</p>
</div>
<div id="exr-3-1-3" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.7</strong></span> Is <span class="math inline">\(\hat\beta\)</span> an estimate or a population parameter? What about <span class="math inline">\(\beta\)</span>?</p>
</div>
<div id="exr-3-1-4" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.8</strong></span> Compute, <span class="math inline">\(X\)</span>, <span class="math inline">\(Y\)</span> and <span class="math inline">\(\hat\beta\)</span> in the following real data example:</p>
<p>It is challenging to assess a student’s understanding of a subject without administering an exam. However, we can easily record the number of hours a student studies. A researcher would like to know if the number of hours studied and exam scores are related. This researcher collected the following data:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Student</th>
<th>Hours Studied</th>
<th>Exam Score (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>5</td>
<td>55</td>
</tr>
<tr class="even">
<td>2</td>
<td>8</td>
<td>65</td>
</tr>
<tr class="odd">
<td>3</td>
<td>12</td>
<td>78</td>
</tr>
<tr class="even">
<td>4</td>
<td>6</td>
<td>58</td>
</tr>
<tr class="odd">
<td>5</td>
<td>10</td>
<td>72</td>
</tr>
<tr class="even">
<td>6</td>
<td>9</td>
<td>68</td>
</tr>
<tr class="odd">
<td>7</td>
<td>15</td>
<td>85</td>
</tr>
<tr class="even">
<td>8</td>
<td>7</td>
<td>60</td>
</tr>
<tr class="odd">
<td>9</td>
<td>11</td>
<td>74</td>
</tr>
<tr class="even">
<td>10</td>
<td>13</td>
<td>80</td>
</tr>
<tr class="odd">
<td>11</td>
<td>14</td>
<td>82</td>
</tr>
<tr class="even">
<td>12</td>
<td>20</td>
<td>90</td>
</tr>
<tr class="odd">
<td>13</td>
<td>5</td>
<td>55</td>
</tr>
<tr class="even">
<td>14</td>
<td>6</td>
<td>59</td>
</tr>
<tr class="odd">
<td>15</td>
<td>18</td>
<td>88</td>
</tr>
<tr class="even">
<td>16</td>
<td>7</td>
<td>62</td>
</tr>
<tr class="odd">
<td>17</td>
<td>16</td>
<td>86</td>
</tr>
<tr class="even">
<td>18</td>
<td>4</td>
<td>50</td>
</tr>
<tr class="odd">
<td>19</td>
<td>3</td>
<td>45</td>
</tr>
<tr class="even">
<td>20</td>
<td>19</td>
<td>89</td>
</tr>
</tbody>
</table>
<p>To help you, here is some R code the dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>study_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Student =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Hours_Studied =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">6</span>, <span class="dv">10</span>, <span class="dv">9</span>, <span class="dv">15</span>, <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">20</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">18</span>, <span class="dv">7</span>, <span class="dv">16</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">19</span>),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Exam_Score =</span> <span class="fu">c</span>(<span class="dv">55</span>, <span class="dv">65</span>, <span class="dv">78</span>, <span class="dv">58</span>, <span class="dv">72</span>, <span class="dv">68</span>, <span class="dv">85</span>, <span class="dv">60</span>, <span class="dv">74</span>, <span class="dv">80</span>, <span class="dv">82</span>, <span class="dv">90</span>, <span class="dv">55</span>, <span class="dv">59</span>, <span class="dv">88</span>, <span class="dv">62</span>, <span class="dv">86</span>, <span class="dv">50</span>, <span class="dv">45</span>, <span class="dv">89</span>)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
</section>
<section id="least-squares-inference" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="least-squares-inference"><span class="header-section-number">3.3</span> Least squares inference</h2>
<p>Recall we <strong>estimate</strong> the parameter <span class="math inline">\(\beta\)</span> using least squares:</p>
<p>Recall that <span class="math inline">\(\hat\beta=(X^\top X)^{-1}X^\top Y\)</span>. We can predict a new weight <span class="math inline">\(Y_{new}|X=x\)</span> with <span class="math inline">\(\hat y_{new}=x^\top \hat\beta\)</span>. We may be interested in the following questions: How good is <span class="math inline">\(\hat y_{new}\)</span> as a prediction, on average? How will new observations vary about the line? For example, given a specific weight, how will does body fat percentage vary around the regression line? How does <span class="math inline">\(\hat\beta\)</span> vary around <span class="math inline">\(\beta\)</span>? Is there strong evidence that <span class="math inline">\(Y\)</span> has a relationship with <span class="math inline">\(X\)</span>? Is <span class="math inline">\(X\)</span> adding information about <span class="math inline">\(Y\)</span> at all?</p>
<p>To answer these questions, we need to look at the variation of our estimates and our data.</p>
<section id="important-quantities-residuals-and-fitted-values" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="important-quantities-residuals-and-fitted-values"><span class="header-section-number">3.3.1</span> Important quantities: Residuals and fitted values</h3>
<p>We now introduce some very important quantities: We call the estimated values given our observed <span class="math inline">\(X\)</span> the fitted values: <span class="math inline">\(\hat Y=X\hat\beta\)</span>. The fitted values are what our model would estimate the vector <span class="math inline">\(Y\)</span> to be. We call <span class="math inline">\(\hat \epsilon=Y-\hat Y\)</span> is the <strong>residual vector</strong>. The <span class="math inline">\(i\)</span>th entry of <span class="math inline">\(\hat \epsilon\)</span>, say <span class="math inline">\(\hat \epsilon_i\)</span>, is the <span class="math inline">\(i\)</span>th <strong>residual</strong>. The residuals are the signed distances from the response variable to the estimated regression hyperplane. The <strong>sum of squared error</strong> or <strong>sum of squared residuals</strong> (SSE) is given by <span class="math inline">\(\hat \epsilon^\top \hat \epsilon=\sum_{i=1}^n\hat \epsilon_i^2\)</span>. Note that since we estimated <span class="math inline">\(\beta\)</span> using the least squares method, <span class="math inline">\(\hat \epsilon^\top \hat \epsilon\)</span> is minimized (with respect to varying <span class="math inline">\(\beta\)</span>).</p>
<div id="exm-3-3-1" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.3</strong></span> Recall <a href="#exm-3-1-1" class="quarto-xref">Example&nbsp;<span>3.1</span></a>. What is the residual of individual 3? How can we interpret this value?</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>residuals<span class="ot">=</span>Y<span class="sc">-</span>X<span class="sc">%*%</span>beta_hat; residuals</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             [,1]
 [1,] -10.3517117
 [2,]   3.1490434
 [3,]  -7.5985652
 [4,]  -6.3537255
 [5,]   0.4009314
 [6,]  10.4004279
 [7,]   8.1520641
 [8,]   5.1480365
 [9,]   5.6497986
[10,]  10.3999245
[11,]  -9.6000755
[12,] -12.5935307
[13,]   5.6482883
[14,]  -5.6025928
[15,]   3.9072245
[16,]  -2.6035997
[17,]   0.6533228
[18,]  -0.3537255
[19,]   0.8946383
[20,]   0.6538262</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This means that individual 3's body fat is 7.5 percentage points lower than the fitted line</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>residuals[<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -7.598565</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can go further and and plot all of the residuals</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">curve</span>(beta_hat[<span class="dv">1</span>]<span class="sc">+</span>beta_hat[<span class="dv">2</span>]<span class="sc">*</span>x,<span class="dv">125</span>,<span class="dv">280</span>,<span class="at">lwd=</span><span class="dv">3</span>,<span class="at">xlab=</span><span class="st">"Weight"</span>,<span class="at">ylab=</span><span class="st">"BF %"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(Weight,BodyFat,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>Yvals<span class="ot">=</span><span class="fu">cbind</span>(BodyFat,model<span class="sc">$</span>fitted.values)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>Xvals<span class="ot">=</span><span class="fu">cbind</span>(Weight,Weight)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(Yvals)){</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lines</span>(Xvals[i,],Yvals[i,])</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">text</span>(Xvals[i,<span class="dv">1</span>]<span class="sc">+</span><span class="dv">2</span>,<span class="fu">mean</span>(Yvals[i,]),<span class="fu">round</span>(residuals[i],<span class="dv">2</span>))</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Then, the population body fat percentages, given weights will look like this: </span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Bfs=-15+.2*Weight+rnorm(20,0,sd=5)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="variation-decomposition" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="variation-decomposition"><span class="header-section-number">3.3.2</span> Variation decomposition</h3>
<p>Variance decomposition is a fundamental concept that explains how the total variation in the response variable can be partitioned into different sources. This decomposition is crucial for evaluating the performance of the regression model and understanding the contributions of various factors.</p>
<p>The residuals describe one type of variation of the response values. We can also consider the total variation of the response. The total variation of the response, or the <strong>sum of squares total</strong>/<strong>total sum of squares</strong> (<span class="math inline">\(SST\)</span>) is given by <span class="math inline">\(SST=(n-1)\hat\sigma_y=\sum_{i=1}^n(Y_i-\bar Y)^2=(Y-\bar Y 1)^\top (Y-\bar Y 1)\)</span>. It can be shown that the <span class="math inline">\(SST\)</span> can be decomposed as follows: <span class="math display">\[SST=(Y-\bar Y 1)^\top (Y-\bar Y 1)=(Y-\hat Y)^\top (Y-\hat Y)+(\hat Y-\bar Y)^\top (\hat Y-\bar Y)=\hat\epsilon^\top \hat\epsilon+(\hat Y-\bar Y)^\top (\hat Y-\bar Y).\]</span> That is, <span class="math inline">\(SST=SSE+SSModel\)</span> where</p>
<ul>
<li><span class="math inline">\(SSModel\)</span>, OR <span class="math inline">\(SSM\)</span> measures the total variations of the response explained by the covariates <span class="math inline">\(X\)</span> via the model based on <span class="math inline">\(\hat\beta\)</span>.</li>
<li><span class="math inline">\(SSE\)</span> measures the total variations of the response unexplained by the covariates <span class="math inline">\(X\)</span> via the model based on <span class="math inline">\(\hat\beta\)</span>.</li>
<li>Note there are sometimes other names for <span class="math inline">\(SSE\)</span> and <span class="math inline">\(SSModel\)</span>, such as <span class="math inline">\(SSRegression\)</span>, <span class="math inline">\(SSwithin\)</span> and <span class="math inline">\(SSbetween\)</span>, etc.</li>
</ul>
<p>So, we have that the total variation in the response can be broken down into that which is explained by the <span class="math inline">\(X\)</span> values, and that which is unexplained.</p>
<p>An interesting observation is given as follows: The first column of the <span class="math inline">\(X\)</span> matrix is given by <span class="math inline">\(1_n\)</span>, which implies that <span class="math display">\[\bar Y 1=X\begin{bmatrix}
\bar Y\\
0
\end{bmatrix}.\]</span> This means that if we let <span class="math inline">\(\hat\beta_*=(\bar Y,0,\ldots,0)^\top\)</span>, then <span class="math inline">\((Y-\bar Y 1)\)</span> would be the signed distances to (or the residuals of) the regression hyperplane corresponding to <span class="math inline">\(\hat\beta_*\)</span>. Since <span class="math inline">\(\hat\beta\)</span> minimizes the sum of squared residuals, we must have that the hyperplane corresponding to <span class="math inline">\(\hat\beta\)</span> has a smaller sum of squared residuals than the regression hyperplane corresponding to <span class="math inline">\(\hat\beta_*\)</span>. Therefore, we must have that <span class="math inline">\(\hat \epsilon^\top \hat \epsilon\leq (Y-\bar Y 1)^\top (Y-\bar Y 1)\)</span>.</p>
<p>Each of these terms in the decomposition is associated with a certain number of <strong>degrees of freedom</strong>.</p>
<ul>
<li>Total: <span class="math inline">\(dfT=n-1\)</span>.</li>
<li>Model: <span class="math inline">\(dfM=\#\ \textbf{non-zero }\beta-1\)</span>.</li>
<li>Error: <span class="math inline">\(dfE=n-\#\ \textbf{non-zero }\beta\)</span>.</li>
</ul>
<p>Intuitively, since the <span class="math inline">\(SSE\)</span> is the variance unexplained by the model/covariates, the <span class="math inline">\(SSE\)</span> is related to the error variance <span class="math inline">\(\sigma^2\)</span>. In fact, to estimate <span class="math inline">\(\sigma^2\)</span>, we use <span class="math display">\[\hat\sigma^2=MSE=\frac{SSE}{dfE}.\]</span></p>
<p>The null model is defined as <span class="math inline">\(Y|X=\beta_0+\epsilon\)</span>. This is the model where the last <span class="math inline">\(p-1\)</span> terms in the true vector <span class="math inline">\(\beta\)</span> are <span class="math inline">\(0\)</span>. This model says that <span class="math inline">\(Y\)</span> does not depend on <span class="math inline">\(X\)</span>. In the null model, we only need to estimate the mean, so <span class="math inline">\(df=n-1\)</span>. Therefore, under the null model, <span class="math display">\[\begin{align*}
        \hat\sigma^2=(n-1)^{-1}SST&amp;=\hat\sigma_Y^2\\
        &amp;=(n-1)^{-1}\sum_{i=1}^n(Y_i-\bar Y)^2=(n-1)^{-1}(Y-\bar Y 1)^\top (Y-\bar Y 1).
    \end{align*}\]</span> Therefore, in the null model, the estimate of <span class="math inline">\(\sigma^2\)</span> via the <span class="math inline">\(MSE\)</span> is just the usual estimate of the variance of the response. This is intuitive!</p>
<p>The following table can be used to summarize the variation in the response:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><strong>Source</strong></th>
<th><strong>SS</strong></th>
<th><strong>df</strong></th>
<th><strong>MS</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Model</td>
<td><span class="math inline">\(SSM\)</span></td>
<td><span class="math inline">\(dfM\)</span></td>
<td><span class="math inline">\(MSModel = SSM/dfM\)</span></td>
</tr>
<tr class="even">
<td>Residual</td>
<td><span class="math inline">\(SSE\)</span></td>
<td><span class="math inline">\(dfE\)</span></td>
<td><span class="math inline">\(MSE = SSE/dfE\)</span></td>
</tr>
<tr class="odd">
<td>Total</td>
<td><span class="math inline">\(SST\)</span></td>
<td><span class="math inline">\(dfT\)</span></td>
<td></td>
</tr>
</tbody>
</table>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>It is very important to be able to interpret these terms! The derivation is also important. However, we can use a machine to compute anything for us, so memorizing the formula is not helpful.</p>
</div>
</div>
</section>
<section id="coefficients-of-determination" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="coefficients-of-determination"><span class="header-section-number">3.3.3</span> Coefficients of determination</h3>
<p>A model is a good model if it can explain a fair amount of the variation in the response. (You can think that the model explains “changes” in the response.) In other words, <span class="math inline">\(SSModel\)</span> should be as close to <span class="math inline">\(SSTotal\)</span> as possible; or equivalently, <span class="math inline">\(SSError\)</span> should be as close to 0 as possible. Now, “close” is a relative term, and so we need another value to reference to. This is where the <strong><span class="math inline">\(R^2\)</span></strong> comes in: <span class="math display">\[R^2=\frac{SSModel}{SST},\]</span> and is the proportion of variation explained by the model. It is clear that <span class="math inline">\(0 \leq  R^2 \leq 1\)</span>, and so rescaling the data will not affect <span class="math inline">\(R^2\)</span> (like it would affect the sum of squares terms <span class="math inline">\(SST,SSE,SSM\)</span>). If <span class="math inline">\(R^2\)</span> is close to 1, it is large – “close to 1” is a subjective/area dependent. Generally, the larger the <span class="math inline">\(R^2\)</span>, the better the model!</p>
<p>To compare different models, we could potentially add different covariates and see if <span class="math inline">\(R^2\)</span> improves. However, every time you add any variable, <span class="math inline">\(R^2\)</span> will always increase. Therefore, it is common to use the adjusted coefficient of determination: <span class="math display">\[\bar R^2=1-(1-R^2)\frac{n-1}{n-p}.\]</span> Thus, the (adjusted) coefficient of determination can be used as a measure of how well the regression model fits the data (how much variance is explained). It could also be used to compare models.</p>
</section>
<section id="the-f-test" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="the-f-test"><span class="header-section-number">3.3.4</span> The <span class="math inline">\(F\)</span> test</h3>
<p>The coefficients of determination are summary statistics which give an idea of the fit of the model. We would also like a significance test that tells us whether the covariates explain <span class="math inline">\(Y\)</span>, or what we observed was simply due to sampling variation.</p>
<p>If <span class="math inline">\(\beta=(\beta_1,\ldots,\beta_p)^\top\)</span> then let <span class="math inline">\(\tilde\beta=(\beta_2,\ldots,\beta_p)^\top\)</span>. That is <span class="math inline">\(\tilde\beta\)</span> is the regression coefficients without the intercept term. Similarly, let <span class="math inline">\(\tilde{\hat\beta}=(\hat\beta_2,\ldots,\hat\beta_p)^\top\)</span>. Now, we want to avoid the situation where <span class="math inline">\(\tilde\beta=0\)</span> but <span class="math inline">\(\tilde{\hat\beta}\neq 0\)</span> due to sampling variation.</p>
<p>To do this, we perform a significance test: <span class="math display">\[H_0:\tilde\beta=0\qquad vs\qquad H_1:\tilde\beta\neq 0.\]</span></p>
<p>First, we need the normality assumption to perform significance test: Assume <span class="math inline">\(\epsilon_i\sim\mathcal{N}(0,\sigma^2)\)</span>. With this assumption, the model is then known as the <strong>Normal Multiple Linear Regression Model</strong>. It is important to note that the least squares method does not require this assumption, and this assumption is required only for the significance test to be valid. To test the hypothesis stated above, we use the overall <span class="math inline">\(F\)</span> test and the observed test statistic is <span class="math inline">\(F_{obs} = MSModel/MSE.\)</span> Why?</p>
<p>With the extra normality assumption, we have the following holds:</p>
<ul>
<li><span class="math inline">\(Y|X\)</span> is normally distributed.</li>
<li>We have that <span class="math inline">\(SSM/\sigma^2\sim \chi^2_{dfM}\)</span> and <span class="math inline">\(SSE/\sigma^2\sim \chi^2_{dfE}\)</span>.</li>
<li>Furthermore, <span class="math inline">\(SSM\perp SSE\)</span>.</li>
</ul>
<p>Recall that the ratio of two independent <span class="math inline">\(\chi^2\)</span> distributions divided by their respective degrees of freedom follows an <span class="math inline">\(F\)</span> distribution. Therefore, we have that <span class="math inline">\(F_{obs}\sim F_{dfM,dfE}\)</span>. The corresponding p-value is <span class="math inline">\(\Pr(W &gt; F_{obs})\)</span> where <span class="math inline">\(W\sim F_{dfM;dfE}\)</span>. We can alternatively reject the null hypothesis if <span class="math inline">\(F_{obs}&gt;F_{dfM;dfE,1-alpha}\)</span>, where <span class="math inline">\(F_{obs}&gt;F_{dfM;dfE,1-alpha}\)</span> is the <span class="math inline">\(1-\alpha\)</span> quantile of the <span class="math inline">\(F_{dfM,dfE}\)</span> distribution.</p>
<p>We can now present the complete ANOVA table</p>
<table class="caption-top table">
<colgroup>
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 9%">
<col style="width: 30%">
<col style="width: 27%">
<col style="width: 11%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Source</strong></th>
<th><strong>SS</strong></th>
<th><strong>df</strong></th>
<th><strong>MS</strong></th>
<th><strong>F</strong></th>
<th><strong>p-value</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Model</td>
<td><span class="math inline">\(SSM\)</span></td>
<td><span class="math inline">\(dfM\)</span></td>
<td><span class="math inline">\(MSModel = \frac{SSR}{dfM}\)</span></td>
<td><span class="math inline">\(F = \frac{MSModel}{MSE}\)</span></td>
<td><span class="math inline">\(\Pr(W &gt; F_{obs})\)</span></td>
</tr>
<tr class="even">
<td>Residual</td>
<td><span class="math inline">\(SSE\)</span></td>
<td><span class="math inline">\(dfE\)</span></td>
<td><span class="math inline">\(MSE = \frac{SSE}{dfE}\)</span></td>
<td></td>
<td></td>
</tr>
<tr class="odd">
<td>Total</td>
<td><span class="math inline">\(SST\)</span></td>
<td><span class="math inline">\(dfT\)</span></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<div id="exm-3-3-2" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.4</strong></span> In <a href="#exm-3-1-1" class="quarto-xref">Example&nbsp;<span>3.1</span></a>, compute and interpret the coefficients of determination. Compute and interpret the ANOVA table. Test whether the regression model is significant. (This means perform the <span class="math inline">\(F\)</span> test.)</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># recall</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Weight BodyFat
1    175       6
2    181      21
3    200      15
4    159       6
5    196      22
6    192      31</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The F test results are given in the summary</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = BodyFat ~ Weight, data = df)

Residuals:
     Min       1Q   Median       3Q      Max 
-12.5935  -5.7904   0.6536   5.2731  10.4004 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -27.37626   11.54743  -2.371 0.029119 *  
Weight        0.24987    0.06065   4.120 0.000643 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 7.049 on 18 degrees of freedom
Multiple R-squared:  0.4853,    Adjusted R-squared:  0.4567 
F-statistic: 16.97 on 1 and 18 DF,  p-value: 0.0006434</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The ANOVA table is given below</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co"># First define the null model object using lm()</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co"># This line fits a model with only the intercept term</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>null_model<span class="ot">=</span><span class="fu">lm</span>(BodyFat<span class="sc">~</span><span class="dv">1</span>,<span class="at">data=</span>df)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># This line gets the ANOVA table</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(null_model,model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: BodyFat ~ 1
Model 2: BodyFat ~ Weight
  Res.Df     RSS Df Sum of Sq      F    Pr(&gt;F)    
1     19 1737.75                                  
2     18  894.42  1    843.33 16.972 0.0006434 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can also do this by hand: </span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Store sample size</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="fu">nrow</span>(df)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>p<span class="ot">=</span><span class="dv">2</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute sum of squares</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>SST<span class="ot">=</span><span class="fu">t</span>(Y<span class="sc">-</span><span class="fu">mean</span>(Y)<span class="sc">*</span><span class="fu">rep</span>(<span class="dv">1</span>,n))<span class="sc">%*%</span>(Y<span class="sc">-</span><span class="fu">mean</span>(Y)<span class="sc">*</span><span class="fu">rep</span>(<span class="dv">1</span>,n))</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>Yhat<span class="ot">=</span>X<span class="sc">%*%</span>beta_hat</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>res<span class="ot">=</span>Y<span class="sc">-</span>Yhat</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>SSE<span class="ot">=</span><span class="fu">t</span>(res)<span class="sc">%*%</span>res</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>SSM<span class="ot">=</span>SST<span class="sc">-</span>SSE</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>dfe<span class="ot">=</span>n<span class="sc">-</span>p</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>dfm<span class="ot">=</span>p<span class="dv">-1</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>MSM<span class="ot">=</span>SSM<span class="sc">/</span>dfm</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>MSE<span class="ot">=</span>SSE<span class="sc">/</span>dfe</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>Fv<span class="ot">=</span>MSM<span class="sc">/</span>MSE</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>p.val<span class="ot">=</span><span class="dv">1</span><span class="sc">-</span><span class="fu">pf</span>(Fv,dfm,dfe)</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a><span class="co"># ANOVA Table:</span></span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a>ANOVA_Table<span class="ot">=</span><span class="fu">rbind</span>(<span class="fu">c</span>(SSM,dfe,MSM,Fv,p.val),<span class="fu">c</span>(SSE,dfe,MSE,<span class="cn">NA</span>,<span class="cn">NA</span>),<span class="fu">c</span>(SST,n<span class="dv">-1</span>,<span class="cn">NA</span>,<span class="cn">NA</span>,<span class="cn">NA</span>))</span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(ANOVA_Table)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"Model"</span>,<span class="st">"Error"</span>,<span class="st">"Total"</span>)</span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(ANOVA_Table)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"SS"</span>,<span class="st">"df"</span>,<span class="st">"MS"</span>,<span class="st">"F"</span>,<span class="st">"p-value"</span>)</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>ANOVA_Table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             SS df        MS        F      p-value
Model  843.3252 18 843.32521 16.97164 0.0006434484
Error  894.4248 18  49.69027       NA           NA
Total 1737.7500 19        NA       NA           NA</code></pre>
</div>
</div>
</section>
<section id="homework-stop-3" class="level3" data-number="3.3.5">
<h3 data-number="3.3.5" class="anchored" data-anchor-id="homework-stop-3"><span class="header-section-number">3.3.5</span> Homework stop 3</h3>
<div id="exr-3-3-1" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.9</strong></span> In the following real data example: <strong>Compute and interpret</strong> the coefficient of determination, the adjusted coefficient of determination and perform the <span class="math inline">\(F\)</span> test for model significance. Including printing the ANOVA table, the null and alternative hypothesis, an interpretation of the p-value and the conclusion of the test.</p>
<p>It is challenging to assess a student’s understanding of a subject without administering an exam. However, we can easily record the number of hours a student studies. A researcher would like to know if the number of hours studied and exam scores are related. This researcher collected the following data:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Student</th>
<th>Hours Studied</th>
<th>Exam Score (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>5</td>
<td>55</td>
</tr>
<tr class="even">
<td>2</td>
<td>8</td>
<td>65</td>
</tr>
<tr class="odd">
<td>3</td>
<td>12</td>
<td>78</td>
</tr>
<tr class="even">
<td>4</td>
<td>6</td>
<td>58</td>
</tr>
<tr class="odd">
<td>5</td>
<td>10</td>
<td>72</td>
</tr>
<tr class="even">
<td>6</td>
<td>9</td>
<td>68</td>
</tr>
<tr class="odd">
<td>7</td>
<td>15</td>
<td>85</td>
</tr>
<tr class="even">
<td>8</td>
<td>7</td>
<td>60</td>
</tr>
<tr class="odd">
<td>9</td>
<td>11</td>
<td>74</td>
</tr>
<tr class="even">
<td>10</td>
<td>13</td>
<td>80</td>
</tr>
<tr class="odd">
<td>11</td>
<td>14</td>
<td>82</td>
</tr>
<tr class="even">
<td>12</td>
<td>20</td>
<td>90</td>
</tr>
<tr class="odd">
<td>13</td>
<td>5</td>
<td>55</td>
</tr>
<tr class="even">
<td>14</td>
<td>6</td>
<td>59</td>
</tr>
<tr class="odd">
<td>15</td>
<td>18</td>
<td>88</td>
</tr>
<tr class="even">
<td>16</td>
<td>7</td>
<td>62</td>
</tr>
<tr class="odd">
<td>17</td>
<td>16</td>
<td>86</td>
</tr>
<tr class="even">
<td>18</td>
<td>4</td>
<td>50</td>
</tr>
<tr class="odd">
<td>19</td>
<td>3</td>
<td>45</td>
</tr>
<tr class="even">
<td>20</td>
<td>19</td>
<td>89</td>
</tr>
</tbody>
</table>
<p>To help you, here is some R code the dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>study_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Student =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>,</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Hours_Studied =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">6</span>, <span class="dv">10</span>, <span class="dv">9</span>, <span class="dv">15</span>, <span class="dv">7</span>, <span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">20</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">18</span>, <span class="dv">7</span>, <span class="dv">16</span>, <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">19</span>),</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Exam_Score =</span> <span class="fu">c</span>(<span class="dv">55</span>, <span class="dv">65</span>, <span class="dv">78</span>, <span class="dv">58</span>, <span class="dv">72</span>, <span class="dv">68</span>, <span class="dv">85</span>, <span class="dv">60</span>, <span class="dv">74</span>, <span class="dv">80</span>, <span class="dv">82</span>, <span class="dv">90</span>, <span class="dv">55</span>, <span class="dv">59</span>, <span class="dv">88</span>, <span class="dv">62</span>, <span class="dv">86</span>, <span class="dv">50</span>, <span class="dv">45</span>, <span class="dv">89</span>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="exr-3-3-2" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.10</strong></span> Write down the interpretations of: <span class="math inline">\(SSE,\ MSE,\ R^2,\ \bar R^2,\ SSM\)</span>.</p>
</div>
<div id="exr-3-3-3" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.11</strong></span> What is the interpretation of the p-value in the ANOVA table?</p>
</div>
<div id="exr-3-3-4" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.12</strong></span> What extra assumption is needed to perform the <span class="math inline">\(F\)</span>-test?</p>
</div>
</section>
<section id="significance-of-one-variable" class="level3" data-number="3.3.6">
<h3 data-number="3.3.6" class="anchored" data-anchor-id="significance-of-one-variable"><span class="header-section-number">3.3.6</span> Significance of one variable</h3>
<p>So far, we have learned that the least squares method yields the following estimate of <span class="math inline">\(\hat\beta = (X^\top X)^{-1} X^\top Y\)</span> with <span class="math inline">\({\textrm{E}}\left[\hat\beta\right] = \beta\)</span> and <span class="math inline">\({\textrm{cov}}(\hat\beta) = (X^\top X)^{-1} \sigma^2\)</span>. Moreover, we use <span class="math inline">\(MSE\)</span> to estimate <span class="math inline">\(\sigma^2\)</span>. Next, we learned that we can summarize the <span class="math inline">\(SS,\ df\)</span>, and <span class="math inline">\(MS\)</span> in an ANOVA table. We used the <span class="math inline">\(F\)</span> test and the coefficient of determination to evaluate the quality of the model, i.e., to see the amount of information <span class="math inline">\(X\)</span> provides about <span class="math inline">\(Y\)</span>.</p>
<p>When the model is a significant model, then, at least one of the individual explanatory variables is useful in explaining the response. We may be interested in whether a specific covariate, or set of covariates is useful in explaining the response variable. We now learn how we can test for the significance of each individual explanatory variable separately and how we can test for the significance of a subset of explanatory variables. Note that these tests also require that the random error is normally distributed.</p>
<p>To test for significance and compute confidence intervals of a single variate, we have to compute the distribution of <span class="math inline">\(\hat\beta_j\)</span>. We first compute the mean and variance of <span class="math inline">\(\hat\beta_j\)</span>. First, given that <span class="math inline">\({\textrm{E}}(\hat\beta) = \beta\)</span>, we have <span class="math inline">\({\textrm{E}}(\hat\beta_j) = \beta_j\)</span>. Next, <span class="math inline">\({\textrm{Var}}\left[\hat\beta_j\right]\)</span> is the <span class="math inline">\((j, j)^{th}\)</span> entry of <span class="math inline">\({\textrm{cov}}(\hat\beta)\)</span>. In addition, we have derived that <span class="math inline">\({\textrm{cov}}(\hat\beta) = (X^\top X)^{-1} \sigma^2\)</span>.</p>
<p>Now, recall that if <span class="math inline">\(Z\)</span> is multivariate normal, i.e., <span class="math inline">\(Z\sim\mathcal{N}(\mu,\Sigma)\)</span>, then <span class="math inline">\(b+AZ\sim\mathcal{N}(b+A\mu,A\Sigma A^\top)\)</span>, i.e., <span class="math inline">\(b+AZ\)</span> is also multivariate normal. Therefore, since we have assumed that <span class="math inline">\(\epsilon\sim \mathcal{N}_n(0,\sigma^2 I)\)</span> and that <span class="math inline">\(Y|X=X\beta+\epsilon\)</span>, it follows that <span class="math inline">\(Y|X\sim \mathcal{N}_n(X\beta,\sigma^2 I)\)</span>. Next, we may recall that <span class="math inline">\(\hat\beta=(X^\top X)^{-1} XY\)</span>. Let <span class="math inline">\(A=(X^\top X)^{-1} X\)</span>. Then <span class="math inline">\(\hat\beta=AY\)</span>. It follows that <span class="math inline">\(\hat\beta\)</span> is also multivariate normal! Putting everything together, we have that <span class="math inline">\(\hat\beta\sim \mathcal{N}_p(\beta,(X^\top X)^{-1} \sigma^2)\)</span>.</p>
<div id="thm-3-4-1" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3.1</strong></span> Under the assumptions of the <strong>normal linear regression model</strong> it holds that <span class="math inline">\(\hat\beta\sim \mathcal{N}_p(\beta,(X^\top X)^{-1} \sigma^2)\)</span>.</p>
</div>
<p>Now that we have the distribution of <span class="math inline">\(\hat\beta\)</span>, we can use it to compute the confidence intervals for <span class="math inline">\(\beta_j\)</span>s.</p>
<p>Recall from introductory statistics (MATH 1131) that you learned that if we want to compute a confidence interval for the sample mean and the sample variance was unknown, we had to estimate the variance. Similarly, here, the variance of <span class="math inline">\(\hat\beta_j\)</span> contains <span class="math inline">\(\sigma\)</span>, an unknown parameter. Recall that, we estimate <span class="math inline">\(\sigma^2\)</span> by <span class="math inline">\(MSE\)</span>, and so we can estimate the variance of <span class="math inline">\(\hat\beta_j\)</span> by <span class="math inline">\(\hat{\textrm{Var}}\left[\hat\beta_j\right] = (X^\top X)_{j,j}^{-1} MSE\)</span>.</p>
<p>It can be shown that <span class="math inline">\(\hat\beta\perp MSE\)</span>. Therefore, we have that <span class="math display">\[\frac{\hat\beta_j - \beta_j}{\sqrt{\widehat{var}(\hat\beta_j)}}\sim t_{dfE}.\]</span></p>
<p>Now that we know the distribution of <span class="math inline">\(\hat\beta_j\)</span>, we can perform significance testing and compute confidence intervals.</p>
<p>If we want to test <span class="math display">\[H_0\colon \beta_j=\beta_j^0\qquad vs \qquad \beta_j\neq\beta_j^0\]</span> we can do the following.</p>
<p>The observed test statistic is <span class="math inline">\(TS=\frac{\hat\beta_j - \beta_j^0}{\sqrt{\widehat{var}(\hat\beta_j)}}\)</span>. Note that, under the null hypothesis, we have that <span class="math inline">\(\frac{\hat\beta_j - \beta_j^0}{\sqrt{\widehat{var}(\hat\beta_j)}}\sim t_{dfE}\)</span>. Thus, the corresponding <span class="math inline">\(p\)</span>-value is obtained based on the <span class="math inline">\(t_{dfE}\)</span> distribution. Specifically, we can compute the p-value <span class="math inline">\(\Pr\left(-|TS|&lt;Z\right)+\Pr\left(|TS|&gt;Z\right)=2*\Pr\left(|TS|&gt;Z\right)\)</span>, where <span class="math inline">\(Z\sim t_{dfE}\)</span>.</p>
<p>The test proceeds as follows:</p>
<ol type="1">
<li>State the hypotheses <span class="math display">\[H_0\colon \beta_j=\beta_j^0\qquad vs \qquad H_1:\ \beta_j\neq\beta_j^0.\]</span></li>
<li>Compute the test statistic <span class="math inline">\(\frac{\hat\beta_j - \beta_j^0}{\sqrt{\widehat{var}(\hat\beta_j)}}\)</span> and the p-value.</li>
<li>Interpret the p-value, and use it to decide whether you reject the null hypothesis.</li>
</ol>
<p>Often, one may choose a threshold <span class="math inline">\(\alpha\)</span>, and reject the null hypothesis if the p-value falls below that threshold. Other times, we use the p-value as a description of evidence against the null. If it is larger than 0.05, but still small, then that still constitutes some evidence against the null hypothesis.</p>
<p>Let’s now discuss one-sided hypotheses. First, consider: <span class="math display">\[H_0\colon \beta_j\leq  \beta_j^0\qquad vs \qquad H_1:\ \beta_j&gt; \beta_j^0\]</span> Then, if the alternative hypothesis is true, we expect <span class="math inline">\(TS\)</span> to be positive. The p-value is given by <span class="math inline">\(\Pr\left(TS&gt;Z\right)\)</span>, where <span class="math inline">\(Z\sim t_{dfE}\)</span>. Notice that the p-value is measuring how extremely positive <span class="math inline">\(TS\)</span> is. Using the threshold method, we can also check if <span class="math inline">\(TS&gt; t_{dfE,1-\alpha}\)</span>. Next, if we want to test <span class="math display">\[H_0\colon \beta_j\geq  \beta_j^0\qquad vs \qquad H_1:\ \beta_j&lt; \beta_j^0,\]</span> then if the alternative hypothesis is true, we expect <span class="math inline">\(TS\)</span> to be negative. The p-value is given by <span class="math inline">\(\Pr\left(TS&lt;Z\right)\)</span>, where <span class="math inline">\(Z\sim t_{dfE}\)</span>. Notice that the p-value is measuring how extremely negative <span class="math inline">\(TS\)</span> is. Using the threshold method, we can also check if <span class="math inline">\(TS&lt; t_{dfE,\alpha}\)</span>.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>We use <span class="math inline">\(t_{k, p}\)</span> to denote the <span class="math inline">\(p\)</span>th quantile of the <span class="math inline">\(t\)</span> distribution with <span class="math inline">\(k\)</span> degrees of freedom. For <span class="math inline">\(p=0.025\)</span> and large <span class="math inline">\(k\)</span>, this is approximately equal to 2.</p>
</div>
</div>
<div class="{@exm-3-4-1}">
<p>In <a href="#exm-3-1-1" class="quarto-xref">Example&nbsp;<span>3.1</span></a>, test if the coefficient for weight is not equal to 1. Next, test if the coefficient for weight is greater than 1. Lastly, test if the coefficient for weight is not equal to 0.</p>
</div>
<p>First, we have that <span class="math display">\[H_0\colon \beta_1= 15\qquad vs \qquad H_1:\ \beta_1\neq 15.\]</span> Now, let’s execute the test:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">#changing matrix to scalar</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>MSE<span class="ot">=</span><span class="fu">c</span>(MSE)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>hvar_beta<span class="ot">=</span><span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X)<span class="sc">*</span>MSE</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>TS<span class="ot">=</span>beta_hat[<span class="dv">2</span>]<span class="sc">/</span><span class="fu">sqrt</span>(hvar_beta[<span class="dv">2</span>,<span class="dv">2</span>])</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co"># not equal</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co"># pt(x,df) is the CDF of a t distributed RV with df degrees of freedom at x. </span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>p_val<span class="ot">=</span><span class="dv">2</span><span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">pt</span>(<span class="fu">abs</span>(TS),dfe))</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>p_val</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0006434484</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can also use the model object to test if it is not equal to 0: </span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The test statistic and the pvalue are given in the t value and Pr(&gt;|t|)  columns, respectively. </span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = BodyFat ~ Weight, data = df)

Residuals:
     Min       1Q   Median       3Q      Max 
-12.5935  -5.7904   0.6536   5.2731  10.4004 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -27.37626   11.54743  -2.371 0.029119 *  
Weight        0.24987    0.06065   4.120 0.000643 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 7.049 on 18 degrees of freedom
Multiple R-squared:  0.4853,    Adjusted R-squared:  0.4567 
F-statistic: 16.97 on 1 and 18 DF,  p-value: 0.0006434</code></pre>
</div>
</div>
<p>Based on the concepts that you have learned in 1131, and what we have reviewed in previous lectures, it also follows from the above analysis that a <span class="math inline">\((1-\alpha)100%\)</span> confidence interval for <span class="math inline">\(\beta_j\)</span> is</p>
<p><span class="math display">\[
\hat\beta_j \pm t_{dfE, \alpha/2} \sqrt{\widehat{var}(\hat\beta_j)}.
\]</span> :::{#exm-3-4-2} In <a href="#exm-3-1-1" class="quarto-xref">Example&nbsp;<span>3.1</span></a>, compute a 99% and a 95% confidence interval for the coefficient for weight. Which one is longer? Why? Interpret these intervals. :::</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># By hand</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>beta_hat[<span class="dv">2</span>]<span class="sc">+</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">*</span><span class="fu">qt</span>(<span class="fl">0.975</span>,dfe)<span class="sc">*</span><span class="fu">sqrt</span>(hvar_beta[<span class="dv">2</span>,<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1224448 0.3773035</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>beta_hat[<span class="dv">2</span>]<span class="sc">+</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">1</span>)<span class="sc">*</span><span class="fu">qt</span>(<span class="fl">0.995</span>,dfe)<span class="sc">*</span><span class="fu">sqrt</span>(hvar_beta[<span class="dv">2</span>,<span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.07528522 0.42446306</code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Auto software/using lm:</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(model,<span class="at">level=</span><span class="fl">0.95</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  2.5 %     97.5 %
(Intercept) -51.6365090 -3.1160157
Weight        0.1224448  0.3773035</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(model,<span class="at">level=</span><span class="fl">0.99</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   0.5 %    99.5 %
(Intercept) -60.61484736 5.8623227
Weight        0.07528522 0.4244631</code></pre>
</div>
</div>
<p>If we took many samples of size 20 and computed a 95% (99%) confidence interval for each sample, then 95% (99%) of then would contain the true coefficient for the weight variable. We can conclude that with 95% (99%) confidence, the true coefficient for weight likely falls within (0.12, 0.38) ((0.08,0.42)).</p>
<div class="callout callout-style-default callout-caution callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Caution
</div>
</div>
<div class="callout-body-container callout-body">
<p>The key to understanding a confidence interval is to realize that the end points of the interval depend on the sample, and are therefore, random. On the other hand, the population parameter is not random, it is fixed. Therefore, if we drew a different sample, the interval would move, and there is a <span class="math inline">\((1-100\alpha )\)</span>% chance that that interval catches the population parameter. Most of the time it will contain the parameter, but not always.</p>
</div>
</div>
<p>Recall that the point of computing a confidence interval is to report the uncertainty in our estimate that resulted from drawing a sample. We expect the true parameter to be somewhere in that range, and our best guess at the parameter is given by the center of the interval.</p>
</section>
<section id="inference-for-the-mean-response-and-prediction-intervals" class="level3" data-number="3.3.7">
<h3 data-number="3.3.7" class="anchored" data-anchor-id="inference-for-the-mean-response-and-prediction-intervals"><span class="header-section-number">3.3.7</span> Inference for the mean response and prediction intervals</h3>
<p>We may wish to estimate the average response at a specific set of the covariates <span class="math inline">\(x\)</span>. Given <span class="math inline">\(x\)</span>, the theoretical mean response is <span class="math inline">\(x^\top \beta\)</span>. Given <span class="math inline">\(x\)</span>, we can estimate the mean response as <span class="math inline">\(x^\top \hat\beta\)</span>. For instance, what is the average body fat percentage at 160 pounds? How accurate is our estimate? We can use a confidence interval to answer this question.</p>
<p>Note that the expectation and variance of the estimate of the mean response are given by <span class="math inline">\({\textrm{E}}\left[x^\top \hat\beta\right]=x^\top \beta\)</span> and <span class="math inline">\({\textrm{Var}}\left[x^\top \hat\beta\right]=x^\top(X^\top X)^{-1}x\sigma^2\)</span>. Again, we must estimate <span class="math inline">\(\sigma\)</span> and we can write <span class="math inline">\(\hat{\textrm{Var}}\left[x^\top \hat\beta\right]=x^\top(X^\top X)^{-1}x MSE\)</span>.</p>
<div id="exr-3-4-1" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.13</strong></span> Under the assumptions of the normal linear regression model, show that for a fixed covariate vector <span class="math inline">\(x\in\mathbb{R}^p\)</span>, <span class="math inline">\(x^\top \hat\beta\)</span> has a multivariate normal distribution and find it’s mean and variance. Argue that <span class="math inline">\(\frac{x^\top\hat\beta - x^\top \beta}{\sqrt{\hat{\textrm{Var}}\left[x^\top \hat\beta\right]}}\sim t_{dfE}\)</span>.</p>
</div>
<p>It can be shown that a (<span class="math inline">\(1-\alpha)100\)</span>% confidence interval for the mean response <span class="math inline">\({\textrm{E}}\left[Y|X=x\right]\)</span> is <span class="math display">\[x^\top\hat\beta\pm t_{dfE,\alpha/2}\sqrt{\hat{\textrm{Var}}\left[x^\top \hat\beta\right]}.\]</span></p>
<p>Similarly, if we want to test <span class="math display">\[H_0\colon {\textrm{E}}\left[Y|X=x\right]=\mu_0\qquad vs \qquad {\textrm{E}}\left[Y|X=x\right]\neq \mu_0\]</span> we can do the following:</p>
<p>The observed test statistic is <span class="math inline">\(TS(x,\mu_0)=\frac{x^\top\hat\beta - \mu_0}{\sqrt{\hat{\textrm{Var}}\left[x^\top \hat\beta\right]}}\)</span>. Observe that under the null hypothesis, we have that <span class="math inline">\(TS(x,\mu_0)\sim t_{dfE}\)</span>. Therefore, the p-value is given by <span class="math inline">\(2*\Pr\left(|TS(x,\mu_0)|&gt;Z\right)\)</span>.</p>
<p>Similar to the previous section, we can also perform one-sided tests:</p>
<ul>
<li>Right-sided test <span class="math inline">\((H_1\colon x^\top \beta&gt;\mu_0\ )\)</span>: p-value <span class="math inline">\(\Pr\left(TS(x,\mu_0)&gt;Z\right)\)</span>.</li>
<li>Left-sided test <span class="math inline">\((H_1\colon x^\top \beta&lt;\mu_0\ )\)</span>: p-value <span class="math inline">\(\Pr\left(TS(x,\mu_0)&lt;Z\right)\)</span>.</li>
</ul>
<p>We may also wish to predict what the response will be, given a new set of covariates. On top of that, we may again wish to quantify how much error there is in our prediction. For instance, what is the predicted body fat percentage of someone who is 160 pounds? Note that this differs from the previous section. In the previous section, we were interested in the average body fat percentage of someone who is 160 pounds. Here, we are interested in predicting the body fat percentage of a single, specific person, and not the average of the whole population.</p>
<p>Specifically, suppose that we have a subject whose covariates are given by <span class="math inline">\(z\)</span>, but we do not know the value of the subjects response, which we can denote by <span class="math inline">\(Y_{new}\)</span>. Then the true response is <span class="math inline">\((Y_{new}|Z=z)\ =z^\top\beta+\epsilon_{new}\)</span>.</p>
<p>Suppose we want to predict <span class="math inline">\(Y_{new}\)</span> and give an idea of how much error is in our prediction. The predicted response is known, and is given by <span class="math inline">\({\textrm{E}}\left[Y_{new}|Z=z\right]=z^\top\hat\beta\)</span>. We have <span class="math inline">\({\textrm{Var}}\left[Y_{new}|Z=z\right]={\textrm{Var}}\left[z\hat\beta\right]+{\textrm{Var}}\left[\epsilon_{new}\right]=z^\top(X^\top X)^{-1}z\sigma^2+\sigma^2\)</span>. Therefore, the variation in a new response is the variation in our estimate of <span class="math inline">\(\beta\)</span> plus the inherent population variation, <span class="math inline">\(\sigma^2\)</span>. We have that this can be estimated with: <span class="math inline">\(\hat{\textrm{Var}}\left[Y_{new}|Z=z\right]=z^\top(X^\top X)^{-1}zMSE+MSE\)</span>.</p>
<div id="exr-3-4-1" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.14</strong></span> Under the assumptions of the normal linear regression model, show that for a fixed covariate vector <span class="math inline">\(z\in\mathbb{R}^p\)</span>, <span class="math inline">\(Y_{new}|Z=z\)</span> has a multivariate normal distribution and find it’s mean and variance. Argue that given <span class="math inline">\(Z=z\)</span>, <span class="math display">\[\frac{Y_{new}-z^\top\beta}{\sqrt{\hat{\textrm{Var}}\left[Y_{new}\right]}} \sim t_{dfE}.\]</span></p>
</div>
<p>Therefore, the (<span class="math inline">\(1-\alpha)100\)</span>% prediction interval for <span class="math inline">\(Y_{new}\)</span> is given by: <span class="math display">\[z\hat\beta\pm t_{dfE,\alpha/2}\sqrt{z^\top(X^\top X)^{-1}zMSE+MSE}.\]</span></p>
<p>Note that the prediction interval is wider than that of the mean response interval for the same covariate vector <span class="math inline">\(z\)</span>. That is because it is more difficult to predict the response for a specific person than it is to estimate a mean of a population. Furthermore, the interpretation of a prediction interval is different. A (<span class="math inline">\(1-\alpha)100\)</span>% prediction interval can be interpreted it as follows. Given a (<span class="math inline">\(1-\alpha)100\)</span>% prediction interval for <span class="math inline">\(Y_{new}|Z=z\)</span>, say <span class="math inline">\((a,b)\)</span>, we say that the probability <span class="math inline">\(Y_{new}\)</span> is in <span class="math inline">\((a,b)\)</span> is (<span class="math inline">\(1-\alpha)100\)</span>%. Note that this differs substantially from a confidence interval!</p>
<div id="exm-3-4-3" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.5</strong></span> In <a href="#exm-3-1-1" class="quarto-xref">Example&nbsp;<span>3.1</span></a>, execute the following: What is a 95% confidence interval for the mean of someone who weighs 165 pounds? What is a 95% confidence interval for predicted BF% of someone who weighs 165 pounds? Interpret these intervals.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Intervals are given as follows:</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Weight=</span><span class="dv">165</span>)</span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model, <span class="at">newdata =</span> z, <span class="at">interval =</span> <span class="st">'confidence'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 13.85297 9.379675 18.32627</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model, <span class="at">newdata =</span> z, <span class="at">interval =</span> <span class="st">'prediction'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit       lwr      upr
1 13.85297 -1.617547 29.32349</code></pre>
</div>
</div>
<p>We are 95% confident the mean body fat of a person who weighs 165 pounds is in 13.8529704, 9.3796749, 18.3262658. There is a 95% probability that the body fat of a person who weights 165 pounds is in 13.8529704, -1.6175473, 29.323488 . Note that the prediction interval is wider!</p>
</section>
<section id="homework-stop-4" class="level3" data-number="3.3.8">
<h3 data-number="3.3.8" class="anchored" data-anchor-id="homework-stop-4"><span class="header-section-number">3.3.8</span> Homework stop 4</h3>
<div id="exr-3-4-3" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.15</strong></span> What is the difference between a prediction interval and an interval for the mean response ?</p>
</div>
<div id="exr-3-4-4" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.16</strong></span> Code the confidence intervals for the mean response and prediction interval without using the predict function.</p>
</div>
<div id="exr-3-4-5" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.17</strong></span> Do the chapter 3 practice problems from the problem list.</p>
</div>
</section>
<section id="partial-testing" class="level3" data-number="3.3.9">
<h3 data-number="3.3.9" class="anchored" data-anchor-id="partial-testing"><span class="header-section-number">3.3.9</span> Partial testing</h3>
<p>We may be interested in executing the following hypothesis test: <span class="math display">\[H_0\colon (\beta_1,\ldots,\beta_k)=0\qquad vs \qquad (\beta_1,\ldots,\beta_k)\neq 0.\]</span> This amounts to testing whether the subset of variables <span class="math inline">\((\beta_1,\ldots,\beta_k)\)</span> adds anything to the model beyond <span class="math inline">\((\beta_{k+1},\ldots,\beta_p)\)</span>. For example, you may be interested in whether location related covariates affect the price of Airbnb. The overall idea is to compare the reduced (null) model with <span class="math inline">\(p-k\)</span> covariates to the complete (saturated, full) model (which contains all covariates).</p>
<p>Let’s first review the <span class="math inline">\(F\)</span>-test. We learned about the <span class="math inline">\(F\)</span> test, which compares the following models: <span class="math display">\[Y|X=\beta^\top X+\epsilon \qquad vs \qquad  Y|X=\beta_1+\epsilon.\]</span> Here, the complete model is given by <span class="math inline">\(Y|X=\beta^\top X+\epsilon\)</span> and the reduced model is given by <span class="math inline">\(Y|X=\beta_1+\epsilon\)</span>. Recall that the test statistic is given by <span class="math display">\[\frac{SSM/dfM}{SSE/dfE}=\frac{( SST-SSE)/(dfT-dfE)}{SSE/dfE},\]</span> where the degrees of freedom are in terms of the full model (not the null model). We could then rewrite this test statistic as <span class="math display">\[\frac{SSM_C/dfM_C}{SSE_C/dfE_C}=\frac{( SST_C-SSE_C)/(dfT_C-dfE_C)}{SSE_C/dfE_C},\]</span> where <span class="math inline">\(C\)</span> stands for the complete model. (All that has changed is the notation, we added a <span class="math inline">\(C\)</span> subscript.)</p>
<p>Now, note that <span class="math inline">\(SST=\sum_{i=1}^n(Y_i-\bar Y)^2\)</span> has nothing to do with what covariates are in the model. In other words, <span class="math inline">\(SST\)</span> is always the same, not matter what covariates are in the model. Therefore, <span class="math inline">\(SST_C=SST_R=SST\)</span>, where <span class="math inline">\(SST_R\)</span> stands for the “sum of squares total” in the reduced model. In our example of the <span class="math inline">\(F\)</span> test, the least squares estimate of <span class="math inline">\(\beta_1\)</span> in the reduced model is <span class="math inline">\(\hat\beta_1=\bar Y\)</span> and the associated residual vector is given by <span class="math inline">\(\hat\epsilon=Y-\bar Y 1_n\)</span>. But wait, observe that in this case, we have that <span class="math inline">\(\hat\epsilon^\top \hat\epsilon=SST!\)</span> Therefore, putting everything together, in this example, we have that <span class="math inline">\(SSM_C=SST_C-SSE_C=SSE_R-SSE_C\)</span>. That is, the model sum of squares for the complete model is the difference between the sum-squared error in the reduced model and the sum-squared error in the complete model. We can then rewrite the test statistic as <span class="math display">\[\frac{( SSE_R-SSE_C)/(dfT_C-dfE_C)}{SSE_C/dfE_C}.\]</span> The difference <span class="math inline">\(SSE_R-SSE_C\)</span> can be interpreted as the extra information gained from adding the covariates into the model OR total explained variations lost by going from the full model to the reduced model.</p>
<p>This idea can be generalized to develop a general method for testing hypotheses of the type: <span class="math display">\[H_0\colon (\beta_2,\ldots,\beta_k)=0\qquad vs \qquad (\beta_2,\ldots,\beta_k)\neq 0.\]</span> We complete the test as follows. Given a full model (which contains <span class="math inline">\(\beta_1,\ldots,\beta_p\)</span>) and reduced model (which contains <span class="math inline">\(\{\beta_1,\beta_{k+1},\ldots,\beta_p\}\)</span>), define:</p>
<ul>
<li><span class="math inline">\(SSE_R-SSE_C=SSdrop\)</span></li>
<li><span class="math inline">\(dfE_R-dfE_C=dfdrop\)</span></li>
<li><span class="math inline">\(MSdrop=SSdrop/dfdrop\)</span></li>
</ul>
<p>Then the test statistic and p-value are given by: <span class="math inline">\(TS=MSdrop/MSE_C\)</span> and <span class="math inline">\(\Pr\left(F_{dfdrop,dfE_C}\geq TS\right)\)</span>, respectively.</p>
<p>We can interpret <span class="math inline">\(SSE_R-SSE_C\)</span> as the extra info gained from adding the extra covariates into the model OR total explained variations lost by going from the full model to the reduced model. In addition, <span class="math inline">\(dfE_R-dfE_C=k-1\)</span>, or the number of covariates dropped from the full model to obtain the reduced model.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you take <span class="math inline">\(k=1\)</span>, then this is equivalent to the <span class="math inline">\(t\)</span>-test!</p>
</div>
</div>
</section>
<section id="partial-coefficient-of-determination" class="level3" data-number="3.3.10">
<h3 data-number="3.3.10" class="anchored" data-anchor-id="partial-coefficient-of-determination"><span class="header-section-number">3.3.10</span> Partial coefficient of determination</h3>
<p>We can define the <strong>partial coefficient of determination</strong> as follows:</p>
<p><span class="math display">\[\begin{align*}
    R^2(X_1,\ldots,X_{k-1}|X_{k},\ldots,X_p)&amp;=(SSE_R-SSE_C)/SSE_R\\
    &amp;=SSdrop/SSE_R.
\end{align*}\]</span> You might also see the partial correlation coefficient: <span class="math display">\[R(X_1,\ldots,X_{k-1}|X_{k},\ldots,X_p)=\sqrt{ R^2(X_1,\ldots,X_{k-1}|X_{k},\ldots,X_p)}.\]</span></p>
<p>This quantity is the extra proportion of variation explained from adding the covariates <span class="math inline">\(X_1,\ldots,X_{k-1}\)</span> to the model which already contains <span class="math inline">\(X_{k},\ldots,X_p\)</span>.</p>
<div id="exm-3-4-5" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.6</strong></span> A researcher ran an experiment to see if YouTube, Facebook and newspaper ads would improve sales. Run the partial <span class="math inline">\(F\)</span> test to see how online advertising affects sales. Compute and interpret the following quantities:</p>
<ul>
<li><span class="math inline">\(SSE_R - SSE_C = SSdrop\)</span></li>
<li><span class="math inline">\(dfE_R - dfE_C = dfdrop\)</span></li>
<li><span class="math inline">\(MSdrop = SSdrop/dfdrop\)</span></li>
<li>Test stat: <span class="math inline">\(TS = MSdrop/MSE_C\)</span></li>
<li>p-value: <span class="math inline">\(\Pr (F_{dfdrop,dfE_C} \geq TS)\)</span></li>
<li>Partial coefficient of determination</li>
</ul>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages('datarium')                         </span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"marketing"</span>, <span class="at">package =</span> <span class="st">"datarium"</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co">#printing out first few rows</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(marketing, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  youtube facebook newspaper sales
1  276.12    45.36     83.04 26.52
2   53.40    47.16     54.12 12.48
3   20.64    55.08     83.16 11.16
4  181.80    49.56     70.20 22.20</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(marketing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co">#setting n to be a variable (sample size)</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="fu">nrow</span>(marketing)</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimation: How to get an estimate $\hat\beta$ of $\beta$?</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="co"># lm( sales~   , data= marketing)</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>full_model<span class="ot">&lt;-</span> <span class="fu">lm</span>(sales <span class="sc">~</span> youtube<span class="sc">+</span>facebook<span class="sc">+</span>newspaper, <span class="at">data =</span> marketing)</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sales ~ youtube + facebook + newspaper, data = marketing)

Residuals:
     Min       1Q   Median       3Q      Max 
-10.5932  -1.0690   0.2902   1.4272   3.3951 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  3.526667   0.374290   9.422   &lt;2e-16 ***
youtube      0.045765   0.001395  32.809   &lt;2e-16 ***
facebook     0.188530   0.008611  21.893   &lt;2e-16 ***
newspaper   -0.001037   0.005871  -0.177     0.86    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.023 on 196 degrees of freedom
Multiple R-squared:  0.8972,    Adjusted R-squared:  0.8956 
F-statistic: 570.3 on 3 and 196 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>summ<span class="ot">=</span><span class="fu">summary</span>(full_model)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>full_model<span class="sc">$</span>coefficients</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept)      youtube     facebook    newspaper 
 3.526667243  0.045764645  0.188530017 -0.001037493 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>MSE<span class="ot">=</span><span class="fu">var</span>(full_model<span class="sc">$</span>residuals); MSE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.029288</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>MSE<span class="ot">=</span>summ<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>SSE_C<span class="ot">=</span><span class="fu">sum</span>(summ<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Inference: What is the error of $\hat\beta$? Is $f$ degenerate? I.e., is $\beta=0$? </span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="co">#regular ANOVA</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sales ~ youtube + facebook + newspaper, data = marketing)

Residuals:
     Min       1Q   Median       3Q      Max 
-10.5932  -1.0690   0.2902   1.4272   3.3951 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  3.526667   0.374290   9.422   &lt;2e-16 ***
youtube      0.045765   0.001395  32.809   &lt;2e-16 ***
facebook     0.188530   0.008611  21.893   &lt;2e-16 ***
newspaper   -0.001037   0.005871  -0.177     0.86    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.023 on 196 degrees of freedom
Multiple R-squared:  0.8972,    Adjusted R-squared:  0.8956 
F-statistic: 570.3 on 3 and 196 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co">#confidence intervals for beta coefficients</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint.lm</span>(full_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  2.5 %     97.5 %
(Intercept)  2.78851474 4.26481975
youtube      0.04301371 0.04851558
facebook     0.17154745 0.20551259
newspaper   -0.01261595 0.01054097</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Partial F Test</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>model_red<span class="ot">=</span><span class="fu">lm</span>(sales <span class="sc">~</span> newspaper, <span class="at">data =</span> marketing)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>sum_reduced<span class="ot">=</span><span class="fu">summary</span>(model_red)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>MSER<span class="ot">=</span>sum_reduced<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>SSE_R<span class="ot">=</span><span class="fu">sum</span>(sum_reduced<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>SSdrop<span class="ot">=</span>SSE_R<span class="sc">-</span>SSE_C</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>MSEdrop<span class="ot">=</span>SSdrop<span class="sc">/</span><span class="dv">2</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>Fstat<span class="ot">=</span>MSEdrop<span class="sc">/</span>MSE</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span><span class="fu">pf</span>(Fstat,<span class="dv">2</span>,<span class="dv">196</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>part_test<span class="ot">=</span><span class="fu">anova</span>(model_red,full_model); part_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: sales ~ newspaper
Model 2: sales ~ youtube + facebook + newspaper
  Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
1    198 7394.1                                  
2    196  801.8  2    6592.3 805.71 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>partial_c_det<span class="ot">=</span>SSdrop<span class="sc">/</span>SSE_R</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>SSER<span class="ot">=</span><span class="fu">sum</span>(model_red<span class="sc">$</span>residuals<span class="sc">*</span>model_red<span class="sc">$</span>residuals); SSER</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7394.119</code></pre>
</div>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>dfer<span class="ot">=</span>model_red<span class="sc">$</span>df.residual; dfer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 198</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>SSEC<span class="ot">=</span><span class="fu">sum</span>(full_model<span class="sc">$</span>residuals<span class="sc">*</span>full_model<span class="sc">$</span>residuals); SSEC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 801.8284</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>dfeC<span class="ot">=</span>full_model<span class="sc">$</span>df.residual; dfeC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 196</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>SSdrop<span class="ot">=</span>SSER<span class="sc">-</span>SSEC; SSdrop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6592.29</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>dfdrop<span class="ot">=</span>dfer<span class="sc">-</span>dfeC</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>MSdrop<span class="ot">=</span>SSdrop<span class="sc">/</span>dfdrop; MSdrop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3296.145</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>R_online<span class="ot">=</span>SSdrop<span class="sc">/</span>SSER; R_online</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8915586</code></pre>
</div>
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>part_test<span class="sc">$</span>F</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]       NA 805.7141</code></pre>
</div>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>part_test<span class="sc">$</span><span class="st">`</span><span class="at">Pr(&gt;F)</span><span class="st">`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]           NA 2.812622e-95</code></pre>
</div>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Prediction: Predict any values if necessary. </span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="co"># What if we have a 300$ budget and we only can pick one advertising method?</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>new_data<span class="ot">=</span>marketing[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>new_data[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,]<span class="ot">=</span><span class="fu">diag</span>(<span class="dv">300</span>,<span class="dv">3</span>)</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(full_model,new_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        1         2         3 
17.256061 60.085672  3.215419 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># It's best to put our money in FB... meta?</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a><span class="co"># What about intervals?</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(full_model,new_data, <span class="at">interval =</span> <span class="st">'confidence'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        fit         lwr       upr
1 17.256061 16.56191879 17.950203
2 60.085672 55.25061022 64.920734
3  3.215419 -0.09445737  6.525296</code></pre>
</div>
</div>
<p>It’s a good time to stop and do another example to review the topics covered so far.</p>
<div id="exm-3-4-4" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.7</strong></span> In the dataset <code>mtcars</code> we have the following variables:</p>
<ul>
<li>mpg: Miles/(US) gallon</li>
<li>cyl: Number of cylinders</li>
<li>disp: Displacement (cu.in.)</li>
<li>hp: Gross horsepower</li>
<li>drat: Rear axle ratio</li>
<li>wt: Weight (1000 lbs)</li>
<li>qsec: 1/4 mile time</li>
<li>vs: V/S</li>
<li>am: Transmission (0 = automatic, 1 = manual)</li>
<li>gear: Number of forward gears</li>
<li>carb: Number of carburetors</li>
</ul>
<p>The data was extracted from the 1974 Motor Trend US magazine, and comprises fuel consumption and 10 aspects of automobile design and performance for 32 automobiles (1973–74 models). Overall, we would like to investigate the relationship between <code>mpg</code> and the following variables: <code>cyl, disp, hp, drat, wt, qsec, gear, carb.</code> Let’s investigate the following questions:</p>
<ol type="1">
<li>Assume the normal MLR model. Store the covariate matrix and response in a variable. Fit a normal MLR model to the data. – That is use <code>lm()</code> to fit the model.</li>
<li>What are the least squares estimates? What is the <span class="math inline">\(MSE\)</span>?</li>
<li>Generate the ANOVA table. Is the model significant?</li>
<li>Test if <code>drat</code> contributes anything to the model, adjusting for the other covariates. Test if <code>drat</code> is related to <code>mpg</code>, without adjusting for the other covariates.</li>
<li>Test if the subset of variables <code>gear, carb</code> contribute to the model jointly, adjusting for the remaining covariates. What is the partial coefficient of determination? Interpret the partial coefficient of determination. Test if the subset of variables <code>gear, carb</code> contribute to the model jointly, without adjusting for the remaining covariates.</li>
<li>Compute a confidence interval for the mean <code>mpg</code> of cars with the following set of covariate values <code>r</code>mtcars[1,-1]*1.1<code>. Compute a prediction interval for the</code>mpg` of a car with the above set of covariate values.</li>
<li>Compute a confidence interval for the coefficient for <code>disp</code>.</li>
<li>Compute and interpret the coefficient of determination.</li>
</ol>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"mtcars"</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   mpg cyl disp  hp drat    wt  qsec vs am gear carb
Mazda RX4         21.0   6  160 110 3.90 2.620 16.46  0  1    4    4
Mazda RX4 Wag     21.0   6  160 110 3.90 2.875 17.02  0  1    4    4
Datsun 710        22.8   4  108  93 3.85 2.320 18.61  1  1    4    1
Hornet 4 Drive    21.4   6  258 110 3.08 3.215 19.44  1  0    3    1
Hornet Sportabout 18.7   8  360 175 3.15 3.440 17.02  0  0    3    2
Valiant           18.1   6  225 105 2.76 3.460 20.22  1  0    3    1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(mtcars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 32 11</code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. </span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="co"># response~all variables minus the two variables we will not include</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>model<span class="ot">=</span><span class="fu">lm</span>(mpg<span class="sc">~</span>.<span class="sc">-</span>vs<span class="sc">-</span>am,<span class="at">data=</span>mtcars)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>summ<span class="ot">=</span><span class="fu">summary</span>(model)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>summ</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = mpg ~ . - vs - am, data = mtcars)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.0230 -1.6874 -0.4109  0.9640  5.4400 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)  
(Intercept) 17.88964   17.81996   1.004   0.3259  
cyl         -0.41460    0.95765  -0.433   0.6691  
disp         0.01293    0.01758   0.736   0.4694  
hp          -0.02085    0.02072  -1.006   0.3248  
drat         1.10110    1.59806   0.689   0.4977  
wt          -3.92065    1.86174  -2.106   0.0463 *
qsec         0.54146    0.62122   0.872   0.3924  
gear         1.23321    1.40238   0.879   0.3883  
carb        -0.25510    0.81563  -0.313   0.7573  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.622 on 23 degrees of freedom
Multiple R-squared:  0.8596,    Adjusted R-squared:  0.8107 
F-statistic:  17.6 on 8 and 23 DF,  p-value: 4.226e-08</code></pre>
</div>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span><span class="fu">model.matrix</span>(model)</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>Y<span class="ot">=</span>mtcars<span class="sc">$</span>mpg</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>X[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  (Intercept) cyl disp  hp drat    wt  qsec gear carb
Mazda RX4                   1   6  160 110 3.90 2.620 16.46    4    4
Mazda RX4 Wag               1   6  160 110 3.90 2.875 17.02    4    4
Datsun 710                  1   4  108  93 3.85 2.320 18.61    4    1
Hornet 4 Drive              1   6  258 110 3.08 3.215 19.44    3    1
Hornet Sportabout           1   8  360 175 3.15 3.440 17.02    3    2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>Y</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 21.0 21.0 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 17.8 16.4 17.3 15.2 10.4
[16] 10.4 14.7 32.4 30.4 33.9 21.5 15.5 15.2 13.3 19.2 27.3 26.0 30.4 15.8 19.7
[31] 15.0 21.4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. </span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>LSE<span class="ot">=</span><span class="fu">coef</span>(model)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>LSE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         cyl        disp          hp        drat          wt 
17.88963741 -0.41459575  0.01293240 -0.02084886  1.10109551 -3.92064847 
       qsec        gear        carb 
 0.54145693  1.23321026 -0.25509911 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>MSE<span class="ot">=</span>summ<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>MSE</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.874941</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. </span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>null_model<span class="ot">=</span><span class="fu">lm</span>(mpg<span class="sc">~</span><span class="dv">1</span>,<span class="at">data=</span>mtcars)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(null_model,model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: mpg ~ 1
Model 2: mpg ~ (cyl + disp + hp + drat + wt + qsec + vs + am + gear + 
    carb) - vs - am
  Res.Df     RSS Df Sum of Sq      F    Pr(&gt;F)    
1     31 1126.05                                  
2     23  158.12  8    967.92 17.599 4.226e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. </span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice the p value is 0.5 , not sign. </span></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>summ<span class="sc">$</span>coefficients[<span class="st">'drat'</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Estimate Std. Error    t value   Pr(&gt;|t|) 
 1.1010955  1.5980601  0.6890201  0.4977032 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>drat<span class="ot">=</span><span class="fu">lm</span>(mpg<span class="sc">~</span>drat,,<span class="at">data=</span>mtcars)</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Notice the p value is 1.78e-05 , sig! explain this difference!</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(drat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = mpg ~ drat, data = mtcars)

Residuals:
    Min      1Q  Median      3Q     Max 
-9.0775 -2.6803 -0.2095  2.2976  9.0225 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   -7.525      5.477  -1.374     0.18    
drat           7.678      1.507   5.096 1.78e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4.485 on 30 degrees of freedom
Multiple R-squared:  0.464, Adjusted R-squared:  0.4461 
F-statistic: 25.97 on 1 and 30 DF,  p-value: 1.776e-05</code></pre>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. </span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>red_model<span class="ot">=</span><span class="fu">lm</span>(mpg<span class="sc">~</span>.<span class="sc">-</span>vs<span class="sc">-</span>am<span class="sc">-</span>gear<span class="sc">-</span>carb,<span class="at">data=</span>mtcars)</span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(red_model,model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: mpg ~ (cyl + disp + hp + drat + wt + qsec + vs + am + gear + 
    carb) - vs - am - gear - carb
Model 2: mpg ~ (cyl + disp + hp + drat + wt + qsec + vs + am + gear + 
    carb) - vs - am
  Res.Df    RSS Df Sum of Sq      F Pr(&gt;F)
1     25 163.48                           
2     23 158.12  2    5.3532 0.3893 0.6819</code></pre>
</div>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a>ob<span class="ot">=</span><span class="fu">anova</span>(red_model,model)</span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>ob<span class="sc">$</span><span class="st">`</span><span class="at">Sum of Sq</span><span class="st">`</span>[<span class="dv">2</span>]<span class="sc">/</span>ob<span class="sc">$</span>RSS[<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.0327457</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3.7% of the variation in mpg is explained from adding the covariate gear and carb to the model which contains cyl, disp, hp, drat, wt, qsec. </span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. </span></span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>new_ob<span class="ot">=</span><span class="fu">c</span>(<span class="fl">6.6</span>,<span class="dv">176</span>,<span class="dv">121</span>,<span class="fl">4.29</span>,<span class="fl">2.882</span>,<span class="fl">18.106</span>,<span class="dv">0</span>,<span class="fl">1.1</span>,<span class="fl">4.4</span>,<span class="fl">4.4</span>)</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>new_ob<span class="ot">=</span><span class="fu">matrix</span>(new_ob,<span class="at">nrow=</span><span class="dv">1</span>,<span class="at">ncol=</span><span class="fu">length</span>(new_ob))</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(new_ob)<span class="ot">=</span><span class="fu">names</span>(mtcars[<span class="dv">1</span>,<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a>new_ob<span class="ot">=</span><span class="fu">data.frame</span>(new_ob)</span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model,new_ob, <span class="at">interval =</span> <span class="st">'confidence'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 22.43839 18.49468 26.38211</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model,new_ob, <span class="at">interval =</span> <span class="st">'prediction'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit     lwr      upr
1 22.43839 15.7322 29.14459</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. </span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   2.5 %      97.5 %
(Intercept) -18.97375462 54.75302945
cyl          -2.39565252  1.56646102
disp         -0.02343129  0.04929609
hp           -0.06371601  0.02201829
drat         -2.20474377  4.40693480
wt           -7.77195651 -0.06934042
qsec         -0.74362628  1.82654014
gear         -1.66782660  4.13424711
carb         -1.94235037  1.43215215</code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co">#8. </span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>summ<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8595764</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 85% of the variation in mpg is explained by cyl, disp, hp, drat, wt, qsec, gear and carb</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="exr-3-4-3b" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.18</strong></span> Interpret all of the above quantites.</p>
</div>
</section>
</section>
<section id="checking-model-assumptions" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="checking-model-assumptions"><span class="header-section-number">3.4</span> Checking model assumptions</h2>
<p>We learned how to test significance of one or multiple variables, compute confidence intervals for the estimated coefficients, mean response, and predicted response. All the methods rely on the assumptions! Recall that we assume 1. The relationship is linear <span class="math inline">\(Y|X=X\beta+\epsilon,\)</span> 2. <span class="math inline">\(\forall i\in[n]\)</span>, <span class="math inline">\(\epsilon_i\sim \mathcal{N}(0,\sigma^2)\)</span> 3. <span class="math inline">\(\epsilon_i\perp \epsilon_j\)</span> for <span class="math inline">\(i\neq j,\ i,j\in [n]\)</span>.</p>
<p>We now briefly discuss how to use the data to check if these assumptions are appropriate. We will cover this in more detail in the next chapter.</p>
<section id="checking-normality" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="checking-normality"><span class="header-section-number">3.4.1</span> Checking normality</h3>
<p>We do not know <span class="math inline">\(\epsilon\)</span>, however, we do know <span class="math inline">\(\hat\epsilon\)</span>, which is our best proxy for the true random error vector <span class="math inline">\(\epsilon\)</span>. To check if the true random error vector is normally distributed we can use histograms and quantile-quantile plots. More specifically, if the histogram of the residuals looks more or less bell-shaped, with tails similar to the normal PDF, then the assumption of normality is valid.</p>
<p>Recall that a qq-plot compares the quantiles of the sample to the quantiles of the theoretical normal distribution. The x-axis represents the theoretical quantiles. The y-axis represents the sample quantiles. If the sample follows a normal distribution, the points in the qq-plot will approximately lie on a line.</p>
<p>Interpretation:</p>
<ul>
<li>Straight Line: If the points lie on or near the straight line, the sample appears normal.</li>
<li>Heavy Tails: Points deviating upwards or downwards at the ends suggest the sample has heavier or lighter tails than the normal distribution.</li>
<li>S-Shape: Points forming an S-shape indicate the sample has lighter tails and a heavier center than the normal distribution.</li>
</ul>
<p>See below for an example: <embed src="plots/QQPlots.PDF" width="640" height="480"> Note that you will always have some deviation at the ends of the line in the qq-plot.</p>
<div id="exm-3-1-2" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.8</strong></span> In examples <a href="#exm-3-1-1" class="quarto-xref">Example&nbsp;<span>3.1</span></a> and <a href="#exm-3-4-5" class="quarto-xref">Example&nbsp;<span>3.6</span></a>, check that the normality assumption is valid.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Make the data frame</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>Weight<span class="ot">=</span><span class="fu">c</span>(<span class="dv">175</span> , <span class="dv">181</span> , <span class="dv">200</span> , <span class="dv">159</span> , <span class="dv">196</span> , <span class="dv">192</span> , <span class="dv">205</span> , <span class="dv">173</span> , <span class="dv">187</span> , <span class="dv">188</span> , </span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a>         <span class="dv">188</span> , <span class="dv">240</span> , <span class="dv">175</span> , <span class="dv">168</span> , <span class="dv">246</span> , <span class="dv">160</span> , <span class="dv">215</span> , <span class="dv">159</span> , <span class="dv">146</span> , <span class="dv">219</span> )</span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>BodyFat <span class="ot">=</span><span class="fu">c</span>(<span class="dv">6</span> , <span class="dv">21</span> , <span class="dv">15</span> , <span class="dv">6</span> , <span class="dv">22</span> , <span class="dv">31</span> , <span class="dv">32</span> ,<span class="dv">21</span> , <span class="dv">25</span> , <span class="dv">30</span> , </span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a>           <span class="dv">10</span> , <span class="dv">20</span> , <span class="dv">22</span> , <span class="dv">9</span> , <span class="dv">38</span> , <span class="dv">10</span> , <span class="dv">27</span> , <span class="dv">12</span> , <span class="dv">10</span> , <span class="dv">28</span> )</span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-7"><a href="#cb121-7" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(<span class="at">Weight=</span>Weight,<span class="at">BodyFat=</span>BodyFat))</span>
<span id="cb121-8"><a href="#cb121-8" aria-hidden="true" tabindex="-1"></a>model<span class="ot">=</span> <span class="fu">lm</span>(BodyFat <span class="sc">~</span>Weight, <span class="at">data =</span> df)</span>
<span id="cb121-9"><a href="#cb121-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = BodyFat ~ Weight, data = df)

Residuals:
     Min       1Q   Median       3Q      Max 
-12.5935  -5.7904   0.6536   5.2731  10.4004 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -27.37626   11.54743  -2.371 0.029119 *  
Weight        0.24987    0.06065   4.120 0.000643 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 7.049 on 18 degrees of freedom
Multiple R-squared:  0.4853,    Adjusted R-squared:  0.4567 
F-statistic: 16.97 on 1 and 18 DF,  p-value: 0.0006434</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">qqPlot</span>(model<span class="sc">$</span>residuals,<span class="at">pch=</span><span class="dv">22</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 12  6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(model<span class="sc">$</span>residuals,<span class="at">breaks=</span><span class="dv">10</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">11</span>,<span class="dv">11</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-15-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This appears okay!</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's do the next example </span></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages('datarium')                         </span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"marketing"</span>, <span class="at">package =</span> <span class="st">"datarium"</span>)</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a><span class="co"># lm( sales~   , data= marketing)</span></span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>full_model<span class="ot">&lt;-</span> <span class="fu">lm</span>(sales <span class="sc">~</span> youtube<span class="sc">+</span>facebook<span class="sc">+</span>newspaper, <span class="at">data =</span> marketing)</span>
<span id="cb126-10"><a href="#cb126-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = sales ~ youtube + facebook + newspaper, data = marketing)

Residuals:
     Min       1Q   Median       3Q      Max 
-10.5932  -1.0690   0.2902   1.4272   3.3951 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  3.526667   0.374290   9.422   &lt;2e-16 ***
youtube      0.045765   0.001395  32.809   &lt;2e-16 ***
facebook     0.188530   0.008611  21.893   &lt;2e-16 ***
newspaper   -0.001037   0.005871  -0.177     0.86    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.023 on 196 degrees of freedom
Multiple R-squared:  0.8972,    Adjusted R-squared:  0.8956 
F-statistic: 570.3 on 3 and 196 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Not great. </span></span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">qqPlot</span>(full_model<span class="sc">$</span>residuals,<span class="at">pch=</span><span class="dv">22</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-15-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 131   6</code></pre>
</div>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(full_model<span class="sc">$</span>residuals,<span class="at">breaks=</span><span class="dv">10</span>,<span class="at">xlim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">11</span>,<span class="dv">11</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-15-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="checking-the-other-assumptions" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="checking-the-other-assumptions"><span class="header-section-number">3.4.2</span> Checking the other assumptions</h3>
<p>To check the remaining assumptions (constant variance, independence of residuals, zero mean and linear relationship), we can use some other diagnostic plots.</p>
<p>One plot is that of the fitted values <span class="math inline">\(\hat Y\)</span> (<span class="math inline">\(x\)</span>-axis) against the residuals <span class="math inline">\(\hat\epsilon\)</span> (<span class="math inline">\(y\)</span>-axis). If the error depends on <span class="math inline">\(\hat y\)</span>, then the identically distributed assumption on the errors is probably not valid. If the assumptions are valid, we should observe on the plots that at all levels of the response, the mean of the residuals is 0 and the variance remains the same. Thus, we should see a horizontal band centered at 0 containing the observations.</p>
<p>This appears to be the case in the body fat example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model<span class="sc">$</span>fitted.values,model<span class="sc">$</span>residuals,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Observe that in the marketing example, the residuals admit a pattern. This usually indicates either a non-linear relationship with the covariates, or an important covariate is missing. In this case, we would say the assumption of identically distributed errors is violated.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(full_model<span class="sc">$</span>fitted.values,full_model<span class="sc">$</span>residuals,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Plotting the residuals against the covariates can reveal dependence between the errors. For instance, if time is a covariate, you can plot the residuals over time to see if they have any relationship with time. If there appears to be dependence among the residuals, then the assumptions of the model are violated. That is, in these plots we should also see a horizontal band centered at 0 containing the observations. If not, then the residuals have a relationship with the given covariate.</p>
<div class="callout-danger">
<p>Be VERY careful about the scale of your plot, as it can affect your interpretation. Zooming out or in too much can make everything look fine. In addition, the <span class="math inline">\(y\)</span>-axis not being centered at 0 can cause you to misinterpret the plot.</p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(marketing<span class="sc">$</span>youtube,full_model<span class="sc">$</span>residuals,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(marketing<span class="sc">$</span>facebook,full_model<span class="sc">$</span>residuals,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-18-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(marketing<span class="sc">$</span>newspaper,full_model<span class="sc">$</span>residuals,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-18-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(marketing<span class="sc">$</span>youtube,full_model<span class="sc">$</span>residuals,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(marketing<span class="sc">$</span>facebook,full_model<span class="sc">$</span>residuals,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(marketing<span class="sc">$</span>newspaper,full_model<span class="sc">$</span>residuals,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>,<span class="at">ylim=</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>,<span class="dv">10</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-19-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Notice how the newspaper plot changes with the new axis limits. It appears that the variance of the error is changing with the value of the facebook and youtube budgets.</p>
<p>Another plot is that of the fitted values against the residuals. This gives an idea of the overall fit of the model. We should observe the points scatters around the line <span class="math inline">\(y=x\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(full_model<span class="sc">$</span>fitted.values,marketing<span class="sc">$</span>sales,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>)</span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Notice that the line is slightly curved above the line at the ends. This means that at high and low values, the actual sales are empirically greater than as predicted by the model. Let’s plot the actual data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(marketing,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>In this case, Youtube and facebook spending seems to have a nonlinear relationship with sales. We will see how to remedy this in later chapters.</p>
<p>As a final note, observe that we can put the <code>model</code> object in the <code>plot()</code> function to obtain the diagnostic plots.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(full_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-22-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-22-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-22-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>We will learn in later chapters how to check the assumptions more thoroughly and how to remedy violations of the assumptions.</p>
</section>
<section id="homework-stop-5" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="homework-stop-5"><span class="header-section-number">3.4.3</span> Homework stop 5</h3>
<p>Complete the assigned textbook problems for Chapter 4.</p>
<div id="exr-3-6-1" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.19</strong></span> List the assumptions for the normal MLR model and the MLR model. Write down how you would check each assumption.</p>
</div>
</section>
</section>
<section id="simple-linear-regression" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="simple-linear-regression"><span class="header-section-number">3.5</span> Simple linear regression</h2>
<p>A special case of the multiple linear regression is <strong>simple linear regression</strong>. A simple linear regression model is a regression model with <strong>one explanatory variable</strong>: <span class="math inline">\(Y_i = \beta_0 + \beta_1 X_i + \epsilon_i\)</span>. <span class="math display">\[
y = \left( \begin{array}{c} y_1 \\ \vdots \\ y_n \end{array} \right),
X = \left( \begin{array}{cc} 1 &amp; x_1 \\ \vdots &amp; \vdots \\ 1 &amp; x_n \end{array} \right),
\beta = \left( \begin{array}{c} \beta_0 \\ \beta_1 \end{array} \right),
\epsilon =  \left( \begin{array}{c} \epsilon_1 \\ \vdots \\ \epsilon_n
\end{array} \right).
\]</span></p>
<section id="estimated-coefficients" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="estimated-coefficients"><span class="header-section-number">3.5.1</span> Estimated Coefficients</h3>
<p>In this case, following some matrix manipulations (verify this for homework), we have <span class="math display">\[
X^\top X = \left( \begin{array}{cc} n &amp; \sum_{i=1}^nx_i \\ \sum_{i=1}^nx_i &amp; \sum_{i=1}^nx_i^2 \end{array} \right),\
X^\top y = \left( \begin{array}{cc} \sum_{i=1}^ny_i \\ \sum_{i=1}^nx_i y_i \end{array} \right).
\]</span> Now, recall if <span class="math display">\[ A = \begin{bmatrix}
a &amp; b \\
c &amp; d
\end{bmatrix} \]</span> then <span class="math display">\[ A^{-1} = \frac{1}{ad - bc} \begin{bmatrix}
d &amp; -b \\
-c &amp; a
\end{bmatrix}. \]</span></p>
<p>From MATH 1131 (or simple algebraic manipulation), we know <span class="math display">\[\begin{equation*}
    \sum_{i=1}^n(x_i - \bar{x})(y_i - \bar{y})  =  \sum_{i=1}^nx_i y_i - n\bar{x}\bar{y} =
\sum_{i=1}^nx_i y_i - n^{-1}\left( \sum_{i=1}^nx_i \right) \left( \sum_{i=1}^ny_i \right)
\end{equation*}\]</span> <span class="math display">\[\begin{equation*}
\sum_{i=1}^n(x_i - \bar{x})^2  =  \sum_{i=1}^nx_i^2 - n\bar{x}^2 =
\sum_{i=1}^nx_i^2 - n^{-1}\left( \sum_{i=1}^nx_i \right)^2.
\end{equation*}\]</span> Therefore <span class="math display">\[\begin{eqnarray*}
(X^\top X)^{-1} &amp; = &amp; \frac{1}{n \sum_{i=1}^nx_i^2 - (\sum_{i=1}^nx_i)^2}
\left( \begin{array}{cc} \sum_{i=1}^nx_i^2 &amp; - \sum_{i=1}^nx_i \\ - \sum_{i=1}^nx_i &amp; n \end{array} \right) \\
&amp; = &amp; \frac{1}{n \sum_{i=1}^n(x_i - \bar{x})^2}
\left( \begin{array}{cc} \sum_{i=1}^nx_i^2 &amp; - \sum_{i=1}^nx_i \\ - \sum_{i=1}^nx_i &amp; n \end{array} \right).
\end{eqnarray*}\]</span></p>
<p>To summarize: <span class="math display">\[\begin{align*}
X^\top X &amp;=  \begin{bmatrix} n &amp; \sum_{i=1}^nx_i \\ \sum_{i=1}^nx_i &amp; \sum_{i=1}^nx_i^2 \end{bmatrix}\\
X^\top y&amp;= \begin{bmatrix}\sum_{i=1}^ny_i \\ \sum_{i=1}^nx_i y_i \end{bmatrix}\\
(X^\top X)^{-1} &amp; =  \frac{1}{n \sum_{i=1}^n(x_i - \bar{x})^2}
\begin{bmatrix} \sum_{i=1}^nx_i^2 &amp; - \sum_{i=1}^nx_i \\ - \sum_{i=1}^nx_i &amp; n\end{bmatrix}
\end{align*}\]</span> Now, we have that <span class="math display">\[\begin{eqnarray*}
\hat\beta &amp; = &amp; \left( \begin{array}{c} \hat\beta_0 \\ \hat\beta_1 \end{array} \right) =
(X^\top X)^{-1} X^\top y \\
&amp; = &amp; \frac{1}{n \sum_{i=1}^n(x_i - \bar{x})^2}
\left( \begin{array}{c} \sum_{i=1}^nx_i^2 \ \sum_{i=1}^ny_i - \sum_{i=1}^nx_i \ \sum_{i=1}^nx_i y_i \\
- \sum_{i=1}^nx_i \ \sum_{i=1}^ny_i + n \sum_{i=1}^nx_i y_i \end{array} \right).
\end{eqnarray*}\]</span></p>
<p>Now, <span class="math display">\[\hat\beta_1=\frac{1}{n \sum_{i=1}^n(x_i - \bar{x})^2}
\left(- \sum_{i=1}^nx_i \ \sum_{i=1}^ny_i + n \sum_{i=1}^nx_i y_i\right).\]</span></p>
<div id="exr-3-5-1" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.20</strong></span> Let’s show that <span class="math display">\[
\hat\beta_1 = \frac{n \sum_{i=1}^nx_i y _i - \sum_{i=1}^nx_i \ \sum_{i=1}^ny_i}{n \sum_{i=1}^n(x_i - \bar{x})^2}
= \frac{\sum_{i=1}^n(x_i - \bar{x})(y_i - \bar{y})}{\sum_{i=1}^n(x_i - \bar{x})^2}.
\]</span></p>
</div>
<p>Does this look familiar? We see that, <span class="math display">\[
\hat\beta_1 = \hat{{\textrm{cov}}}(X,Y)\frac{\hat\sigma_y}{\hat\sigma_x},
\]</span> where <span class="math inline">\(\hat{{\textrm{cov}}}(X,Y)\)</span> is the estimated correlation between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>. Let’s interpret this:</p>
<ol type="1">
<li>If <span class="math inline">\(\hat{{\textrm{cov}}}(X,Y)\approx 0\)</span> then <span class="math inline">\(\hat\beta_1\approx 0\)</span> - low correlation implies an estimated slope close to 0.</li>
<li>The estimated coefficient <span class="math inline">\(\hat\beta_1\)</span> is the product of the estimated correlation between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> and the ratio of the estimated standard deviation of <span class="math inline">\(Y\)</span> to that of <span class="math inline">\(X\)</span>.</li>
</ol>
<p>Now, looking at the intercept term, we have <span class="math display">\[\hat\beta_0=\frac{1}{n \sum_{i=1}^n(x_i - \bar{x})^2}
\left(\sum_{i=1}^nx_i^2 \ \sum_{i=1}^ny_i - \sum_{i=1}^nx_i \ \sum_{i=1}^nx_i y_i\right).\]</span></p>
<div id="exr-3-5-2" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.21</strong></span> Show that <span class="math display">\[\hat\beta_0=\bar y - \hat\beta_1\bar x.
\]</span></p>
</div>
<p>Observe that the intercept is the mean of <span class="math inline">\(Y\)</span> minus the mean of <span class="math inline">\(X\)</span> times the estimated slope. In essence, it tells us that the intercept <span class="math inline">\((\hat{\beta}_0)\)</span> represents the value of <span class="math inline">\((X)\)</span> when <span class="math inline">\((X)\)</span> is at its mean value (<span class="math inline">\((\bar{X})\)</span>) and that <span class="math inline">\((\bar{X})\)</span> is adjusted by subtracting the contribution of <span class="math inline">\((\hat{\beta}_1 \bar{X})\)</span>.</p>
<p>This adjustment ensures that the regression line passes through the point <span class="math inline">\(((\bar{X}, \bar{X}))\)</span>, which is the point of averages for the data.</p>
</section>
<section id="inference-in-slr" class="level3" data-number="3.5.2">
<h3 data-number="3.5.2" class="anchored" data-anchor-id="inference-in-slr"><span class="header-section-number">3.5.2</span> Inference in SLR</h3>
<p>We can also simplify the values used for inference in the SLR model. Recall that <span class="math inline">\({\textrm{Var}}\left[\hat\beta\right] = (X^\top X)^{-1} \sigma^2\)</span>, and so we have <span class="math display">\[\begin{eqnarray*}
{\textrm{Var}}\left[\hat\beta_0\right] &amp; = &amp; \frac{\sum_{i=1}^nx_i^2}{n \sum_{i=1}^n(x_i - \bar{x})^2} \sigma^2
= \frac{\sum_{i=1}^nx_i^2 - n \bar{x}^2 + n \bar{x}^2}{n \sum_{i=1}^n(x_i - \bar{x})^2} \sigma^2  \\
&amp; = &amp; \left[ \frac{1}{n} + \frac{\bar{x}^2}{\sum_{i=1}^n(x_i - \bar{x})^2} \right] \sigma^2  \\
{\textrm{Var}}\left[\hat\beta_1\right] &amp; = &amp; \frac{1}{\sum_{i=1}^n(x_i - \bar{x})^2} \sigma^2  \\
{\textrm{cov}}({\hat\beta_0, \hat\beta_1}) &amp; = &amp; - \frac{\bar{x}}{\sum_{i=1}^n(x_i - \bar{x})^2} \sigma^2.
\end{eqnarray*}\]</span></p>
<p>We know from previous sections that a <span class="math inline">\((1 - \alpha)100%\)</span> confidence interval of <span class="math inline">\(\beta_i\)</span>, where <span class="math inline">\(i = 0, 1\)</span>, is <span class="math display">\[
\hat\beta_i \pm t_{df_E, \alpha/2} \sqrt{\widehat{var}(\hat\beta_i)}.
\]</span> Similarly, let <span class="math inline">\(\beta_i^0\)</span> be a hypothesized value of <span class="math inline">\(\beta_i\)</span>, for <span class="math inline">\(i=0, 1\)</span>. If we want to test whether <span class="math inline">\(\beta_i=\beta_i^0\)</span>, then the observed test statistic is given by <span class="math display">\[
\frac{\hat\beta_i - \beta_i^0}{\sqrt{\widehat{var}(\hat\beta_i)}},
\]</span> and the corresponding <span class="math inline">\(p\)</span>-value is obtained via the <span class="math inline">\(t_{dfE}\)</span> distribution as usual.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Similarly, inference for the mean response and predictions can be obtained. We can also simplify the <span class="math inline">\(ANOVA\)</span> table, <span class="math inline">\(R^2\)</span>, etc. For instance, the <span class="math inline">\(R^2\)</span> is the square of the sample correlation coefficient between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>.</p>
</div>
</div>
</section>
<section id="inference-for-the-correlation-coefficient" class="level3" data-number="3.5.3">
<h3 data-number="3.5.3" class="anchored" data-anchor-id="inference-for-the-correlation-coefficient"><span class="header-section-number">3.5.3</span> Inference for the correlation coefficient</h3>
<p>If we are interested in doing a hypothesis test, or constructing confidence intervals for the correlation between two variables, say <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, we can use the simple linear regression model.</p>
<p>We have already derived the relationship between the estimated correlation coefficient and the estimated slope of the simple linear regression model. More specifically, if the estimated correlation coefficient is 0, then the estimated slope of the simple linear regression is 0. One can show that the same relationship holds at the population level: <span class="math inline">\(\beta_1=\rho \sigma_y/\sigma_x\)</span>, where <span class="math inline">\(\rho={\textrm{corr}}\left[X,Y\right]\)</span>.</p>
<p>Now, suppose that we want to test if <span class="math inline">\(H_0: \rho =0\)</span> versus <span class="math inline">\(H_a: \rho \neq 0\)</span>. Using the fact that <span class="math inline">\(\beta_1=\rho \sigma_y/\sigma_x\)</span>, the above test is equivalent to the statement <span class="math inline">\(H_0: \beta_1 = 0\)</span> versus <span class="math inline">\(H_a: \beta_1 \neq 0\)</span>. Therefore, we can just test if the slope parameter in the model <span class="math inline">\(Y|X=\beta_0+\beta_1 X+\epsilon\)</span> is 0.</p>
<p>Letting <span class="math inline">\(\hat\rho=\hat{{\textrm{corr}}}(X,Y)\)</span> The observed test statistic is then: <span class="math display">\[
\frac{\hat\beta_1}{\sqrt{\widehat{var}(\hat\beta_1)}} = \frac{\hat\rho \sqrt{n-2}}{\sqrt{1 - \hat\rho^2}},
\]</span> and the corresponding <span class="math inline">\(p\)</span>-value is obtained based on the <span class="math inline">\(t_{dfE}\)</span> distribution.</p>
<p>However, when the hypothesized value for <span class="math inline">\(\rho\)</span> is non-zero, the problem becomes very complicated. The exact distribution of <span class="math inline">\(\hat\rho\)</span> is extremely difficult to obtain under the null hypothesis. The following procedure gives an approximation of the distribution of a function of <span class="math inline">\(\hat\rho\)</span> under the null hypothesis. In particular, Fisher suggested the transformation for <span class="math inline">\(\rho \in (0, 1)\)</span>, <span class="math display">\[
\theta = \frac{1}{2} \log \frac{1 + \rho}{1 - \rho}.
\]</span> Then <span class="math display">\[
\hat\theta = \frac{1}{2} \log \frac{1 + \hat\rho}{1 - \hat\rho},
\]</span> is an estimate of <span class="math inline">\(\theta\)</span>, where <span class="math inline">\(\hat\theta\)</span> is approximately distributed as normal with mean <span class="math inline">\(\theta\)</span> and variance <span class="math inline">\(\frac{1}{n-3}\)</span>. Hence, an approximate <span class="math inline">\((1 - \alpha)100%\)</span> confidence interval of <span class="math inline">\(\theta\)</span> is <span class="math display">\[
\hat\theta \pm z_{\alpha/2} \sqrt{\frac{1}{n-3}},
\]</span> and the corresponding confidence interval of <span class="math inline">\(\rho\)</span> can be obtained by the inverse transformation. Similarly, if the hypothesized value of <span class="math inline">\(\rho\)</span> is <span class="math inline">\(\rho_0\)</span>, then the hypothesized value of <span class="math inline">\(\theta\)</span> is <span class="math inline">\(\theta_0 = \frac{1}{2} \log \frac{1 + \rho_0}{1-\rho_0}\)</span>. The observed test statistic can be obtained and the corresponding <span class="math inline">\(p\)</span>-value can be obtained based on the standard normal distribution.</p>
<div id="exm-3-6-2" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.9</strong></span> In <a href="#exm-3-1-1" class="quarto-xref">Example&nbsp;<span>3.1</span></a> test if the correlation between body fat and weight is 0. Next, test if the correlation is greater than 1/2. Construct a 95% CI for <span class="math inline">\(\rho.\)</span></p>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="do">############################ Exploratory</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>Weight<span class="ot">=</span><span class="fu">c</span>(<span class="dv">175</span> , <span class="dv">181</span> , <span class="dv">200</span> , <span class="dv">159</span> , <span class="dv">196</span> , <span class="dv">192</span> , <span class="dv">205</span> , </span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>         <span class="dv">173</span> , <span class="dv">187</span> , <span class="dv">188</span> , <span class="dv">188</span> , <span class="dv">240</span> , <span class="dv">175</span> , <span class="dv">168</span> , </span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>         <span class="dv">246</span> , <span class="dv">160</span> , <span class="dv">215</span> , <span class="dv">159</span> , <span class="dv">146</span> , <span class="dv">219</span> )</span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>BodyFat <span class="ot">=</span><span class="fu">c</span>(<span class="dv">6</span> , <span class="dv">21</span> , <span class="dv">15</span> , <span class="dv">6</span> , <span class="dv">22</span> , <span class="dv">31</span> , <span class="dv">32</span> ,<span class="dv">21</span> , <span class="dv">25</span> , </span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>           <span class="dv">30</span> , <span class="dv">10</span> , <span class="dv">20</span> , <span class="dv">22</span> , <span class="dv">9</span> , <span class="dv">38</span> , <span class="dv">10</span> , <span class="dv">27</span> , <span class="dv">12</span> , <span class="dv">10</span> , <span class="dv">28</span> )</span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-8"><a href="#cb142-8" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(<span class="at">Weight=</span>Weight,<span class="at">BodyFat=</span>BodyFat))</span>
<span id="cb142-9"><a href="#cb142-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-10"><a href="#cb142-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-11"><a href="#cb142-11" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           Weight   BodyFat
Weight  1.0000000 0.6966328
BodyFat 0.6966328 1.0000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(df<span class="sc">$</span>Weight,<span class="at">freq=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(df<span class="sc">$</span>BodyFat,<span class="at">freq=</span>F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-23-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Weight         BodyFat     
 Min.   :146.0   Min.   : 6.00  
 1st Qu.:171.8   1st Qu.:10.00  
 Median :187.5   Median :21.00  
 Mean   :188.6   Mean   :19.75  
 3rd Qu.:201.2   3rd Qu.:27.25  
 Max.   :246.0   Max.   :38.00  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(df)[<span class="dv">1</span>,<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6966328</code></pre>
</div>
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a>X<span class="ot">=</span><span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="fu">nrow</span>(df)), df<span class="sc">$</span>Weight)</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>Y<span class="ot">=</span>df<span class="sc">$</span>BodyFat</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>beta_hat<span class="ot">=</span> <span class="fu">solve</span>(<span class="fu">t</span>(X)<span class="sc">%*%</span>X)<span class="sc">%*%</span><span class="fu">t</span>(X)<span class="sc">%*%</span>Y</span>
<span id="cb150-5"><a href="#cb150-5" aria-hidden="true" tabindex="-1"></a>beta_hat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            [,1]
[1,] -27.3762623
[2,]   0.2498741</code></pre>
</div>
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>model<span class="ot">=</span><span class="fu">lm</span>(BodyFat<span class="sc">~</span> Weight,df)</span>
<span id="cb152-2"><a href="#cb152-2" aria-hidden="true" tabindex="-1"></a>model</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = BodyFat ~ Weight, data = df)

Coefficients:
(Intercept)       Weight  
   -27.3763       0.2499  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = BodyFat ~ Weight, data = df)

Residuals:
     Min       1Q   Median       3Q      Max 
-12.5935  -5.7904   0.6536   5.2731  10.4004 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -27.37626   11.54743  -2.371 0.029119 *  
Weight        0.24987    0.06065   4.120 0.000643 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 7.049 on 18 degrees of freedom
Multiple R-squared:  0.4853,    Adjusted R-squared:  0.4567 
F-statistic: 16.97 on 1 and 18 DF,  p-value: 0.0006434</code></pre>
</div>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(df)[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4852972</code></pre>
</div>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(df)[<span class="dv">1</span>,<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.6966328</code></pre>
</div>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>a<span class="ot">=</span><span class="cf">function</span>(x){</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>  (<span class="fu">exp</span>(<span class="dv">2</span><span class="sc">*</span>x)<span class="sc">-</span><span class="dv">1</span>)<span class="sc">/</span>(<span class="fu">exp</span>(<span class="dv">2</span><span class="sc">*</span>x)<span class="sc">+</span><span class="dv">1</span>)</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="fu">a</span>(<span class="fl">1.36</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8763931</code></pre>
</div>
</div>
</section>
<section id="homework-stop-6" class="level3" data-number="3.5.4">
<h3 data-number="3.5.4" class="anchored" data-anchor-id="homework-stop-6"><span class="header-section-number">3.5.4</span> Homework stop 6</h3>
<ul>
<li>Complete the Chapter 2 questions in the textbook.</li>
</ul>
<div id="exr-3-6-3" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.22</strong></span> For <span class="math display">\[Y_i = \beta_0 + \beta_1 X_i + \epsilon_i\]</span> <span class="math display">\[
y = \left( \begin{array}{c} y_1 \\ \vdots \\ y_n \end{array} \right),
X = \left( \begin{array}{cc} 1 &amp; x_1 \\ \vdots &amp; \vdots \\ 1 &amp; x_n \end{array} \right),
\beta = \left( \begin{array}{c} \beta_0 \\ \beta_1 \end{array} \right),
\epsilon =  \left( \begin{array}{c} \epsilon_1 \\ \vdots \\ \epsilon_n
\end{array} \right)
\]</span></p>
<ul>
<li>Compute <span class="math inline">\(\hat\beta\)</span>, <span class="math inline">\({\textrm{Var}}\left[\hat\beta_1\right]\)</span>, <span class="math inline">\({\textrm{Var}}\left[\hat\beta_0\right]\)</span>, <span class="math inline">\({\textrm{cov}}\left[(\right]\hat\beta_0,\hat\beta_1)\)</span></li>
<li>Show <span class="math inline">\(\hat\beta_1=r\frac{\hat\sigma_y}{\hat\sigma_x}\)</span></li>
</ul>
</div>
</section>
</section>
<section id="additional-concepts-examples" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="additional-concepts-examples"><span class="header-section-number">3.6</span> Additional concepts &amp; examples</h2>
<p>Here we touch on a few important examples and notes about the MLR.</p>
<section id="beware-scatter-plots-in-mlr" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="beware-scatter-plots-in-mlr"><span class="header-section-number">3.6.1</span> Beware scatter plots in MLR</h3>
<p>Sometimes, scatter plots are misleading for determining the relationship between <span class="math inline">\(Y\)</span> and a collection of <span class="math inline">\(p\)</span> covariates. In the following example, it appears that <span class="math inline">\(X1\)</span> and <span class="math inline">\(Y\)</span> do not have a relationship, when in fact they do. Generally, this phenomena goes away with higher sample sizes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter diagram beware?</span></span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="co"># x1=c(2,3,4,1,5,6,7,8)</span></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="co"># x2=c(2,3,4,1,5,6,7,8)</span></span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a><span class="co"># x=c(2,3,4,1,5,6,7,8)</span></span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a><span class="co"># x1=1:8</span></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a><span class="co"># x2=c(2,1:6,4)</span></span>
<span id="cb162-8"><a href="#cb162-8" aria-hidden="true" tabindex="-1"></a><span class="co"># y=8-5*x1+12*x2+rnorm(8,0,2)</span></span>
<span id="cb162-9"><a href="#cb162-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-10"><a href="#cb162-10" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">445</span>)</span>
<span id="cb162-11"><a href="#cb162-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-12"><a href="#cb162-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-13"><a href="#cb162-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-14"><a href="#cb162-14" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="dv">8</span></span>
<span id="cb162-15"><a href="#cb162-15" aria-hidden="true" tabindex="-1"></a>x1<span class="ot">=</span><span class="fu">rnorm</span>(n,<span class="dv">5</span>,<span class="dv">5</span>)</span>
<span id="cb162-16"><a href="#cb162-16" aria-hidden="true" tabindex="-1"></a>x2<span class="ot">=</span><span class="fu">rnorm</span>(n,<span class="dv">3</span>,<span class="dv">5</span>)</span>
<span id="cb162-17"><a href="#cb162-17" aria-hidden="true" tabindex="-1"></a>y<span class="ot">=</span><span class="dv">8-5</span><span class="sc">*</span>x1<span class="sc">+</span><span class="dv">12</span><span class="sc">*</span>x2<span class="sc">+</span><span class="fu">rnorm</span>(n,<span class="dv">0</span>,<span class="dv">2</span>)</span>
<span id="cb162-18"><a href="#cb162-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-19"><a href="#cb162-19" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span><span class="fu">data.frame</span>(<span class="fu">cbind</span>(y,x1,x2))</span>
<span id="cb162-20"><a href="#cb162-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-21"><a href="#cb162-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Next, we do an example from the textbook, which uses the NFL data. Specifically, we try to evaluate the relationship between number of wins and several explanatory variables.</p>
<div id="exm-3-6-1" class="theorem example">
<p><span class="theorem-title"><strong>Example 3.10</strong></span> Using the following NFL data, complete 3.1-3.4, 4.1 and 4.2 in the textbook.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="do">################## NFL example #################</span></span>
<span id="cb163-2"><a href="#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This gives you the data sets used in the textbook</span></span>
<span id="cb163-3"><a href="#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages('MPV')</span></span>
<span id="cb163-4"><a href="#cb163-4" aria-hidden="true" tabindex="-1"></a>df<span class="ot">=</span>MPV<span class="sc">::</span>table.b1</span>
<span id="cb163-5"><a href="#cb163-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Note for more information, run ?MPV::table.b1</span></span>
<span id="cb163-6"><a href="#cb163-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-7"><a href="#cb163-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   y   x1   x2   x3   x4 x5  x6   x7   x8   x9
1 10 2113 1985 38.9 64.7  4 868 59.7 2205 1917
2 11 2003 2855 38.8 61.3  3 615 55.0 2096 1575
3 11 2957 1737 40.1 60.0 14 914 65.6 1847 2175
4 13 2285 2905 41.6 45.3 -4 957 61.4 1903 2476
5 10 2971 1666 39.2 53.8 15 836 66.1 1457 1866
6 11 2309 2927 39.7 74.1  8 786 61.0 1848 2339</code></pre>
</div>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># names too long</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "y"  "x1" "x2" "x3" "x4" "x5" "x6" "x7" "x8" "x9"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rename to make it easier</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df)<span class="ot">=</span><span class="fu">c</span>(<span class="st">"Wins"</span>,<span class="st">"RushY"</span>,<span class="st">"PassY"</span>,<span class="st">"PuntA"</span>,<span class="st">"FGP"</span>,<span class="st">"TurnD"</span>,<span class="st">"PenY"</span>,<span class="st">"PerR"</span>,<span class="st">"ORY"</span>,<span class="st">"OPY"</span>)</span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Wins"  "RushY" "PassY" "PuntA" "FGP"   "TurnD" "PenY"  "PerR"  "ORY"  
[10] "OPY"  </code></pre>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Wins~ beta_1+beta_2Passing yrds+beta_3per_rush+beta_4ORY+epsilon</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(df)</span></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(df)</span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a><span class="co"># run the model </span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>regression_model<span class="ot">=</span><span class="fu">lm</span>(  Wins <span class="sc">~</span> PassY<span class="sc">+</span>PerR<span class="sc">+</span>ORY  ,<span class="at">data=</span> df )</span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(regression_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Wins ~ PassY + PerR + ORY, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.0370 -0.7129 -0.2043  1.1101  3.7049 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -1.808372   7.900859  -0.229 0.820899    
PassY        0.003598   0.000695   5.177 2.66e-05 ***
PerR         0.193960   0.088233   2.198 0.037815 *  
ORY         -0.004816   0.001277  -3.771 0.000938 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.706 on 24 degrees of freedom
Multiple R-squared:  0.7863,    Adjusted R-squared:  0.7596 
F-statistic: 29.44 on 3 and 24 DF,  p-value: 3.273e-08</code></pre>
</div>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model=lm(Wins~PassY+PerR+ORY,data=df)</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a><span class="co"># get the confidence intervals. </span></span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(regression_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    2.5 %       97.5 %
(Intercept) -18.114944410 14.498200293
PassY         0.002163664  0.005032477
PerR          0.011855322  0.376065098
ORY          -0.007451027 -0.002179961</code></pre>
</div>
</div>
<p>What conclusions can you make from this output? - All variables seem important! For isntance, we sdee that for every 1% increase in percentage rushing, there is a 0.193960 increase in number of wins, on average, holding passing yards and opponent rushing yards constant.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb173"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="do">#### CI</span></span>
<span id="cb173-2"><a href="#cb173-2" aria-hidden="true" tabindex="-1"></a><span class="co"># mean response of z'\beta , z=(2000,60,1900)'</span></span>
<span id="cb173-3"><a href="#cb173-3" aria-hidden="true" tabindex="-1"></a>new_data<span class="ot">=</span><span class="fu">data.frame</span>(  <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2000</span>,<span class="dv">60</span>,<span class="dv">1900</span>),<span class="at">ncol=</span><span class="dv">3</span>) )</span>
<span id="cb173-4"><a href="#cb173-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(new_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "X1" "X2" "X3"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb175"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(new_data)<span class="ot">=</span><span class="fu">c</span>( <span class="st">'PassY'</span>,<span class="st">'PerR'</span>,<span class="st">'ORY'</span> )</span>
<span id="cb175-2"><a href="#cb175-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-3"><a href="#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(regression_model, new_data  ,   <span class="at">interval =</span> <span class="st">'confidence'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 7.875942 7.072672 8.679213</code></pre>
</div>
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(regression_model, new_data  ,   <span class="at">interval =</span> <span class="st">'predict'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr     upr
1 7.875942 4.263986 11.4879</code></pre>
</div>
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="do">## ANOVA </span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>regression_model_reduced<span class="ot">=</span><span class="fu">lm</span>(  Wins <span class="sc">~</span> <span class="dv">1</span>  ,<span class="at">data=</span> df )</span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(regression_model_reduced)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Wins ~ 1, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-6.9643 -2.9643 -0.4643  3.0357  6.0357 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   6.9643     0.6576   10.59 4.09e-11 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 3.48 on 27 degrees of freedom</code></pre>
</div>
<div class="sourceCode cell-code" id="cb181"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(regression_model_reduced,regression_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: Wins ~ 1
Model 2: Wins ~ PassY + PerR + ORY
  Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
1     27 326.96                                  
2     24  69.87  3    257.09 29.437 3.273e-08 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="co"># subset test</span></span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>regression_model_reduced<span class="ot">=</span><span class="fu">lm</span>(  Wins <span class="sc">~</span> PassY ,<span class="at">data=</span> df )</span>
<span id="cb183-4"><a href="#cb183-4" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(regression_model_reduced,regression_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: Wins ~ PassY
Model 2: Wins ~ PassY + PerR + ORY
  Res.Df    RSS Df Sum of Sq      F    Pr(&gt;F)    
1     26 250.77                                  
2     24  69.87  2     180.9 31.069 2.189e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(df)</span></span>
<span id="cb185-2"><a href="#cb185-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb185-3"><a href="#cb185-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(regression_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Wins ~ PassY + PerR + ORY, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.0370 -0.7129 -0.2043  1.1101  3.7049 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -1.808372   7.900859  -0.229 0.820899    
PassY        0.003598   0.000695   5.177 2.66e-05 ***
PerR         0.193960   0.088233   2.198 0.037815 *  
ORY         -0.004816   0.001277  -3.771 0.000938 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.706 on 24 degrees of freedom
Multiple R-squared:  0.7863,    Adjusted R-squared:  0.7596 
F-statistic: 29.44 on 3 and 24 DF,  p-value: 3.273e-08</code></pre>
</div>
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="co"># anova(regression_model)</span></span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>summ<span class="ot">=</span><span class="fu">summary</span>(regression_model)</span>
<span id="cb187-3"><a href="#cb187-3" aria-hidden="true" tabindex="-1"></a>summ<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7863069</code></pre>
</div>
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a>summ<span class="sc">$</span>adj.r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7595953</code></pre>
</div>
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a>regression_model2<span class="ot">=</span><span class="fu">lm</span>(Wins<span class="sc">~</span>PassY<span class="sc">+</span>ORY,<span class="at">data=</span>df)</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a>SSER<span class="ot">=</span><span class="fu">sum</span>(regression_model2<span class="sc">$</span>residuals<span class="sc">*</span>regression_model2<span class="sc">$</span>residuals); SSER</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 83.9382</code></pre>
</div>
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a>dfer<span class="ot">=</span>regression_model2<span class="sc">$</span>df.residual; dfer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 25</code></pre>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a>SSEC<span class="ot">=</span><span class="fu">sum</span>(regression_model<span class="sc">$</span>residuals<span class="sc">*</span>regression_model<span class="sc">$</span>residuals); SSEC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 69.87</code></pre>
</div>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a>dfeC<span class="ot">=</span>regression_model<span class="sc">$</span>df.residual; dfeC</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 24</code></pre>
</div>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>SSdrop<span class="ot">=</span>SSER<span class="sc">-</span>SSEC; SSdrop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14.06819</code></pre>
</div>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a>dfdrop<span class="ot">=</span>dfer<span class="sc">-</span>dfeC</span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb201-3"><a href="#cb201-3" aria-hidden="true" tabindex="-1"></a>MSdrop<span class="ot">=</span>SSdrop<span class="sc">/</span>dfdrop; MSdrop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14.06819</code></pre>
</div>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>R_prp<span class="ot">=</span>SSdrop<span class="sc">/</span>SSER; R_prp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.1676018</code></pre>
</div>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a>MSdrop</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 14.06819</code></pre>
</div>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">-</span><span class="fu">pf</span>(MSdrop,dfdrop,dfeC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.000986662</code></pre>
</div>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(regression_model<span class="sc">$</span>fitted.values , df<span class="sc">$</span>Wins)<span class="sc">^</span><span class="dv">2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7863069</code></pre>
</div>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(regression_model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   2.5 %       97.5 %
(Intercept)  9.321778092 20.103571885
PassY        0.001654121  0.004568143
ORY         -0.008797465 -0.004819085</code></pre>
</div>
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a>new_data<span class="ot">=</span>df[<span class="dv">1</span>,<span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">8</span>,<span class="dv">9</span>)]</span>
<span id="cb213-2"><a href="#cb213-2" aria-hidden="true" tabindex="-1"></a>new_data[<span class="dv">1</span>,]<span class="ot">=</span><span class="fu">c</span>(<span class="dv">2300</span> , <span class="dv">56</span> , <span class="dv">2100</span>)</span>
<span id="cb213-3"><a href="#cb213-3" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(regression_model2,new_data,<span class="at">interval =</span> <span class="st">'confidence'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     fit      lwr      upr
1 7.5709 6.814662 8.327138</code></pre>
</div>
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="do">#########  check the fit #######</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a>MSE<span class="ot">=</span>summ<span class="sc">$</span>sigma<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(regression_model2<span class="sc">$</span>residuals<span class="sc">/</span>summ<span class="sc">$</span>sigma,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>)</span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(regression_model2<span class="sc">$</span>residuals,<span class="at">breaks=</span><span class="dv">6</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-27-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(regression_model2<span class="sc">$</span>fitted.values,regression_model<span class="sc">$</span>residuals,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>)</span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-27-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a>n<span class="ot">=</span><span class="fu">nrow</span>(df)</span>
<span id="cb218-2"><a href="#cb218-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="dv">1</span><span class="sc">:</span>n,regression_model2<span class="sc">$</span>residuals,<span class="at">pch=</span><span class="dv">22</span>,<span class="at">bg=</span><span class="dv">1</span>)</span>
<span id="cb218-3"><a href="#cb218-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>)</span>
<span id="cb218-4"><a href="#cb218-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb218-5"><a href="#cb218-5" aria-hidden="true" tabindex="-1"></a>time<span class="ot">=</span>(<span class="dv">1</span><span class="sc">:</span>n)</span>
<span id="cb218-6"><a href="#cb218-6" aria-hidden="true" tabindex="-1"></a>res<span class="ot">=</span><span class="fu">lm</span>(regression_model2<span class="sc">$</span>residuals<span class="sc">~</span>time)</span>
<span id="cb218-7"><a href="#cb218-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = regression_model2$residuals ~ time)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.36425 -1.04520 -0.07845  1.16457  2.40353 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   1.8479     0.5610   3.294 0.002852 ** 
time         -0.1274     0.0338  -3.771 0.000848 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.445 on 26 degrees of freedom
Multiple R-squared:  0.3535,    Adjusted R-squared:  0.3286 
F-statistic: 14.22 on 1 and 26 DF,  p-value: 0.0008481</code></pre>
</div>
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(time,res<span class="sc">$</span>fitted.values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="Unit_2_files/figure-html/unnamed-chunk-27-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a>regression_model3<span class="ot">=</span><span class="fu">lm</span>(Wins<span class="sc">~</span>PerR<span class="sc">+</span>ORY,<span class="at">data=</span>df)</span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a>summ3<span class="ot">=</span><span class="fu">summary</span>(regression_model3)</span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a>summ3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Wins ~ PerR + ORY, data = df)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.7985 -1.5166 -0.5792  1.9927  4.5248 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)   
(Intercept) 17.944319   9.862484   1.819  0.08084 . 
PerR         0.048371   0.119219   0.406  0.68839   
ORY         -0.006537   0.001758  -3.719  0.00102 **
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.432 on 25 degrees of freedom
Multiple R-squared:  0.5477,    Adjusted R-squared:  0.5115 
F-statistic: 15.13 on 2 and 25 DF,  p-value: 4.935e-05</code></pre>
</div>
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>summ3<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5476628</code></pre>
</div>
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a>summ3<span class="sc">$</span>adj.r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5114759</code></pre>
</div>
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(regression_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    2.5 %       97.5 %
(Intercept) -18.114944410 14.498200293
PassY         0.002163664  0.005032477
PerR          0.011855322  0.376065098
ORY          -0.007451027 -0.002179961</code></pre>
</div>
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(regression_model3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  2.5 %       97.5 %
(Intercept) -2.36784828 38.256485319
PerR        -0.19716429  0.293906022
ORY         -0.01015637 -0.002916818</code></pre>
</div>
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>new_data3<span class="ot">=</span>df[<span class="dv">1</span>,<span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">9</span>)]</span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>new_data3[<span class="dv">1</span>,]<span class="ot">=</span><span class="fu">c</span>(<span class="dv">56</span> , <span class="dv">2100</span>)</span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(regression_model3,new_data3,<span class="at">interval =</span> <span class="st">'confidence'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       fit      lwr      upr
1 6.926243 5.828643 8.023842</code></pre>
</div>
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(regression_model2,new_data,<span class="at">interval =</span> <span class="st">'confidence'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     fit      lwr      upr
1 7.5709 6.814662 8.327138</code></pre>
</div>
</div>
<div class="callout-danger">
<p>Be careful about extrapolating beyond the region containing the original observations. It is very possible that a model that fits well in the region of the original data will perform poorly outside that region. It is easy to inadvertently extrapolate, since the levels of the regressors jointly define a region containing the data which is impossible to visualize in its entirety beyond 2 dimensions. Ideally, we want to make inferences which lie inside the convex hull of the regressors.</p>
<p>We can use the diagonal of the hat matrix <span class="math inline">\(H=X(X^\top X)^{-1}X^\top\)</span>. In general, the point that has the largest value of <span class="math inline">\(h_{ii}\)</span>, say <span class="math inline">\(h_{max}\)</span>, will lie on the boundary of the convex hull in a region of the <span class="math inline">\(x\)</span>-space where the density of the observations is relatively low. Points that lie in the set <span class="math inline">\(\{x^\top (X^\top X)^{-1} x\leq h_{max}\}\)</span> enclose the convex hull. Thus, for a value we are interested in predicting, say <span class="math inline">\(y\)</span>, we can check if we are extrapolating with <span class="math inline">\(y^\top (X^\top X)^{-1} y\leq h_{max}\)</span>.</p>
</div>
<div class="callout-danger">
<p>A serious problem that may dramatically impact the usefulness of a regression model is multicollinearity, or near - linear dependence among the regression variables. Multicollinearity implies near - linear dependence among the regressors. The regressors are the columns of the <span class="math inline">\(X\)</span> matrix, so clearly an exact linear dependence would result in a singular <span class="math inline">\(X^\top X\)</span>. This will impact our ability to estimate <span class="math inline">\(\beta\)</span>.</p>
<p>We can check for this dependence with the <strong>variance inflation factor</strong> (VIF). The variance inflation factor can be written as <span class="math inline">\((1-R^2_j)^{-1}\)</span>, where <span class="math inline">\(R^2_j\)</span> is the coefficient of determination obtained from regressing <span class="math inline">\(X_j\)</span> on the other regressor variables. If VIF is large, say <span class="math inline">\(&gt;3\)</span>, then you will likely need to make some changes to your regression model.</p>
</div>
<div class="callout-danger">
<p>Sometimes, you may observe that regression coefficients have the a sign that is unexpected, or contradicts nature. This is likely due to one of the following:</p>
<ul>
<li>The range of some of the regressors is too small – if the range of some of the regressors is too small, then the variance of <span class="math inline">\(\hat\beta\)</span> is high.</li>
<li>Important regressors have not been included in the model.</li>
<li>Multicollinearity is present.</li>
<li>Computational errors have been made.</li>
</ul>
</div>
<p>We close this Chapter with the following statement. Recall the modelling overview from Chapter 1:</p>
<ul>
<li>Posit the model: What is the linear regression model – what are all the assumptions of the linear regression model?</li>
<li>Estimation: How can we estimate parameters of the linear regression model?</li>
<li>Inference: How can we compute confidence intervals and run hypothesis tests associated with the linear regression model?</li>
<li>Fit: Does our fitted line match up with the data? What about the normality assumption? Do the errors appear normal? Do the errors seem independent? Is the variance constant? How much variability is explained by our model?</li>
<li>Prediction: How can we predict a new <span class="math inline">\(Y\)</span>? What is the error of this prediction</li>
</ul>
<p>If you have learned the concepts of this chapter, you should be able to complete all of these steps! In the following chapters, we will discuss different problems that can arise in regression modelling and how to remedy them.</p>
</section>
<section id="homework-questions" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="homework-questions"><span class="header-section-number">3.6.2</span> Homework questions</h3>
<div id="exr-3-6-4" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.23</strong></span> Show <span class="math inline">\({\textrm{Var}}\left[\hat Y|X\right]=\sigma^2 H\)</span>.</p>
</div>
<div id="exr-3-6-5" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.24</strong></span> Check for multicolinearity in our past examples.</p>
</div>
<div id="exr-3-6-6" class="theorem exercise">
<p><span class="theorem-title"><strong>Exercise 3.25</strong></span> Complete the problem sets from Chapter’s 2, 3 and 4!</p>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./Unit_1.html" class="pagination-link" aria-label="Review material">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Review material</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./Unit_3.html" class="pagination-link" aria-label="Residual analysis">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Residual analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>